<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>SSH | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="SSH" />
<meta name="author" content="Herbelleau Romain" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/ssh_et_shell/ssh.html" />
<meta property="og:url" content="/cours_informatique/cours/ssh_et_shell/ssh.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SSH" />
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","author":{"@type":"Person","name":"Herbelleau Romain"},"url":"/cours_informatique/cours/ssh_et_shell/ssh.html","headline":"SSH","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">SSH</h1>Auteurs :
      <ul>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Herbelleau Romain</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Laurent Léo</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Dégeorges Laurie</span></span></li>
      
      </ul></p></p>
  </header>

  <div class="post-content">
    <h1 id="zéro-tracash-zéro-blablash-ssh">Zéro tracash, Zéro blablash, SSH</h1>

<p>L’étape numéro 1 est d’avoir la bonne console. Moi, j’utilise Ubuntu (WSL 2).</p>

<p>L’étape numéro 2 est d’avoir un agent ssh, c’est le maître des clefs. 
Vous trouverez toutes les informations necessaires pour installer WSL2 et l’agent sous windows ici : <a href="https://francoisbrucker.github.io/cours_informatique/cours/dfs/installation_W10.html">installation_W10</a></p>

<p>Si vous utilisez linux ou mac tout est déjà là (normalement)</p>

<p>Comparer les OS expliquer ce qu’est l’agent</p>

<h3 id="vérifiez-que-ça-fonctionne">Vérifiez que ça fonctionne</h3>
<p>Ouvrez une fenêtre powershell et, en remplaçant login par votre login unix de l’école tapez la commande : <code class="language-plaintext highlighter-rouge">ssh-add -l</code>
Vous devriez avoir une phrase vous disant que l’agent n’a pas d’identité. Si vous n’avez pas d’agent installé (ou si vous l’avez stoppé) cela devrait vous dire qu’on arrive pas à se connecter à l’agent.</p>

<h2 id="ssh-cest-quoi-">SSH, c’est quoi ?</h2>

<p><strong>Secure Shell (SSH)</strong> est à la fois un programme informatique et un protocole de communication sécurisé. Le protocole de connexion impose un échange de clés de chiffrement en début de connexion. Par la suite, tous les segments TCP sont authentifiés et chiffrés. Il devient donc impossible d’utiliser un sniffer pour voir ce que fait l’utilisateur.
Avec SSH, l’authentification peut se faire sans l’utilisation de mot de passe ou de phrase secrète en utilisant la cryptographie asymétrique. Le protocole utilise deux clés complémentaires, la clé publique et la clé privée.
La clé publique est distribuée sur les systèmes auxquels on souhaite se connecter. La clé privée, qu’on prendra le soin de protéger par un mot de passe (elle est donc stockée cryptée), reste uniquement sur le poste à partir duquel on se connecte. L’utilisation de l’agent ssh permet de stocker le mot de passe de la clé privée pendant la durée de la session utilisateur.</p>

<p>Pour plein d’info et d’explication sur le chiffrement des clés voir <a href="/cours_informatique/cours/ssh_et_shell/ssh_rsa.html">ici</a></p>
<h2 id="générer-une-clé">Générer une clé</h2>

<h3 id="et-ne-pas-se-la-faire-voler-par-des-hackers-malveillants">Et ne pas se la faire voler par des hackers malveillants</h3>

<p><strong>TL;DR</strong></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>accéder au serveur de Centrale :  <span class="c"># pour retrouver ses données où que l'on soit </span>
  <span class="nv">$ </span>ssh <span class="nt">-A</span> identifiant@sas1.ec-m.fr

<span class="c"># ne pas créer de clé si on en a déjà une !</span>
créer sa clé : 
  <span class="nv">$ </span><span class="nb">cd</span> .ssh  <span class="c"># facultatif mais les clés seront plus en sécurité dans un dossier protégé </span>
  <span class="nv">$ </span>ssh-keygen

ajouter la clé à son porte clé :
  <span class="nv">$ </span>ssh-add chemin/nom_de_la_clé
</code></pre></div></div>

<h3 id="pour-créer-sa-paire-de-clés">Pour créer sa paire de clés</h3>
<h4 id="où-ranger-sa-clé-">Où ranger sa clé ?</h4>

<p>Il est préférable de se placer dans un dossier adapté au stockage de données sensibles, en général on stockera les clés dans .ssh.</p>

<p>Avec <code class="language-plaintext highlighter-rouge">$ ls -la</code> on peut voir tous les fichiers et leurs permissions. La ligne de .ssh devrait commencer par 
<code class="language-plaintext highlighter-rouge">drwx______</code>, <code class="language-plaintext highlighter-rouge">d</code> indique qu’il s’agit d’un dossier, les trois caractères suivants <code class="language-plaintext highlighter-rouge">rwx</code> que le <em>propriétaire</em> peut lire, 
écrire et exécuter son contenu et les tirets suivants que les autres utilisateurs n’ont aucun droit dessus (plus d’info sur les permissions <a href="https://www.linux.com/training-tutorials/understanding-linux-file-permissions/">ici</a>).</p>

<p>Pour les clés on se place donc dans .ssh puis on génère une paire de clés :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cd</span> .ssh
  <span class="nv">$ </span>ssh-keygen
</code></pre></div></div>

<p>On lui donne un nom (ex: keyblade95) et une passphrase (à ne pas oublier) et tadaaa on a maintenant deux fichiers keyblade95 et keyblade95.pub.</p>

<p><em>keyblade95.pub</em> est votre clé <strong>publique</strong> à donner à tous vos amis.</p>

<p><em>keyblade95</em> est votre clé <strong>privée</strong> à ne montrer à personne sous aucun prétexte.</p>

<p>Il faut ensuite ajouter sa clé à son agent qui joue ici le rôle de porte clé :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>ssh-add nom_de_la_clé
</code></pre></div></div>
<p>Rentrer la passphrase et la clé sera ajoutée. C’est tout simple.</p>

<p>On peut vérifier les clés ajoutées avec :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>ssh-add <span class="nt">-l</span>
</code></pre></div></div>

<p>Et faire oublier toutes les clés connues de son agent avec :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>ssh-add <span class="nt">-D</span> 
</code></pre></div></div>

<h2 id="a-chaque-nouvelle-session">A chaque nouvelle session</h2>

<p>À chaque fois que vous fermez votre session utilisateur 
(donc notamment lorsque vous éteignez votre ordinateur), 
votre agent ssh perd les clés publiques qu’il possédait. 
En démarrant une nouvelle session et en affichant la liste des identités 
représentées par l’agent avec <code class="language-plaintext highlighter-rouge">ssh-add -l</code>, 
vous obtenez donc le message suivant :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>the agent has no identities
</code></pre></div></div>

<p>Il faut donc récupérer votre clé ssh là où vous l’avez laissée. 
Rien de nouveau ici, c’est simplement une routine à prendre.</p>

<h2 id="authorized-keys">Authorized keys</h2>
<h3 id="reconnaître-les-machines-quon-connaît">Reconnaître les machines qu’on connaît</h3>

<p>Lorsque on se connecte à un serveur distant il est en général nécessaire de s’identifier, parfois plusieurs fois pour une seule ligne de commande ce qui est rapidement fastidieux.</p>

<p>Pour s’éviter des efforts inutiles il suffit d’enregistrer sa clé publique sur la machine distante qui pourra ensuite nous reconnaitre.
Les clés enregistrées sont stockées dans un fichier nommé authorized_keys dans un dossier .ssh sur le serveur.</p>

<p>La commande suivante permet d’ajouter notre clé publique aux clés connues par une machine :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">cat </span>id_rsa.pub <span class="o">&gt;&gt;</span> authorized_keys
</code></pre></div></div>
<p>Il est maintenant possible de se déconnecter et reconnecter au serveur ou faire des opérations plus complexes sans entrer systématiquement son mot de passe youpi !</p>

<h2 id="assaisonner-son-cours-dinfo">Assaisonner son cours d’info</h2>
<p><img src="images/seasonning.png" alt="image?" /></p>

<p>Aller sur http://node.ail.ovh1.ec-m.fr/ dans un navigateur et se connecter avec son identifiant Centrale.</p>

<p>Copier sa clé publique en entier (en 3 mots, commence par “ssh-rsa”, se termine par “@sas1.ec-m.fr”) et valider pour 
se voir attribuer notre propre herbe de Provence absolument authentique (malheureusement la farigoule n’est pas dans la liste).</p>

<p>On pourra ensuite accéder à ovh1 depuis le terminal :</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>mon_herbe@ovh1.ec-m.fr
</code></pre></div></div>

<p>Serveur et Identifiant que l’on utilisera pour <a href="/cours_informatique/cours/ssh_et_shell/ssh_scp.html">la suite du cours</a>.</p>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
