<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>TDD et test pattern : partie 3/3 | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="TDD et test pattern : partie 3/3">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-3.html">
<meta property="og:url" content="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-3.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="TDD et test pattern : partie 3/3">
<script type="application/ld+json">
{"headline":"TDD et test pattern : partie 3/3","description":"Support de cours/td d’informatique de François Brucker.","@type":"WebPage","url":"/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-3.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">TDD et test pattern : partie 3/3</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span>
  </header>

  <div class="post-content">
    <p>Partie 3/3.</p>

<!--more-->

<blockquote class="chemin">
  <p><a href="/cours_informatique/cours/algorithme-code-theorie/">Algorithme, code et théorie</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/">code</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/">programmation objet</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">projet : TDD</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-3.html">partie 3/3</a></p>

  <p><strong>prérequis :</strong></p>

  <ul>
    <li><a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">partie 2/3</a></li>
  </ul>

</blockquote>

<h2 id="todo-list-initiale">todo list initiale</h2>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code> avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ul>

<p>On est arrivé à un point clé de notre projet. La classe <code class="language-plaintext highlighter-rouge">Monnaie</code> permet de gérer plusieurs devises et de multiplier les montant par un entier.</p>

<p>On va encore épurer la todo list en supprimant les améliorations possibles de <code class="language-plaintext highlighter-rouge">==</code> et la gestion des arrondis (que l’on vous laisse en exercice :-)) :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
</ul>

<h2 id="déroulé">Déroulé</h2>

<p>On va dans cette partie vous laisser plus libre et moins détailler les étapes. Ce sera à vous de modifier petit à petit votre code et à lancer les tests autant de de fois que nécessaire.</p>

<p>Nous allons ici faire en sorte que l’on puisse additionner des devises ensemble et gérer le taux de change. Cela va nécessiter l’utilisation de design patterns adaptés.</p>

<p>Rappelez vous (et forcez vous à le faire jusqu’à ce que ça devienne un automatisme) que l’on écrit <strong>d’abord</strong> le test, puis que l’on code <strong>après</strong> : on ne code que sur du <strong>vert</strong>, il n’y a <strong>aucune</strong> exception.</p>

<blockquote class="note">
  <p><strong>Principe du TDD :</strong></p>

  <ol>
    <li>
<strong>rouge</strong> :
      <ul>
        <li>écrire <em>rapidement</em> un <em>petit</em> test</li>
        <li>lancer les tests et les voir planter, voir même  ne correspondre à aucun code.</li>
      </ul>
    </li>
    <li>
<strong>vert</strong> :
      <ul>
        <li>écrire le code <em>minimal</em> qui permet de faire passer le test</li>
        <li>lancer les tests et les voir tous réussir</li>
      </ul>
    </li>
    <li>
<strong>code/refactor</strong> :
      <ul>
        <li>élimine les duplications tout en conservant la validité des tests.</li>
      </ul>
    </li>
  </ol>

  <p>La partie refactor, qui est la partie réelle où l’on code ne se fait <strong>que sur du vert</strong> : on est assuré de ne pas casser le code puisque les tests passent.</p>
</blockquote>

<h2 id="addition-13">Addition 1/3</h2>

<p>Avant de traiter l’addition de deux monnaies différentes, commençons par traiter le cas de 1 unique monnaie.</p>

<h3 id="todo-list-add-1-1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item"><strong>[-] \$5 + \$2 = \$7</strong></li>
</ul>

<p>On s’assure dans le test qu’on ne somme pas deux fois la même chose pour éviter des effets de bord possible dans le code (c’est du code smell).</p>

<h3 id="faire-add-1-1">faire</h3>

<blockquote class="a-faire">
  <p>Ecrivez un test permettant de tester que \$5 + \$2 = \$7 en :</p>

  <ul>
    <li>
      <p>utilisant la méthode <code class="language-plaintext highlighter-rouge">plus</code> de <code class="language-plaintext highlighter-rouge">Monnaie</code> qui prend une autre monnaie en paramètre et rend une monnaie</p>
    </li>
    <li>
      <p>les objets de <code class="language-plaintext highlighter-rouge">Monnaie</code> sont toujours non mutable</p>
    </li>
  </ul>
</blockquote>

<p>Une fois les tests écris, une <em>obvious implementation</em> devrait faire l’affaire.</p>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_plus</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="n">plus</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="faire-add-1-2">faire</h3>

<p>Rendons les choses jolies en utilisant <code class="language-plaintext highlighter-rouge">__add__</code> qui est le pendant pour l’addition de <code class="language-plaintext highlighter-rouge">__mul__</code></p>

<blockquote class="a-faire">
  <p>Remplacez la méthode <code class="language-plaintext highlighter-rouge">plus</code> par <code class="language-plaintext highlighter-rouge">__add__</code>dans <code class="language-plaintext highlighter-rouge">Monnaie</code>.</p>
</blockquote>
<details><summary>solution</summary><div>
<p>easy peasy, on remplace juste <code class="language-plaintext highlighter-rouge">plus</code> par <code class="language-plaintext highlighter-rouge">+</code></p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_plus</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p>et  <code class="language-plaintext highlighter-rouge">plus</code> par <code class="language-plaintext highlighter-rouge">__add__</code></p>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="todo-list-add-1-2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = \$7</li>
</ul>

<h2 id="addition-23">Addition 2/3</h2>

<p>Notre implémentation de <code class="language-plaintext highlighter-rouge">+</code> qui rend un objet de type <code class="language-plaintext highlighter-rouge">Mnnaie</code> ne sera pas tenable longtemps.</p>

<p>En effet <code class="language-plaintext highlighter-rouge">$5 + 2.5CHF</code> <strong>ne peut pas être</strong> un objet de type <code class="language-plaintext highlighter-rouge">Monnaie</code>. Ce sont en effet deux devises différentes dont la valeur va dépendre d’un cours <a href="https://fr.tradingview.com/symbols/USDCHF/">qui change au cours du temps</a>. La somme <code class="language-plaintext highlighter-rouge">$5 + 2.5CHF</code> peut ainsi valoir <code class="language-plaintext highlighter-rouge">$10</code> en 2022 et <code class="language-plaintext highlighter-rouge">$7</code> en 2034.</p>

<p>Il faut donc résoudre deux problèmes :</p>

<ul>
  <li>comment stocker une somme sous la forme de plusieurs devises ?</li>
  <li>comment convertir une monnaie ou un ensemble de monnaies en une autre ?</li>
</ul>

<h3 id="todo-list-add-2-1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item"><strong>[-] \$5 + \$2 = quelque chose qui correspond à $7</strong></li>
</ul>

<h3 id="faire-add-2-1">faire</h3>

<p>Pour imaginer cela rien de mieux qu’un test ! On va l’écrire à l’envers, en partant du résultat, car  on sait où on veut arriver : à $10 :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### ...
</span>
<span class="k">def</span> <span class="nf">test_conversion_addition</span><span class="p">():</span>
    <span class="c1"># ...
</span>    
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">conversion</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p>Ces $10 viennent d’une conversion en dollar d’une somme de deux monnaies, conversion qui – d’un point de vue métier – ne peut venir que d’une banque :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### ...
</span>
<span class="k">def</span> <span class="nf">test_conversion_addition</span><span class="p">():</span>
    <span class="c1"># ...
</span>    
    <span class="n">conversion</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">somme</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">conversion</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p>Banque qu’il faut créer :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### ...
</span>
<span class="k">def</span> <span class="nf">test_conversion_addition</span><span class="p">():</span>
    <span class="c1"># ...
</span>    
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">conversion</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">somme</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">conversion</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p>Il ne reste plus qu’à fabriquer notre expression pur avoir notre test final :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### ...
</span>
<span class="k">def</span> <span class="nf">test_conversion_addition</span><span class="p">():</span>
    <span class="n">somme</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">conversion</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">somme</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">conversion</span>

<span class="c1"># ...
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>Ajoutez le test dans <em>“test_monnaie.py”</em> et fakez le tout dans <em>“monnaie.py”</em>  pour que le test passe.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Banque</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h2 id="addition-33">Addition 3/3</h2>

<p>L’implémentation réelle de tout ce qu’on a <em>faké</em> n’est pas si évidente que ça. On va donc devoir faire des choix restrictifs et ajouter à la todo list les généralisations à effectuer pour terminer le travail.</p>

<p>On va considérer que toute somme de deux monnaies est une nouvelle classe <code class="language-plaintext highlighter-rouge">Somme</code> (on va cependant ajouter que la somme de 2 monnaies identiques devrait rendre une monnaie, comme pour la multiplication,  dans la todo list).</p>

<h3 id="todo-list-add-3-1">todo list</h3>

<p>On change notre iitem de la todo list puique \$5 + \$2 ne sera plus égal à \$7, mais que ce serait bien qu’il soit :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item"><strong>[-] \$5 + \$2 = quelque chose qui correspond à $7</strong></li>
</ul>

<h3 id="faire-add-3-1">faire</h3>

<blockquote class="a-faire">
  <ol>
    <li>supprimez le test <code class="language-plaintext highlighter-rouge">test_plus</code> qui vérifie que \$5 + \$2 = \$7 ce qui n’est plus vrai</li>
    <li>on ajoute un test pour montrer que la somme de deux monnaies est un objet contenant une partie gauche (la partie à gauche du <code class="language-plaintext highlighter-rouge">+</code>) et une partie droite (la partie à droite du <code class="language-plaintext highlighter-rouge">+</code>)</li>
    <li>on implémente le tout en une petite <em>obvious implementation</em>
</li>
  </ol>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_plus_est_une_Somme</span><span class="p">():</span>
    <span class="n">somme</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">somme</span><span class="p">.</span><span class="n">gauche</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">somme</span><span class="p">.</span><span class="n">droite</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gauche</span><span class="p">,</span> <span class="n">droite</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">gauche</span> <span class="o">=</span> <span class="n">gauche</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">droite</span> <span class="o">=</span> <span class="n">droite</span>

<span class="c1"># ... 
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Somme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="todo-list-add-3-2">todo list</h3>

<p>On a pas fini notre item.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item"><strong>[-] \$5 + \$2 = quelque chose qui correspond à $7</strong></li>
</ul>

<p>Mais on a bien avancé puisque  \$5 + \$2 n’est plus une <code class="language-plaintext highlighter-rouge">Monnaie</code>. Il nous reste à faire en sorte que ce quelque chose corresponde à \$7.</p>

<h2 id="conversion-13">conversion 1/3</h2>

<p>Pour que \$5 + \$2 corresponde à quelque chose qui vaut à \$7, on doit travailler sur la méthode <code class="language-plaintext highlighter-rouge">conversion</code> de la <code class="language-plaintext highlighter-rouge">Banque</code>. C’est elle qui doit pouvoir faire le change (pour l’instant c’est un <em>fake</em> qui rend \$7).</p>

<h3 id="todo-list-conv-1-2">todo list</h3>

<p>Pour l’instant, <code class="language-plaintext highlighter-rouge">Banque.conversion</code> prend pour une <code class="language-plaintext highlighter-rouge">Somme</code> en paramètre. Nous n’allons pas ous en occuper tout de suite, mais il pourrait être intéressant qu’elle puisse aussi prendre une <code class="language-plaintext highlighter-rouge">Monnaie</code> en paramètre pour faire le change :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item"><strong>[-] \$5 + \$2 = quelque chose qui correspond à $7</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
</ul>

<h3 id="faire-conv-1-1">faire</h3>

<p>Le test <code class="language-plaintext highlighter-rouge">test_conversion_addition</code> affirme que <code class="language-plaintext highlighter-rouge">banque.conversion(monnaie.dollar(5) + monaie.dollar(2), "USD")</code> vaut  <code class="language-plaintext highlighter-rouge">monnaie.dollar(7)</code>. Mais n’otre implémentation est encore un fake (il reste plein de duplications.</p>

<blockquote class="a-faire">
  <p>Supprimer les duplication de la méthode <code class="language-plaintext highlighter-rouge">Banque.conversion</code> en :</p>

  <ul>
    <li>supposant que les parties <code class="language-plaintext highlighter-rouge">gauche</code> et <code class="language-plaintext highlighter-rouge">droite</code> de la somme sont des <code class="language-plaintext highlighter-rouge">Monnaie</code>
</li>
    <li>que le taux de change est toujours de 1 pour 1</li>
  </ul>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Banque</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">expression</span><span class="p">.</span><span class="n">gauche</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="n">expression</span><span class="p">.</span><span class="n">droite</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>C’est un début. Il nous reste à gérer :</p>

<ul>
  <li>lorsque les deux parties de la <code class="language-plaintext highlighter-rouge">Somme</code> ne sont pas des <code class="language-plaintext highlighter-rouge">Monnaie</code>
</li>
  <li>le taux de change</li>
</ul>

<h2 id="conversion-23">conversion 2/3</h2>

<p>L’implémentation actuelle de la méthode <code class="language-plaintext highlighter-rouge">Banque.conversion</code> — même si incomplète — pose déjà des soucis. En particulier : la banque doit connaître l’implémentation de <code class="language-plaintext highlighter-rouge">Monnaie</code> pour avoir accès à l’attribut <code class="language-plaintext highlighter-rouge">montant</code>.</p>

<p>Lorsque l’on fait du développement objet, on aime pas trop que tous les objets conaissent les attributs de tout le monde. Cela couple les objets entre eux et le code en devient moins maniable (en changeant une classe, il faut changer toutes les autres…)</p>

<blockquote class="note">
  <p><strong>Principe de développement objet :</strong> <a href="https://fr.wikipedia.org/wiki/Loi_de_D%C3%A9m%C3%A9ter">loi de Déméter</a></p>

  <p>Toute méthode <code class="language-plaintext highlighter-rouge">m</code> d’un objet <code class="language-plaintext highlighter-rouge">o</code> de classe <code class="language-plaintext highlighter-rouge">C</code> ne peut invoquer que :</p>

  <ul>
    <li>les paramètres de <code class="language-plaintext highlighter-rouge">m</code>
</li>
    <li>les objets créés par <code class="language-plaintext highlighter-rouge">m</code>
</li>
    <li>lui-même</li>
    <li>les méthodes de <code class="language-plaintext highlighter-rouge">C</code>
</li>
  </ul>

  <p>Un bon programme utilise des objets qui interagissent entre eux mais qui ne connaissent pas l’implémentation des autres classes. Les objets doivent être le plus découplé possible.</p>
</blockquote>

<p>En particulier, la loi de Déméter demande d’éviter d’appeler les méthodes d’un attribut d’un objet ce qui est exactement ce que l’on fait.</p>

<h3 id="faire-conv-2-1">faire</h3>

<p>Pour éviter cette double indirection :</p>

<blockquote class="a-faire">
  <p>Remontez d’un cran le code de <code class="language-plaintext highlighter-rouge">Banque.conversion</code> en le plaçant dans une méthode <code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code>. Pour l’instant on suppose toujours que le taux de conversion est de 1 pour 1 quelque soient les monnaies et que les parties gauche et droite des <code class="language-plaintext highlighter-rouge">Somme</code> sont des <code class="language-plaintext highlighter-rouge">Monnaies</code>.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Banque</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expression</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">devise</span><span class="p">)</span>

<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="c1"># ... 
</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">gauche</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">droite</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ... 
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="todo-list-conv-2-1">todo list</h3>

<p>On a fini un item, mais avec plein de restrictions. Ajoutons les à la la todo list.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions</li>
</ul>

<h2 id="conversion-33">conversion 3/3</h2>

<p>L’étape précédente a permis de baisser le niveau de connaissance de la banque des objets qui l’entourent. C’est une bonne chose car cela suit la loi de Déméter.</p>

<p>Monter la méthode <code class="language-plaintext highlighter-rouge">conversion</code> de la <code class="language-plaintext highlighter-rouge">Banque</code> à la <code class="language-plaintext highlighter-rouge">Somme</code> nous permet également de traiter le cas où <code class="language-plaintext highlighter-rouge">Banque.reducconversiontion</code> a une  <code class="language-plaintext highlighter-rouge">Monnaie</code> comme paramètre : il suffit de rajouter une méthode <code class="language-plaintext highlighter-rouge">Monnaie.conversion</code> !</p>

<h3 id="todo-list-conv-3-1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code></strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions</li>
</ul>

<h3 id="faire-conv-3-1">faire</h3>

<blockquote class="a-faire">
  <ol>
    <li>créez un test où l’argument de <code class="language-plaintext highlighter-rouge">Banque.conversion</code> est un objet de type <code class="language-plaintext highlighter-rouge">Monnaie</code>
</li>
    <li>implémentez le code correspondant</li>
  </ol>

  <p>De même que précédemment, on va considérer que le seul paramètre de la méthode <code class="language-plaintext highlighter-rouge">Monnaie.conversion</code> la devise d’arrivée et que — pour l’instant — le taux de change est de 1 pour 1</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_banque_conversion_monnaie_identique</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"USD"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="todo-list-conv-3-2">todo list</h3>

<p>On a fini un item, mais avec plein de restrictions. Ajoutons les à la la todo list :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Monnaie.conversion(devise)</code> doit vraiment faire des conversions</li>
</ul>

<h2 id="taux-de-change-12">Taux de change 1/2</h2>

<p>On va maintenant s’attaquer à la conversion. Commençons simple avec les objets de type <code class="language-plaintext highlighter-rouge">Monnaie</code></p>

<h3 id="todo-list-change-1-1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">Monnaie.conversion(devise)</code> doit vraiment faire des conversions</strong></li>
</ul>

<h3 id="faire-change-1-1">faire</h3>

<blockquote class="a-faire">
  <p>On veut que <code class="language-plaintext highlighter-rouge">Banque.conversion(monnaie.dollar(2), "CHF")</code> donne 1. On doit pour cela utilisez un taux de change donné par <code class="language-plaintext highlighter-rouge">Banque.change</code> qui prend 2 devises en paramètres, celle de départ et celle d’arrivée.</p>

  <ol>
    <li>créez un test qui vérifie que <code class="language-plaintext highlighter-rouge">Banque.change</code> fonctionne pour deux devises identiques et utilisez cette méthode dans <code class="language-plaintext highlighter-rouge">Banque.conversion</code>.</li>
    <li>créez un test qui vérifie que <code class="language-plaintext highlighter-rouge">Banque.change</code> fonctionne pour convertir des dollar en CHF avec un taux de 2 dollars pour 1 CHF.</li>
    <li>créez un test qui vérifie que <code class="language-plaintext highlighter-rouge">Banque.conversion(monnaie.dollar(2), "CHF")</code> donne 1</li>
    <li>utilisez la banque pour faire la conversion dans <code class="language-plaintext highlighter-rouge">Monnaie.conversion</code> (il faudra ajouter la banque comme paramètre)</li>
  </ol>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_banque_change_identique</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">change</span><span class="p">(</span><span class="s">"USD"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_banque_change_CHF_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">change</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">0.5</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">change</span><span class="p">(</span><span class="s">"USD"</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">))</span>

<span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_banque_conversion_monnaie_differente</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Banque</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expression</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devise_depart</span><span class="p">,</span> <span class="n">devise_arrivee</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">devise_depart</span> <span class="o">==</span> <span class="n">devise_arrivee</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">devise_depart</span> <span class="o">==</span> <span class="s">"USD"</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">.</span><span class="mi">5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>

<span class="c1"># ... 
</span>
<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banque</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">gauche</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">droite</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banque</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">banque</span><span class="p">.</span><span class="n">change</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">,</span> <span class="n">devise</span><span class="p">),</span> <span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

<p>Remarquez qu’on a du également modifier <code class="language-plaintext highlighter-rouge">Somme.conversion</code> pour que les tests continuent de passer.</p>

</div></details>

<h3 id="todo-list-change-1-2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Monnaie.conversion(devise)</code> doit vraiment faire des conversions</li>
</ul>

<h3 id="taux-de-change-22">Taux de change 2/2</h3>

<p>Pour l’instant notre conversion pour les sommes ne considère que les mêmes devises. On va travailler maintenant sur des devises différentes.</p>

<h3 id="todo-list-change-2-1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Monnaie.conversion(devise)</code> doit vraiment faire des conversions</li>
</ul>

<h3 id="faire-change-2-1">faire</h3>

<p>Commençons simplement :</p>

<blockquote class="a-faire">
  <p>Faire un test qui convertit la somme de \$2 et 1CHF en franc suisse et implémentez le tout.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_somme_conversion_deux_monnaies</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">conversion</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banque</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="n">gauche</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">gauche</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>
        <span class="n">droite</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">droite</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">gauche</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="n">droite</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banque</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">banque</span><span class="p">.</span><span class="n">change</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">,</span> <span class="n">devise</span><span class="p">),</span> <span class="n">devise</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

<p>Remarquez qu’on a du également modifier <code class="language-plaintext highlighter-rouge">Somme.conversion</code> pour que les tests continuent de passer.</p>

</div></details>

<h3 id="todo-list-change-2-2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + \$2 doit être égal à \$7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 + \$2 = quelque chose qui correspond à $7</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Banque.conversion(Monnaie)</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Somme.conversion(devise)</code> doit vraiment faire des conversions**</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">Monnaie.conversion(devise)</code> doit vraiment faire des conversions</li>
</ul>

<h2 id="expressions">Expressions</h2>

<p>Pour finir, il nous reste à généraliser le tout. C’est à dire que l’on aimerait bien pouvoir multiplier une <code class="language-plaintext highlighter-rouge">Somme</code> par un entier par exemple ou additionner des <code class="language-plaintext highlighter-rouge">Somme</code> entre elles.</p>

<p>Le design pattern utilisé pour cela est :</p>

<blockquote class="note">
  <p><strong>design pattern :</strong> <a href="https://refactoring.guru/fr/design-patterns/composite">composite</a></p>

  <p>Son but est de pouvoir traiter un groupe d’individu comme un seul. Il utilise une structuration récursive pour cela.</p>
</blockquote>

<h3 id="faire-exp-1">faire</h3>

<p>A priori, une partie de la somme de sommes est déjà implémentée. Regardez comment <code class="language-plaintext highlighter-rouge">Somme</code> est construite, en particulier la méthode <code class="language-plaintext highlighter-rouge">__add__</code>.</p>

<p>Par exemple, le test suivant doit passer :</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_somme_de_somme</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>pourquoi ?</p>
</blockquote>
<details><summary>solution</summary><div>
<p>La méthode conversion est récursive dans <code class="language-plaintext highlighter-rouge">Somme</code>. Les terminaison se faisant lorsque une partie de la somme est une <code class="language-plaintext highlighter-rouge">Monnaie</code>.</p>

</div></details>

<p>En revanche, ce test ne passe pas encore :</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_somme_de_somme_2</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>pourquoi ?</p>
</blockquote>
<details><summary>solution</summary><div>
<p>Le résultat des tests donne :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    def test_somme_de_somme_2():
        banque = monnaie.Banque()
&gt;       expression = (monnaie.dollar(1) + monnaie.franc(2)) + monnaie.dollar(1)
E       TypeError: unsupported operand type(s) for +: 'Somme' and 'Monnaie'
</code></pre></div></div>

<p>Nous n’avons pas implémenté de méthode <code class="language-plaintext highlighter-rouge">__add__</code> pour les <code class="language-plaintext highlighter-rouge">Somme</code>.</p>
</div></details>

<blockquote class="a-faire">
  <p>Faite passer les tests.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Somme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="faire-exp-2">faire</h3>

<p>Il ne reste plus qu’à tester la multiplication pour finir.</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_mult_de_somme</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>

    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>
</code></pre></div></div>

<blockquote class="a-faire">
  <p>Faite passer le test ci-dessus</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Somme</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">gauche</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">droite</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
    
    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<blockquote class="a-faire">
  <p>Pourquoi nous sera-t-il impossible d’écrire : <code class="language-plaintext highlighter-rouge">4 * (monnaie.franc(2) + monnaie.dollar(1))</code> ?</p>
</blockquote>
<details><summary>solution</summary><div>
<p>Parce qu’il faudrait modifier la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> des entiers de python, ce qui est impossible.</p>

</div></details>

<h2 id="bilan">bilan</h2>

<p>Vous avez suivi tout un projet de développement par les tests. J’espère vous avoir convaincu que cette méthode permet de développer rapidement et proprement du code (<em>“clean code that works</em>”).</p>

<h3 id="code">code</h3>

<h4 id="test_monnaiepy"><em>“test_monnaie.py”</em></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">approx</span>
<span class="kn">import</span> <span class="nn">monnaie</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_devise</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>


<span class="k">def</span> <span class="nf">test_plus_est_une_Somme</span><span class="p">():</span>
    <span class="n">somme</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">somme</span><span class="p">.</span><span class="n">gauche</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">somme</span><span class="p">.</span><span class="n">droite</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_conversion_addition</span><span class="p">():</span>
    <span class="n">somme</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">conversion</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">somme</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">conversion</span>


<span class="k">def</span> <span class="nf">test_banque_conversion_monnaie_identique</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_banque_conversion_monnaie_differente</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_banque_change_identique</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">change</span><span class="p">(</span><span class="s">"USD"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_banque_change_CHF_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">change</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">0.5</span> <span class="o">==</span> <span class="n">approx</span><span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">change</span><span class="p">(</span><span class="s">"USD"</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">test_somme_conversion_deux_monnaies</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">().</span><span class="n">conversion</span><span class="p">(</span>
        <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"CHF"</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_somme_de_somme</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_somme_de_somme_2</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_mult_de_somme</span><span class="p">():</span>
    <span class="n">banque</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">Banque</span><span class="p">()</span>

    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

</code></pre></div></div>

<h4 id="monnaiepy"><em>“monnaie.py”</em></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="n">devise</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">devise</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Somme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banque</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">banque</span><span class="p">.</span><span class="n">change</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">,</span> <span class="n">devise</span><span class="p">),</span> <span class="n">devise</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Banque</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expression</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">devise_depart</span><span class="p">,</span> <span class="n">devise_arrivee</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">devise_depart</span> <span class="o">==</span> <span class="n">devise_arrivee</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">devise_depart</span> <span class="o">==</span> <span class="s">"USD"</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span>


<span class="k">class</span> <span class="nc">Somme</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gauche</span><span class="p">,</span> <span class="n">droite</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">gauche</span> <span class="o">=</span> <span class="n">gauche</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">droite</span> <span class="o">=</span> <span class="n">droite</span>

    <span class="k">def</span> <span class="nf">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">banque</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="n">gauche</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">gauche</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>
        <span class="n">droite</span> <span class="o">=</span> <span class="n">banque</span><span class="p">.</span><span class="n">conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">droite</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">gauche</span><span class="p">.</span><span class="n">montant</span> <span class="o">+</span> <span class="n">droite</span><span class="p">.</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Somme</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Somme</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">gauche</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">droite</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>

</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
