<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>TDD et test pattern : partie 1/3 | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="TDD et test pattern : partie 1/3">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-1.html">
<meta property="og:url" content="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-1.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="TDD et test pattern : partie 1/3">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique de François Brucker.","@type":"WebPage","author":{"@type":"Person","name":"François Brucker"},"url":"/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-1.html","headline":"TDD et test pattern : partie 1/3","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">TDD et test pattern : partie 1/3</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span>
  </header>

  <div class="post-content">
    <p>Partie 1/3.</p>

<!--more-->

<blockquote class="chemin">
  <p><a href="/cours_informatique/cours/algorithme-code-theorie/">Algorithme, code et théorie</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/">code</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/">programmation objet</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">projet : TDD</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-1.html">partie 1/3</a></p>

  <p><strong>prérequis :</strong></p>

  <ul>
    <li><a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">projet : TDD</a></li>
  </ul>

</blockquote>

<h2 id="1---départ">1 - départ</h2>

<h3 id="faire-1.1">faire</h3>

<p>Commençons par noter ce qu’il faut faire pour que notre application de change fonctionne :</p>

<ul>
  <li>il faut plusieurs devises (ici CHF et $)</li>
  <li>il faut multiplier les devises par des nombres (nb actions * prix)</li>
</ul>

<p>Cette todo-list (ou <em>backlog</em>) nous indique :</p>

<ol>
  <li>
<strong>ce qu’il faut faire</strong> : dès que on voit une tâche à faire qui n’est pas dans la todo list, on la rajoute,</li>
  <li>
<strong>ce sur quoi on travaille</strong> : on travaillera toujours sur <strong>un unique</strong> item à la fois</li>
  <li>
<strong>ce que l’on a fait</strong> : il n’y a rien de plus satisfaisant que de barrer une ligne que l’on vient de finir.</li>
</ol>

<blockquote class="a-faire">
  <ol>
    <li>Créez un nouveau projet sous vscode dans un dossier que vos appellerez <em>“projet-tdd”</em>.</li>
    <li>On a besoin que d’un unique fichier pour l’instant : <em>“test_monnaie.py”</em>.</li>
    <li>Prenez également une feuille de papier pour vos todos.</li>
  </ol>

</blockquote>

<h3 id="todo-list-1.1">todo list</h3>

<p>Première todo-list :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 * 2 = \$10</li>
</ul>

<h3 id="faire-1.2">faire</h3>

<p>Par quoi on commence ?</p>

<p><strong>PAR UN TEST !</strong></p>

<p>La bonne question n’est donc pas “que fait-on en premier” mais :</p>

<p><strong>Que teste-t-on en premier ?</strong></p>

<p>La deuxième ligne semble la plus simple. Donc allons-y, mettons en <strong>gras</strong> l’item de la todo list qu’on veut faire :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item"><strong>[-] \$5 * 2 = \$10</strong></li>
</ul>

<p>Puis :</p>

<blockquote class="a-faire">
  <p>codons un test qui  valide cette item dans le fichier <em>“test_monnaie.py”</em></p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">monnaie</span> <span class="kn">import</span> <span class="n">Dollar</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">cinq</span><span class="p">.</span><span class="n">fois</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">cinq</span><span class="p">.</span><span class="n">montant</span>
</code></pre></div></div>

<p>Nous n’avons pas encore écrit de classe <code class="language-plaintext highlighter-rouge">Dollar</code>, mais on l’utilise déjà…</p>

<blockquote class="note">
  <p>En TDD on utilise notre code avant de l’écrire. Avoir une idée de comment utiliser le code nous donne une idée de comment il doit fonctionner.</p>
</blockquote>

<p>L’écriture de notre test (un cas d’utilisation de la classe dollar qui valide l’item courant de la todo-list) nous montre des choses que l’on doit pouvoir faire, et par là augmente notre todo-list avec des choses à implémenter ou des questions auxquelles il va falloir répondre un jour.</p>

<h3 id="todo-list-1.2">todo list</h3>

<p>Le test nous pose quelques questions quand à l’utilisation dela classe dollar. Notre todo-list devient :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item"><strong>[-] \$5 * 2 = \$10</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h3 id="faire-1.3">faire</h3>

<p>Rien ne marche avec nos tests lorsqu’on les exécute via le terminal :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>» python <span class="nt">-m</span> pytest test_monnaie.py
<span class="o">========================</span> <span class="nb">test </span>session starts <span class="o">=========================</span>
platform darwin <span class="nt">--</span> Python 3.9.9, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: /projet-tdd
plugins: dash-1.19.0, cov-3.0.0
collected 0 items / 1 error

<span class="o">==============================</span> ERRORS <span class="o">================================</span>
__________________ ERROR collecting test_monnaie.py ___________________
ImportError <span class="k">while </span>importing <span class="nb">test </span>module <span class="s1">'/projet-tdd/test_monnaie.py'</span><span class="nb">.</span>
Hint: make sure your <span class="nb">test </span>modules/packages have valid Python names.
Traceback:
/python3.9/importlib/__init__.py:127: <span class="k">in </span>import_module
    <span class="k">return </span>_bootstrap._gcd_import<span class="o">(</span>name[level:], package, level<span class="o">)</span>
test_monnaie.py:1: <span class="k">in</span> &lt;module&gt;
    from money import Dollar
E   ModuleNotFoundError: No module named <span class="s1">'monnaie'</span>
<span class="o">======================</span> short <span class="nb">test </span>summary info <span class="o">=======================</span>
ERROR test_monnaie.py
<span class="o">!!!!!!!!!!!!!!!</span> Interrupted: 1 error during collection <span class="o">!!!!!!!!!!!!!!!</span>
<span class="o">=========================</span> 1 error <span class="k">in </span>0.13s <span class="o">===========================</span>
</code></pre></div></div>

<p>Ca en fait des erreurs !</p>

<p>Mais c’est une chance, car les messages d’erreurs vont nous permettre de faire un programme qui fonctionne. Il suffit de les supprimer une à une.</p>

<blockquote class="note">
  <p>Apprenez à <strong>lire</strong> les messages d’erreurs !</p>

  <p>Il est est souvent plus simple d’exécuter un code et de lire ce qui ne marche pas plutôt qe de réfléchir pour savoir si ça va fonctionner.</p>
</blockquote>

<p>On va donc lire attentivement les messages d’erreurs de python et les régler petit à petit. Un message d’erreur <strong>est informatif</strong> si on se force à les lire.</p>

<p>Nos tests ratent à cause d’une erreur. On le voit à cette ligne :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E   ModuleNotFoundError: No module named 'monnaie'
</code></pre></div></div>

<p>L’erreur est explicite :</p>

<blockquote class="a-faire">
  <p>Créez un fichier <em>“monnaie.py”</em> vide dans le projet.</p>
</blockquote>

<p>On relance nos tests et maintenant l’erreur est :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E   ImportError: cannot import name 'Dollar' from 'monnaie' (/projet-tdd/monnaie.py)
</code></pre></div></div>

<p>Encore une fois, l’erreur est explicite : il n’existe pas de module <code class="language-plaintext highlighter-rouge">monnaie</code>. Créons en un :</p>

<blockquote class="a-faire">
  <p>Créez une classe <code class="language-plaintext highlighter-rouge">Dollar</code> vide dans le fichier <em>“monnaie.py”</em>.</p>
</blockquote>

<p>Pour créer une classe vide, il suffit de mettre une unique instruction <code class="language-plaintext highlighter-rouge">pass</code> (qui ne fait rien mais permet de ne pas faire d’erreur lorsque l’on crée un bloc sans instructions) :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>On relance nos tests et maintenant l’erreur (toujours explicite) est :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def test_multiplication():
&gt;       cinq = Dollar(5)
E       TypeError: Dollar() takes no arguments
</code></pre></div></div>

<p>Qu’à cela ne tienne, ajoutons un argument à la création de dollar :</p>

<blockquote class="a-faire">
  <p>Ajoutez un argument à la création d’un objet de la classe <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
      <span class="k">pass</span>

</code></pre></div>  </div>

</blockquote>

<p>On relance nos tests et maintenant :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E       AttributeError: 'Dollar' object has no attribute 'fois'
</code></pre></div></div>

<p>On sait faire, on ajoute une méthode vide pour que cette erreur disparaisse :</p>

<blockquote class="a-faire">
  <p>Ajoutez une méthode <code class="language-plaintext highlighter-rouge">fois</code> vide dans la classe <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">pass</span>

</code></pre></div>  </div>

</blockquote>

<p>On relance nos tests et… encore une erreur. Heureusement, comme toutes les autres elle est facile à résoudre :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def test_multiplication():
        cinq = Dollar(5)
        cinq.fois(2)
    
&gt;       assert 10 == cinq.montant
E       AttributeError: 'Dollar' object has no attribute 'montant'
</code></pre></div></div>

<p>On voit de plus que <code class="language-plaintext highlighter-rouge">montant</code>doit être égal à 10, donc vite vite, on corrige cette erreur :</p>

<blockquote class="a-faire">
  <p>Ajoutez un attribut <code class="language-plaintext highlighter-rouge">montant</code> qui vaut 10 à tout objet <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">pass</span>

</code></pre></div>  </div>

</blockquote>

<p>On relance nos tests et…</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>» python -m pytest test_monnaie.py
======================== test session starts =========================
platform darwin -- Python 3.9.9, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: /projet-tdd
plugins: dash-1.19.0, cov-3.0.0
collected 1 item
test_monnaie.py .

========================== 1 passed in 0.01s =========================
</code></pre></div></div>

<p><strong>Incroyable !</strong> Nos tests passent (c’est émouvant).</p>

<blockquote class="note">
  <p>Corriger petit à petit un test pour qu’il passe ne nécessite presque pas d’intelligence. Il suffit de se laisser guider par l’interpréteur python.</p>
</blockquote>

<h3 id="faire-1.4">faire</h3>

<p><strong>Halte là !</strong> Ce n’est pas fini.</p>

<p>Nos tests passent mais il reste un étape à faire : <strong>refactor</strong> : <em>supprimer les duplications</em>.</p>

<p>La première duplication évidente est le nombre <code class="language-plaintext highlighter-rouge">10</code> du test qui est dupliqué avec le <code class="language-plaintext highlighter-rouge">10</code> du <code class="language-plaintext highlighter-rouge">self.montant</code>. Comme on en a l’habitude maintenant, on va supprimer cette duplication petit à petit :</p>

<p>Après chaque modification, on s’assure que les tests passent : on ne modifie du code que si tout est vert. Ceci nous assure que l’on ne casse pas le programme.</p>

<p>Dans la classe <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># ...
</span></code></pre></div></div>

<p>Le <code class="language-plaintext highlighter-rouge">10</code> est en fait un <code class="language-plaintext highlighter-rouge">5 * 2</code> (On crée au départ $5).</p>

<p>On effectue la modification :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># ...
</span></code></pre></div></div>

<p>Et on lance nos tests pour vérifier que rien n’est cassé.</p>

<p>Le <code class="language-plaintext highlighter-rouge">5</code> qu’on vient de rajouter est aussi une duplication du test <code class="language-plaintext highlighter-rouge">cinq = Dollar(5)</code>. Modifions alors le code :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># ...
</span></code></pre></div></div>

<p>Et on vérifie que les tests passent.</p>

<p>Le <code class="language-plaintext highlighter-rouge">2</code> est aussi une duplication, mais elle vient d’une autre ligne du test : <code class="language-plaintext highlighter-rouge">cinq.fois(2)</code>. COmençons donc pas déplacer notre 2 dans la méthode <code class="language-plaintext highlighter-rouge">fois</code>pour voir si c’est possible :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*=</span> <span class="mi">2</span>

</code></pre></div></div>

<p>On lance nos tests… et… ça passe !</p>

<p>On peut supprimer le 2 dans le code de la classe <code class="language-plaintext highlighter-rouge">Dollar</code> et supprimer cette duplication :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*=</span> <span class="n">multiplicateur</span>

</code></pre></div></div>

<p>Nos tests continuent de passer et nous n’avons plus de duplication: on peut supprimer la tâche de la todo-list</p>

<h3 id="todo-list-1.3">todo list</h3>

<p>Le test nous pose quelques questions quand à l’utilisation dela classe dollar. Notre todo-list devient :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h4 id="bilan-1">bilan</h4>

<p>La procédure utilisée dans cette étape cera générale :</p>

<ol>
  <li>on crée un test</li>
  <li>on éxécute nos tests et on voit que ça ne marche pas. Le test que l’on vient d’écrire est le seul test qui doit rater : <strong>rouge</strong>
</li>
  <li>on change le code pour que nos tests fonctionne. Le but est que le test passe donc on peut comêtre les pires attrocités pour cela (comme on a fait en mettant directement 10 à montant par exemple). Pour cela, la façon la plus simple est de se laisser guider par l’interpréteur.</li>
  <li>Une fois que les tests passent, on est <strong>vert</strong>. A partir de là, on ne modifiera <strong>jamais</strong> de code si tout les tesrs ne passent pas</li>
  <li>on supprime petit à petit les duplications tout en s’assurant que les tests sont toujours vert</li>
</ol>

<p>La méthode qu’on a utilisé pour faire passer nos tests en duplicant la réponse du test dans le code à un nom :</p>

<blockquote class="note">
  <p><strong>premier pattern du TDD :</strong>
Dupliquer la réponse du test dans le code est la méthode appelée : <strong>fake it</strong>.</p>
</blockquote>

<h2 id="2---value-object">2 - value object</h2>

<p>On veut faire du <strong>clean code that works</strong>. Mais c’est très difficile même pour des très bons codeurs. On va ainsi séparer le problème :</p>

<ol>
  <li>on commence par le <em>that works</em>
</li>
  <li>on fini par le <em>clean code</em>
</li>
</ol>

<blockquote class="note">
  <p>La règle d’un bon code est de procéder par ordre :</p>

  <ol>
    <li>faire du code qui fonctionne</li>
    <li>faire du code propre</li>
    <li>faire du code rapide</li>
  </ol>

  <p>Il ne faut cependant pas s’arrêter à 1, sinon votre code ne sera pas maintenable dans le temps.</p>
</blockquote>

<p>Que faire maintenant ?</p>

<h3 id="todo-list-2.1">todo list</h3>

<p>On choisit <strong>toujours</strong> l’élément le plus simple à faire dans la todo-list. Ici, le quatrième item semble le facileemtn implémentable :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h3 id="faire-2.1">faire</h3>

<p>Pour vérifier que nos 5 dollaors restent 5 dollars, on peut faire un test du style :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">cinq</span><span class="p">.</span><span class="n">fois</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">cinq</span><span class="p">.</span><span class="n">montant</span>

    <span class="n">cinq</span><span class="p">.</span><span class="n">fois</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        
    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">cinq</span><span class="p">.</span><span class="n">montant</span>
</code></pre></div></div>

<blockquote class="a-faire">
  <p>On execute nos tests et — comme attendu — ça rate.</p>
</blockquote>

<p>Ce test n’est cependant pas vraiment satisfaisant pour au moins deux raisons :</p>

<ol>
  <li>cela semble un peut compliqué de changer montant tout en gardant 5 quelque-part</li>
  <li>le code est vraiment étrange. Comment <code class="language-plaintext highlighter-rouge">cinq</code> pourrait-il valloir 15 ?</li>
</ol>

<p>La seconde raison est de loin la plus importante. Notre code est étrange et peu lisible (bref, <em>ça ne sent pas bon</em>). C’est souvent le signe qu’il se passe quelque chose de mal.</p>

<blockquote class="note">
  <p>Le <strong><a href="https://en.wikipedia.org/wiki/Code_smell">code smell</a></strong> est la capacité qu’à un bon développeur de reconnaître un soucis profond juste en lisant l’organisation ou l’utilisation d’un code.</p>

  <p>Le code smell s’acquiert avec le temps, mais vous pouvez acccélérer son accisition en lisant du obon code</p>
</blockquote>

<p>Une façon simple et élégante de régler notre soucis est d’utiliser des objet qui ne peuvent être modifiés.</p>

<blockquote class="note">
  <p>Un objet non modifiable est appelé <a href="https://martinfowler.com/bliki/ValueObject.html"><strong>value object</strong></a>.</p>
</blockquote>

<p>C’est super chouette d’avoir des objets non modifiable, on a pas besoin de faire attention à eux : une fois créés ils ne bougent plus.</p>

<p>Ceci nous permet de les donner à des méthodes inconnues sans avoir peur qu’ils soient modifiés, ou les utiliser dans nos propres méthodes sans craindre qu’ils soient modifiés plus tard. Le seul point négatif d’un value object est que l’on doit regcréer un nouvel objet si on veut le changer. Heureusement, dans la plupart du temps ce n’est pas très coûteux.</p>

<blockquote>
  <p>En python, de nombreux objet sont des values objcet. On peut citer les chaines de caractères, les entiers, les réels ou encore le booleens.</p>

  <p>De plus, de nombreuses stuctures modifiables ont leurs contrepartie non modifiables. Par exemple les <a href="https://docs.python.org/fr/3/library/stdtypes.html">tuples</a> pour les listes ou les <a href="https://docs.python.org/fr/3/library/stdtypes.html">frozenset</a> pour les ensembles.</p>
</blockquote>

<p>Pour un <em>value object</em>, à la place de modifier un objet il faut en rendre un nouveau on en rende un nouveau : la méthode <code class="language-plaintext highlighter-rouge">fois</code> doit rendre un objet. Modifions notre test  :</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">monnaie</span> <span class="kn">import</span> <span class="n">Dollar</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">dix</span> <span class="o">=</span> <span class="n">cinq</span><span class="p">.</span><span class="n">fois</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">dix</span><span class="p">.</span><span class="n">montant</span>

    <span class="n">quinze</span> <span class="o">=</span> <span class="n">cinq</span><span class="p">.</span><span class="n">fois</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">quinze</span><span class="p">.</span><span class="n">montant</span>

</code></pre></div></div>

<p>Le test est bien plus joli : il est lisible et compréhensible. Bon bien sur, ce n’est que le début :</p>

<blockquote class="a-faire">
  <p>On execute nos tests et — comme attendu — ça rate.</p>
</blockquote>

<p>Ce coup ci, pas besoin de grandes manipulations pour faire passer le test. Il faut que la méthode <em>fois</em> rende un objet <code class="language-plaintext highlighter-rouge">Dollar</code>. Si l’implémentation semble évidente, autant la coder de suite (mais après le test !).  On vient de découvrir une autre règle :</p>

<blockquote class="note">
  <p><strong>Second pattern du TDD :</strong> l’implémentation directe du test est appelée : <strong>obvious implementation</strong>.</p>
</blockquote>

<blockquote class="a-faire">
  <p>Faite une implémentation de la méthode <code class="language-plaintext highlighter-rouge">fois</code></p>
</blockquote>

<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>
</code></pre></div></div>

</div></details>

<blockquote class="a-faire">
  <p>On execute nos tests et ça passe !</p>
</blockquote>

<p>On a en même temps fait passer le test et fini l’implémentation.</p>

<h3 id="todo-list-2.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h2 id="3---">3 - <code class="language-plaintext highlighter-rouge">==</code>
</h2>

<p>Pour vérifier que deux objets sont égaux, on ne va pas passer son temps à vérifier que tous leurs attributs soient les mêmes. On va le faire une fois pour toute (ce qui évitera en plus les duplications). On le rajoute donc dans la todo liste :</p>

<h3 id="todo-list-3.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">==</code></strong></li>
</ul>

<h3 id="faire-3.1">faire</h3>

<p>On va utiliser pour cela des méthodes spéciales de python qui permettent d’utiliser les opérateurs <code class="language-plaintext highlighter-rouge">==</code> et <code class="language-plaintext highlighter-rouge">!=</code> même si ce n’est pas pour comparer des entiers. Mais avant d’aller plus loin, les tests.</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>On lance les tests.</p>
</blockquote>

<p>Bien sur, le test rate. Par défaut, lorsque l’on a pas défini de méthode <code class="language-plaintext highlighter-rouge">__eq__</code>, l’opérateur <code class="language-plaintext highlighter-rouge">==</code> regarde si ce sont les mêmes objets, ce qui n’est pas le cas.</p>

<p>L’implémentation n’étant pas forcément évidente :</p>

<blockquote class="a-faire">
  <p>Commençons par faire marcher le test en utilisant la techique <em>fake it</em> :</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>

</div></details>

<p>Avec ce code lorsque l’on écrit <code class="language-plaintext highlighter-rouge">x == y</code>, python le re-écrit en : <code class="language-plaintext highlighter-rouge">x.__eq__(y)</code>. Du coup notre <em>fake it</em> fait passer le test.</p>

<p>Maintenant, les choses sérieuses : on supprime les duplications. On suppose que l’on ne sait pas résoudre le problème. Pour trouver une solution, on utilise le dernier pattern du TDD :</p>

<blockquote class="note">
  <p><strong>Troisième pattern du TDD :</strong> pour supprimer ds duplications non évidente on utilise la <strong>triangulation</strong></p>
</blockquote>

<p>Pour utiliser la triangulation, on écrit deux tests différents pour le même problème : si le test est différent du premier, pour que les deux testent passent en même temps, il faudra supprimer des duplications.</p>

<p>On ajoute alors autant de tests que nécessaire jusqu’à ce que toutes les duplications aient disparues. Les tests que l’on rajoute dépendent donc des duplications que l’on a.</p>

<p>Dans notre cas, on répond toujours <code class="language-plaintext highlighter-rouge">True</code>, on va donc forger un test qui doit répondre <code class="language-plaintext highlighter-rouge">False</code>.</p>

<blockquote class="a-faire">
  <p>Créez un test qui répond <code class="language-plaintext highlighter-rouge">False</code> à l’égalité</p>
</blockquote>

<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<blockquote class="a-faire">
  <p>On lance les tests et maintenant un teste rate.</p>
</blockquote>

<p>La duplication est dans le montant de l’objet.</p>

<blockquote class="a-faire">
  <p>Supprimez la duplication de la méthode <code class="language-plaintext highlighter-rouge">__eq__</code>.</p>
</blockquote>

<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="c1"># ...
</span>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>
</code></pre></div></div>

</div></details>
<blockquote class="a-faire">
  <p>On peut mainteannt re-exécuter le test, qui passe.</p>
</blockquote>

<p>Ce traitement de l’égalité est frustre, on ne vérifie pas :</p>

<ul>
  <li>si l’objet <code class="language-plaintext highlighter-rouge">other</code> a la propriété <code class="language-plaintext highlighter-rouge">montant</code>
</li>
  <li>voir même si l’objet existe (<code class="language-plaintext highlighter-rouge">cinq == None</code> va planter plutôt que de répondre <code class="language-plaintext highlighter-rouge">False</code>)</li>
</ul>

<p>On va pas s’embêter avec ça pour l’instant, mais on va tout de même le rajouter à notre todo list.</p>

<h3 id="todo-list-3.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">==</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ul>

<h2 id="4---__mul__">4 - <code class="language-plaintext highlighter-rouge">__mul__</code>
</h2>

<p>La méthode <code class="language-plaintext highlighter-rouge">__eq__</code> n’est pas la seule utilisée en python pour donner des comportement spéciaux au objets (il en <a href="https://micropyramid.com/blog/python-special-class-methods-or-magic-methods/">existe beaucop d’autres</a>. Notre objet <code class="language-plaintext highlighter-rouge">Dollar</code> devant se comporter plus ou moins comme un nombre, on peut implémenter les <a href="https://diveintopython3.net/special-method-names.html#acts-like-number">méthodes spéciales utiles pour ressembler à des nombres</a>.</p>

<p>Comencçons par implémenter <a href="https://docs.python.org/3/library/operator.html#operator.__mul__"><code class="language-plaintext highlighter-rouge">__mul__</code></a>.</p>

<h3 id="todo-list-4.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">==</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">__mul__</code></strong></li>
</ul>

<h3 id="faire-4.1">faire</h3>

<p>Pour le test, il suffit de modifier le test de la multiplication :</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">dix</span> <span class="o">=</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">dix</span><span class="p">.</span><span class="n">montant</span>

    <span class="n">quinze</span> <span class="o">=</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>

    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">quinze</span><span class="p">.</span><span class="n">montant</span>

<span class="c1"># ...
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>En faire une <em>obvious implementation</em> :</p>
</blockquote>

<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

</code></pre></div></div>

</div></details>

<h3 id="todo-list-4.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">==</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">__mul__</code>
</li>
</ul>

<h2 id="5---privacy">5 - privacy</h2>

<p>Tput est prêt pour travailler sur l’attribut <code class="language-plaintext highlighter-rouge">montant</code>.</p>

<h3 id="todo-list-5.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item"><strong>[-] utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">==</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">__mul__</code>
</li>
</ul>

<h3 id="faire-5.1">faire</h3>

<p>Il ne manque pas grand chose pour que <code class="language-plaintext highlighter-rouge">montant</code> soit privé. Il suffit de ne pas en parler dans les tests et de ne comparer que des objets entres eux :</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">dix</span> <span class="o">=</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">dix</span>

    <span class="n">quinze</span> <span class="o">=</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">quinze</span>

<span class="c1">#... 
</span></code></pre></div></div>

<p>On peut même encore faire plus joli :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1">#... 
</span></code></pre></div></div>

<p>Notez que l’on a utilisé une fonctionnalité que l’on vient de créer (<code class="language-plaintext highlighter-rouge">__mul__</code>) pour améliorer un test. C’est normal les tests et le code forment une seule entité.</p>

<blockquote class="attention">
  <p>Maintenant si 2 tests plantent en même temps (si le <code class="language-plaintext highlighter-rouge">==</code> commence à rater par exemple), il faudra se rappeler quel est le test qui plante et les tests qui ne fonctionnent plus.</p>

  <p>Ceci arrive inévitablement.</p>
</blockquote>

<p>On fait petit à petit disparaitre des tests les références explicites à l’implémentation des classes. C’est une bonne pratique.</p>

<blockquote class="note">
  <p><strong>Test pattern :</strong> Lorsque l’on teste, il est important de toujours tester du point de vue de l’utilisation. Il faut éviter le plus possible de tester des attebiuts internes à la classe.</p>
</blockquote>

<h3 id="todo-list-5.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">==</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">__mul__</code>
</li>
</ul>

<h2 id="fin-de-la-partie-1">Fin de la partie 1</h2>

<h3 id="todo-list-fin-1">todo list</h3>

<p>On peut épurer notre todo-list en supprimant les items déjà résolus. On obtient :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ul>

<h3 id="code-fin-1">code</h3>

<p>A la fin de cette partie, on a 2 fichiers.</p>

<h4 id="monnaiepy"><em>“monnaie.py”</em></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

</code></pre></div></div>

<h4 id="test_monnaiepy"><em>“test_monnaie.py”</em></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">monnaie</span> <span class="kn">import</span> <span class="n">Dollar</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
