<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>TDD et test pattern | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="TDD et test pattern">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">
<meta property="og:url" content="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="TDD et test pattern">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique de François Brucker.","@type":"WebPage","author":{"@type":"Person","name":"François Brucker"},"url":"/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html","headline":"TDD et test pattern","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">TDD et test pattern</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span>
  </header>

  <div class="post-content">
    <p>Nous allons dans cette séance suivre ici le livre <a href="https://www.amazon.fr/Test-Driven-Development-Kent-Beck/dp/0321146530/ref=sr_1_1?ie=UTF8&qid=1538720480&sr=8-1&keywords=test+driven+development+by+example">TDD by example</a> de Kent Beck (Suivez son <a href="https://twitter.com/kentbeck">twitter</a>, ses posts sont souvent rigolos et toujours utiles).</p>

<p>Initialement écrit pour le java, nous allons appliquer ses enseignements au python.</p>

<!--more-->

<blockquote class="chemin">
  <p><a href="/cours_informatique/cours/algorithme-code-theorie/">Algorithme, code et théorie</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/">code</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/">programmation objet</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">projet : TDD</a></p>

  <p><strong>prérequis :</strong></p>

  <ul>
    <li><a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-heritage.html">projet : héritage</a></li>
  </ul>

</blockquote>

<h2 id="but">But</h2>

<p>En suivant le déroulé du livre <a href="https://www.amazon.fr/Test-Driven-Development-Kent-Beck/dp/0321146530/ref=sr_1_1?ie=UTF8&qid=1538720480&sr=8-1&keywords=test+driven+development+by+example">TDD by example</a>, vous allez apprendre à écrire du code par les tests.
Vous allez y apprendre le <a href="https://naruto.fandom.com/fr/wiki/Nind%C3%B4">nindo</a> de la proatique d’un bon code :</p>

<blockquote class="note">
  <p>Créer du code <strong>propre</strong> qui <strong>fonctionne</strong></p>

  <p>(<em>clean code that works</em> en version originale)</p>
</blockquote>

<p>Outre la méthode, nous verrons également quelques tehcniques pour y arriver de façon claire et pratique, comme des règles de refactoring (issues de <a href="https://www.amazon.fr/Refactoring-Improving-Design-Existing-Code/dp/0201485672/ref=sr_1_2?ie=UTF8&qid=1539066441&sr=8-2">Refactoring: Improving the Design of Existing Code</a> de <a href="https://martinfowler.com">Martin fowler</a> (allez voir son site, y’a moult choses chouettes sur le code, l’agile, la vie et le reste)).</p>

<p>Ceci devrait vous permettre de diminuer le nombre de WTFs/minute, qui est le meilleur indicateur au monde d’un bon code (issu du livre <a href="https://www.amazon.fr/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">clean code</a> de <a href="https://fr.wikipedia.org/wiki/Robert_C._Martin">Robert C. Martin</a>. Ce n’est pas un livre pour débutant mais si vous avez déjà compris le tdd, c’est un super pour finaliser votre compréhension) :</p>

<p><img src="./assets/wtfm.jpg" alt="WTFs/minute" style="margin: auto;display: block"></p>

<blockquote class="note">
  <p>Faites l’effort de suivre cette séance en codant <strong>en même temps</strong> le projet. Tout est donné mais le voir fonctionner pour de vrai est plus impressionnant que de juste le lire.</p>
</blockquote>

<p>On va exécuter les tests un gazillion de fois. Pour eviter la luxation de l’index il faut retenir les raccourcis claviers qui vont vous permettre de lancer les tests sans problème :</p>

<ul>
  <li>dédiez un terminal pour cela. Une fois la commande tapée, il vous suffit de faire <em>flèche du haut</em> pour revenir à la commande précédente et l’exécuter</li>
  <li>lorsque vos tests passent, il est intéressant d’utiliser le raccourci clavier de votre éditeur pour exécuter tous les tests (sous <a href="https://docs.microsoft.com/fr-fr/visualstudio/ide/default-keyboard-shortcuts-in-visual-studio?view=vs-2022#bkmk_test-global-shortcuts">vscode</a>).</li>
</ul>

<h2 id="projet">Projet</h2>

<p>Vous allez créer dans cette séance une application de change entre Franc suisse (CHF) et dollars US ($).</p>

<table>
  <thead>
    <tr>
      <th>qui</th>
      <th>combien</th>
      <th>prix</th>
      <th>total</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Apple</td>
      <td>1000</td>
      <td>$200</td>
      <td>$200 000</td>
    </tr>
    <tr>
      <td>Nestlé</td>
      <td>400</td>
      <td>80 CHF</td>
      <td>32 000 CHF</td>
    </tr>
    <tr>
      <td colspan="3">
</td>
      <td><strong>total</strong></td>
      
      
    </tr>
  </tbody>
</table>

<p>Avec le taux de conversion : 1 CHF = $0.5</p>

<h2 id="comment-">Comment ?</h2>

<p>En programmant par les tests bien sur !</p>

<p>On commence par une todo list qui regroupe tout ce que l’on pense faire pour l’instant. Cette liste va diminuer lorsque l’on avancera sur le projet et grossir lorsque notre connaissance du projet va s’affiner.</p>

<p>Nous n’utiliserons pas ici notre code. Mais il faudra tout faire <em>from scratch</em>. On aura donc besoin :</p>

<ul>
  <li>d’une todo list où tous nos items à faire pour l’instant sont écrit : le <em>backlog</em>
</li>
  <li>de fichiers de tests</li>
  <li>du code</li>
</ul>

<p>On verra tout au long du cours divers patterns de test et de développement pour que tout aille pour le mieux. Notre but est ici de faire du :</p>

<blockquote class="note">
  <p><em>clean code that works</em></p>
</blockquote>

<p>Pour cela on va se fixer quelques règles :</p>

<ul>
  <li>on écrit du code que si un test rate</li>
  <li>on élimine les duplications</li>
</ul>

<p>Ces 2 règles impliquent un mode de fonctionnement de note production code :</p>

<blockquote class="note">

  <ol>
    <li>
<strong>rouge</strong> :
      <ul>
        <li>écrire <em>rapidement</em> un <em>petit</em> test</li>
        <li>lancer les tests et les voir planter, voir même  ne correspondre à aucun code.</li>
      </ul>
    </li>
    <li>
<strong>vert</strong> :
      <ul>
        <li>écrire le code <em>minimal</em> qui permet de faire passer le test</li>
        <li>lancer les tests et les voir tous réussir</li>
      </ul>
    </li>
    <li>
<strong>refactor</strong> :
      <ul>
        <li>élimine les duplications tout en conservant la validité des tests.</li>
      </ul>
    </li>
  </ol>

</blockquote>

<p>Cela permet de prendre du plaisir à coder :</p>

<ul>
  <li>en écrivant du code dont est sûr qu’il ne cassera rien</li>
  <li>en voyant la todo list diminuer ce qui montre qu’on progresse</li>
  <li>comme tous les tests sont conservés on sait que l’on ne travaille pas pour rien</li>
</ul>

<blockquote class="note">
  <p>Toutes ces règles visent à diminuer la peur qui bloque tout progrès</p>
</blockquote>

<h2 id="code">Code</h2>

<p>On va développer petit à petit notre propre application de change en utilisant le TDD. La logique est :</p>

<ul>
  <li>chaque test couvre un petit ajout d’une fonctionnalité</li>
  <li>la première chose à faire sera de (rapidement et salement) faire fonctionner les tests</li>
  <li>toute les modifications de code sont effectuées alors que les testent passent</li>
  <li>le refactoring est fait par petites touches</li>
</ul>

<h3 id="1---départ">1 - départ</h3>

<h4 id="faire-1.1">faire</h4>

<p>Commençons par noter ce qu’il faut faire pour que notre application de change fonctionne :</p>

<ul>
  <li>il faut plusieurs devises (ici CHF et $)</li>
  <li>il faut multiplier les devises par des nombres (nb actions * prix)</li>
</ul>

<p>Cette todo-list (ou <em>backlog</em>) nous indique :</p>

<ol>
  <li>
<strong>ce qu’il faut faire</strong> : dès que on voit une tâche à faire qui n’est pas dans la todo list, on la rajoute,</li>
  <li>
<strong>ce sur quoi on travaille</strong> : on travaillera toujours sur <strong>un unique</strong> item à la fois</li>
  <li>
<strong>ce que l’on a fait</strong> : il n’y a rien de plus satisfaisant que de barrer une ligne que l’on vient de finir.</li>
</ol>

<blockquote class="a-faire">
  <ol>
    <li>Créez un nouveau projet sous vscode dans un dossier que vos appellerez <em>“projet-tdd”</em>.</li>
    <li>On a besoin que d’un unique fichier pour l’instant : <em>“test_change.py”</em>.</li>
    <li>Prenez également une feuille de papier pour vos todos.</li>
  </ol>

</blockquote>

<h4 id="todo-list-1.1">todo list</h4>

<p>Première todo-list :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 * 2 = \$10</li>
</ul>

<h4 id="faire-1.2">faire</h4>

<p>Par quoi on commence ?</p>

<p><strong>PAR UN TEST !</strong></p>

<p>La bonne question n’est donc pas “que fait-on en premier” mais :</p>

<p><strong>Que teste-t-on en premier ?</strong></p>

<p>La deuxième ligne semble la plus simple. Donc allons-y, mettons en <strong>gras</strong> l’item de la todo list qu’on veut faire :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item"><strong>[ ] \$5 * 2 = \$10</strong></li>
</ul>

<p>Puis :</p>

<blockquote class="a-faire">
  <p>codons un test qui  valide cette item dans le fichier <em>“test_change.py”</em></p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">monnaie</span> <span class="kn">import</span> <span class="n">Dollar</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">cinq</span><span class="p">.</span><span class="n">fois</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">cinq</span><span class="p">.</span><span class="n">montant</span>
</code></pre></div></div>

<p>Nous n’avons pas encore écrit de classe <code class="language-plaintext highlighter-rouge">Dollar</code>, mais on l’utilise déjà…</p>

<blockquote class="note">
  <p>En TDD on utilise notre code avant de l’écrire. Avoir une idée de comment utiliser le code nous donne une idée de comment il doit fonctionner.</p>
</blockquote>

<p>L’écriture de notre test (un cas d’utilisation de la classe dollar qui valide l’item courant de la todo-list) nous montre des choses que l’on doit pouvoir faire, et par là augmente notre todo-list avec des choses à implémenter ou des questions auxquelles il va falloir répondre un jour.</p>

<h4 id="todo-list-1.2">todo list</h4>

<p>Le test nous pose quelques questions quand à l’utilisation dela classe dollar. Notre todo-list devient :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item"><strong>[ ] \$5 * 2 = \$10</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h4 id="faire-1.3">faire</h4>

<p>Rien ne marche avec nos tests lorsqu’on les exécute via le terminal :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>» python <span class="nt">-m</span> pytest test_change.py
<span class="o">========================</span> <span class="nb">test </span>session starts <span class="o">=========================</span>
platform darwin <span class="nt">--</span> Python 3.9.9, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: /projet-tdd
plugins: dash-1.19.0, cov-3.0.0
collected 0 items / 1 error

<span class="o">==============================</span> ERRORS <span class="o">================================</span>
__________________ ERROR collecting test_change.py ___________________
ImportError <span class="k">while </span>importing <span class="nb">test </span>module <span class="s1">'/projet-tdd/test_change.py'</span><span class="nb">.</span>
Hint: make sure your <span class="nb">test </span>modules/packages have valid Python names.
Traceback:
/python3.9/importlib/__init__.py:127: <span class="k">in </span>import_module
    <span class="k">return </span>_bootstrap._gcd_import<span class="o">(</span>name[level:], package, level<span class="o">)</span>
test_change.py:1: <span class="k">in</span> &lt;module&gt;
    from money import Dollar
E   ModuleNotFoundError: No module named <span class="s1">'monnaie'</span>
<span class="o">======================</span> short <span class="nb">test </span>summary info <span class="o">=======================</span>
ERROR test_change.py
<span class="o">!!!!!!!!!!!!!!!</span> Interrupted: 1 error during collection <span class="o">!!!!!!!!!!!!!!!</span>
<span class="o">=========================</span> 1 error <span class="k">in </span>0.13s <span class="o">===========================</span>
</code></pre></div></div>

<p>Ca en fait des erreurs !</p>

<p>Mais c’est une chance, car les messages d’erreurs vont nous permettre de faire un programme qui fonctionne. Il suffit de les supprimer une à une.</p>

<blockquote class="note">
  <p>Apprenez à <strong>lire</strong> les messages d’erreurs !</p>

  <p>Il est est souvent plus simple d’exécuter un code et de lire ce qui ne marche pas plutôt qe de réfléchir pour savoir si ça va fonctionner.</p>
</blockquote>

<p>On va donc lire attentivement les messages d’erreurs de python et les régler petit à petit. Un message d’erreur <strong>est informatif</strong> si on se force à les lire.</p>

<p>Nos tests ratent à cause d’une erreur. On le voit à cette ligne :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E   ModuleNotFoundError: No module named 'monnaie'
</code></pre></div></div>

<p>L’erreur est explicite :</p>

<blockquote class="a-faire">
  <p>Créez un fichier <em>“monnaie.py”</em> vide dans le projet.</p>
</blockquote>

<p>On relance nos tests et maintenant l’erreur est :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E   ImportError: cannot import name 'Dollar' from 'monnaie' (/projet-tdd/monnaie.py)
</code></pre></div></div>

<p>Encore une fois, l’erreur est explicite : il n’existe pas de module <code class="language-plaintext highlighter-rouge">monnaie</code>. Créons en un :</p>

<blockquote class="a-faire">
  <p>Créez une classe <code class="language-plaintext highlighter-rouge">Dollar</code> vide dans le fichier <em>“monnaie.py”</em>.</p>
</blockquote>

<p>Pour créer une classe vide, il suffit de mettre une unique instruction <code class="language-plaintext highlighter-rouge">pass</code> (qui ne fait rien mais permet de ne pas faire d’erreur lorsque l’on crée un bloc sans instructions) :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">pass</span>
</code></pre></div></div>

<p>On relance nos tests et maintenant l’erreur (toujours explicite) est :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def test_multiplication():
&gt;       cinq = Dollar(5)
E       TypeError: Dollar() takes no arguments
</code></pre></div></div>

<p>Qu’à cela ne tienne, ajoutons un argument à la création de dollar :</p>

<blockquote class="a-faire">
  <p>Ajoutez un argument à la création d’un objet de la classe <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
      <span class="k">pass</span>

</code></pre></div>  </div>

</blockquote>

<p>On relance nos tests et maintenant :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>E       AttributeError: 'Dollar' object has no attribute 'fois'
</code></pre></div></div>

<p>On sait faire, on ajoute une méthode vide pour que cette erreur disparaisse :</p>

<blockquote class="a-faire">
  <p>Ajoutez une méthode <code class="language-plaintext highlighter-rouge">fois</code> vide dans la classe <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">pass</span>

</code></pre></div>  </div>

</blockquote>

<p>On relance nos tests et… encore une erreur. Heureusement, comme toutes les autres elle est facile à résoudre :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def test_multiplication():
        cinq = Dollar(5)
        cinq.fois(2)
    
&gt;       assert 10 == cinq.montant
E       AttributeError: 'Dollar' object has no attribute 'montant'
</code></pre></div></div>

<p>On voit de plus que <code class="language-plaintext highlighter-rouge">montant</code>doit être égal à 10, donc vite vite, on corrige cette erreur :</p>

<blockquote class="a-faire">
  <p>Ajoutez un attribut <code class="language-plaintext highlighter-rouge">montant</code> qui vaut 10 à tout objet <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

  <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">pass</span>

</code></pre></div>  </div>

</blockquote>

<p>On relance nos tests et…</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>» python -m pytest test_change.py
======================== test session starts =========================
platform darwin -- Python 3.9.9, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
rootdir: /projet-tdd
plugins: dash-1.19.0, cov-3.0.0
collected 1 item
test_change.py .

========================== 1 passed in 0.01s =========================
</code></pre></div></div>

<p><strong>Incroyable !</strong> Nos tests passent (c’est émouvant).</p>

<blockquote class="note">
  <p>Corriger petit à petit un test pour qu’il passe ne nécessite presque pas d’intelligence. Il suffit de se laisser guider par l’interpréteur python.</p>
</blockquote>

<h4 id="faire-1.4">faire</h4>

<p><strong>Halte là !</strong> Ce n’est pas fini.</p>

<p>Nos tests passent mais il reste un étape à faire : <strong>refactor</strong> : <em>supprimer les duplications</em>.</p>

<p>La première duplication évidente est le nombre <code class="language-plaintext highlighter-rouge">10</code> du test qui est dupliqué avec le <code class="language-plaintext highlighter-rouge">10</code> du <code class="language-plaintext highlighter-rouge">self.montant</code>. Comme on en a l’habitude maintenant, on va supprimer cette duplication petit à petit :</p>

<p>Après chaque modification, on s’assure que les tests passent : on ne modifie du code que si tout est vert. Ceci nous assure que l’on ne casse pas le programme.</p>

<p>Dans la classe <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># ...
</span></code></pre></div></div>

<p>Le <code class="language-plaintext highlighter-rouge">10</code> est en fait un <code class="language-plaintext highlighter-rouge">5 * 2</code> (On crée au départ $5).</p>

<p>On effectue la modification :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># ...
</span></code></pre></div></div>

<p>Et on lance nos tests pour vérifier que rien n’est cassé.</p>

<p>Le <code class="language-plaintext highlighter-rouge">5</code> qu’on vient de rajouter est aussi une duplication du test <code class="language-plaintext highlighter-rouge">cinq = Dollar(5)</code>. Modifions alors le code :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span> <span class="o">*</span> <span class="mi">2</span>

    <span class="c1"># ...
</span></code></pre></div></div>

<p>Et on vérifie que les tests passent.</p>

<p>Le <code class="language-plaintext highlighter-rouge">2</code> est aussi une duplication, mais elle vient d’une autre ligne du test : <code class="language-plaintext highlighter-rouge">cinq.fois(2)</code>. COmençons donc pas déplacer notre 2 dans la méthode <code class="language-plaintext highlighter-rouge">fois</code>pour voir si c’est possible :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*=</span> <span class="mi">2</span>

</code></pre></div></div>

<p>On lance nos tests… et… ça passe !</p>

<p>On peut supprimer le 2 dans le code de la classe <code class="language-plaintext highlighter-rouge">Dollar</code> et supprimer cette duplication :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">fois</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*=</span> <span class="n">multiplicateur</span>

</code></pre></div></div>

<p>Nos tests continuent de passer et nous n’avons plus de duplication: on peut supprimer la tâche de la todo-list</p>

<h4 id="todo-list-1.3">todo list</h4>

<p>Le test nous pose quelques questions quand à l’utilisation dela classe dollar. Notre todo-list devient :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h4 id="bilan-1">bilan</h4>

<p>La procédure utilisée dans cette étape cera générale :</p>

<ol>
  <li>on crée un test</li>
  <li>on éxécute nos tests et on voit que ça ne marche pas. Le test que l’on vient d’écrire est le seul test qui doit rater : <strong>rouge</strong>
</li>
  <li>on change le code pour que nos tests fonctionne. Le but est que le test passe donc on peut comêtre les pires attrocités pour cela (comme on a fait en mettant directement 10 à montant par exemple). Pour cela, la façon la plus simple est de se laisser guider par l’interpréteur.</li>
  <li>Une fois que les tests passent, on est <strong>vert</strong>. A partir de là, on ne modifiera <strong>jamais</strong> de code si tout les tesrs ne passent pas</li>
  <li>on supprime petit à petit les duplications tout en s’assurant que les tests sont toujours vert</li>
</ol>

<p>La méthode qu’on a utilisé pour faire passer nos tests en duplicant la réponse du test dans le code à un nom :</p>

<blockquote class="note">
  <p>Dupliquer la réponse du test dans le code est la méthode appelée : <strong>fake it</strong>.</p>
</blockquote>

<h3 id="2---value-object">2 - value object</h3>

<p>On veut faire du <strong>clean code that works</strong>. Mais c’est très difficile même pour des très bons codeurs. On va ainsi séparer le problème :</p>

<ol>
  <li>on commence par le <em>that works</em>
</li>
  <li>on fini par le <em>clean code</em>
</li>
</ol>

<blockquote class="code">
  <p>La règle d’un bon code est de procéder par ordre :</p>

  <ol>
    <li>faire du code qui fonctionne</li>
    <li>faire du code propre</li>
    <li>faire du code rapide</li>
  </ol>

  <p>Il ne faut cependant pas s’arrêter à 1, sinon votre code ne sera pas maintenable dans le temps.</p>
</blockquote>

<p>Que faire maintenant ?</p>

<h4 id="todo-list-2.1">todo list</h4>

<p>On choisit <strong>toujours</strong> l’élément le plus simple à faire dans la todo-list. Ici, le quatrième item semble le facileemtn implémentable :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>\$5 * 2 = \$10</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utiliser <code class="language-plaintext highlighter-rouge">montant</code> ? Le rendre privé (le cacher à l’utilisateur (ici les tests))</li>
  <li class="task-list-item"><strong>[ ] <code class="language-plaintext highlighter-rouge">cinq == $10</code> (ce n’est pas vraiment super car nos \$5 initiaux valent maintenant \$10). rendre <code class="language-plaintext highlighter-rouge">Dollar</code> non modifiable</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
</ul>

<h4 id="faire-2.1">faire</h4>

<blockquote class="tbd">
  <p>ici</p>
</blockquote>

<p>Rendre des objets non mutable : des <em>value object</em> c’est super chouette. On a plus besoin de faire attention à eux. Une fois créés ils ne bougent plus. On peut donc les donner à des méthodes inconnues sans avoir peur qu’ils soient modifiés, ou les utiliser dans nos propres méthodes sans craindre qu’ils soient modifiés plus tard.</p>

<p>Si l’on veut modifier un value objet, il faut en créer un autre. Heureusement, dans la plupart du temps ce n’est pas très coûteux.</p>

<h4 id="testspy">tests.py</h4>

<p>On voudrait pouvoir multiplier plein de fois différentes nos dollars et que ça ne pose pas de soucis. Genre :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">five</span><span class="p">.</span><span class="n">amount</span>

    <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        
    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">five</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<p>Mais comme ça c’est pas possible : <em>value objects</em> to the rescue :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>        
    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<p>Pour être sur que notre objet n’est pas modifié, il faut faire 2 test à la suite.</p>

<h4 id="moneypy">money.py</h4>

<p>Ce coup ci, pas besoin de grandes manipulations : il faut que la méthode <em>times</em> rende un objet <code class="language-plaintext highlighter-rouge">Dollar</code>. Si l’implémentation semble évidente, autant la coder de suite (mais après le test !).  On vient de découvrir une autre règle du TDD pour faire passer des tests (on va en utiliser 3) : <strong>obvious implementation</strong> (on change directement le code).</p>

<p>Si le code à mettre n’est pas évident, on utilise la première règle, le <strong>fake it</strong> où l’on remplace petit à petit les duplications.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="tbd">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
</ul>

<h3 id="3---">3 - <code class="language-plaintext highlighter-rouge">==</code>
</h3>

<p>Pour vérifier que deux objets sont égaux, on ne va pas passer son temps à vérifier que tous leurs attributs soient les même. On va le faire une fois pour toute (ce qui évite les duplications). On le rajoute donc dans le tbd :</p>

<h4 id="tbd-1">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><strong>==</strong></li>
</ul>

<p>On va utiliser pour cela des méthodes spéciales de python qui permettent d’utiliser les opérateurs <code class="language-plaintext highlighter-rouge">==</code> et <code class="language-plaintext highlighter-rouge">!=</code> même si on est pas des entiers. Mais avant d’aller plus loin, les tests.</p>

<h4 id="testspy-1">tests.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<p>Bien sur, le test rate. Par défaut, lorsque l’on a pas défini de méthode <code class="language-plaintext highlighter-rouge">__eq__</code> et <code class="language-plaintext highlighter-rouge">__ne__</code>, l’opérateur <code class="language-plaintext highlighter-rouge">==</code> regarde si ce sont les mêmes objets, ce qui n’est pas le cas.</p>

<h4 id="moneypy-1">money.py</h4>

<p>Faisons passer le test :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
</code></pre></div></div>

<p>Avec ce code lorsque l’on écrit <code class="language-plaintext highlighter-rouge">x == y</code>, python le re-écrit en : <code class="language-plaintext highlighter-rouge">x.__eq__(y)</code>. Du coup notre <em>fake it</em> fait passer le test.</p>

<p>Mais ce n’est toujours pas ce que l’on veut. Pour cela on va utiliser la troisième règle du TDD : <strong>triangulation</strong></p>

<h4 id="testspy-2">tests.py</h4>

<p>On utilise la <strong>triangulation</strong> lorsque l’on ne sait pas trop quoi faire pour supprimer les duplications. On écrit alors un autre test pour le même problème. Si le test est différent du premier, pour qu’il passe il faudra supprimer des duplications. On ajoute alors autant de tests qu’il faut jusqu’à ce que les duplications aient disparues. Les tests que l’on rajoute dépendent donc des duplications que l’on a.</p>

<p>Dans notre cas, on répond toujours <code class="language-plaintext highlighter-rouge">True</code>, on va donc forger un test qui doit répondre <code class="language-plaintext highlighter-rouge">False</code> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span><span class="p">.</span><span class="n">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<h4 id="moneypy-2">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<h4>??</h4>

<p>Pour l’instant on ne teste pas si l’objet <code class="language-plaintext highlighter-rouge">other</code> a la propriété <code class="language-plaintext highlighter-rouge">amount</code>. Voir même si l’objet existe (<code class="language-plaintext highlighter-rouge">five == None</code> va planter plutôt que de répondre <code class="language-plaintext highlighter-rouge">False</code>). On va pas s’embêter avec ça pour l’instant, mais on va le rajouter à notre todolist.</p>

<h4 id="tbd-2">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
</ul>

<h4 id="-1">??</h4>

<p>Tiens si on en profitait pour voir toutes les méthodes spéciales que l’on pourrait utiliser ?</p>

<p>http://www.diveintopython3.net/special-method-names.html#acts-like-number</p>

<p>ou</p>

<p>https://micropyramid.com/blog/python-special-class-methods-or-magic-methods/</p>

<p>Pourquoi on n’utiliserait pas <code class="language-plaintext highlighter-rouge">__mul__</code> ?</p>

<h3 id="4---__mul__">4 - <code class="language-plaintext highlighter-rouge">__mul__</code>
</h3>

<h4 id="tbd-3">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><strong><code class="language-plaintext highlighter-rouge">__mul__</code></strong></li>
</ul>

<h4 id="testspy-3">tests.py</h4>

<p>On va modifier le test de multiplication.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="mi">10</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="mi">15</span> <span class="o">==</span> <span class="n">product</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<p>Pour python écrire <code class="language-plaintext highlighter-rouge">five * 3</code> est équivalent à <code class="language-plaintext highlighter-rouge">five.__mul__(3)</code>. C’est l’objet de gauche qui est utilisé.</p>

<h4 id="moneypy-3">money.py</h4>

<p>C’est assez simple pour être <strong>obvious implementation</strong> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

     <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
        
     <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
         <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<h4 id="tbd-4">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
</ul>

<h3 id="5---privacy">5 - privacy</h3>

<h4 id="tbd-5">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><strong>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</strong></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
</ul>

<p>Il ne manque pas grand chose pour que amount soit privé. Il suffit de ne pas en parler dans les tests. On peut le faire car dans la multiplication, on veut que <code class="language-plaintext highlighter-rouge">five * 2</code> soit égal à 10 dollars par exemple. Faisons le :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">product</span>

    <span class="n">product</span> <span class="o">=</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">product</span>
</code></pre></div></div>

<p>On peut même encore faire plus joli :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>Notez que l’on a utilisé une fonctionnalité que l’on vient de créer pour améliorer un test. C’est normal les tests et le code forment une seule entité.</p>

<p>Maintenant si 2 tests plantent en même temps (si le <code class="language-plaintext highlighter-rouge">==</code> commence à rater par exemple), il faudra se rappeler quel est le test qui plante et les tests qui ne fonctionnent plus.</p>

<h4 id="tbd-6">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
</ul>

<h3 id="6----les-francs">6 -  les Francs</h3>

<p>Le seul item dans la todolist qui ne soit pas de l’optimisation est <em>5 + 2.5CHF = $10 si le taux de change est 1:.5</em>. Cela semble bien trop ambitieux pour une seule étape. On va la découper, en commençant par introduire les CHF :</p>

<h4 id="tbd-7">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><strong>5 CHF * 2 = 10CHF</strong></li>
</ul>

<h4 id="testspy-4">tests.py</h4>

<p>On va dupliquer le test des dollars pour les Francs :</p>

<ul>
  <li>heureusement qu’on a un peu modifier les tests avant, non ?</li>
  <li>on a le droit de commettre les pires péchés pour faire marcher le projet (that works), ensuite on fait les choses bien (clean code)</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    
<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-4">money.py</h4>

<p>Idem que pour les tests, on copie/colle :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Franc</span><span class="p">:</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

     <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
        
     <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
         <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>
 
 
 <span class="k">class</span> <span class="nc">Dollar</span><span class="p">:</span>
     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
         <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

     <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
         <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
        
     <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
         <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>
</code></pre></div></div>

<h4 id="tbd-8">tbd</h4>

<p>tous les péchés doivent être expiés, on rajoute donc ce qu’il faut corriger dans la todo list.</p>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del><code class="language-plaintext highlighter-rouge">==</code></del></li>
  <li><code class="language-plaintext highlighter-rouge">== None</code></li>
  <li>
<code class="language-plaintext highlighter-rouge">==</code> autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li>même <code class="language-plaintext highlighter-rouge">==</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
</ul>

<h3 id="7---même---pour-tous">7 - même <code class="language-plaintext highlighter-rouge">==</code>  pour tous</h3>

<h4 id="tbd-9">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del><code class="language-plaintext highlighter-rouge">==</code></del></li>
  <li><code class="language-plaintext highlighter-rouge">== None</code></li>
  <li>
<code class="language-plaintext highlighter-rouge">==</code> autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><strong>même <code class="language-plaintext highlighter-rouge">==</code></strong></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
</ul>

<h4 id="-2">??</h4>

<p>Pour avoir le même égal on va essayer d’avoir une unique classe qui la contienne. On pourrait faire hériter une monnaie réelle de l’autre mais c’est pas super. Autant faire une classe abstraite qui les englobe tous les 2.</p>

<h4 id="moneypy-5">money.py</h4>

<p>On va faire pas à pas la modification d’ajout d’une classe mère aux deux classes et entre chaque étape on vérifie que les tests passent toujours.</p>

<ol>
  <li>ajout de la classe Money qui ne fait rien</li>
  <li>ajout de money comme classe mère de <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ol>

<p>Maintenant on va faire monter les méthodes identiques des classes filles à la classe mère.</p>

<ol>
  <li>
<code class="language-plaintext highlighter-rouge">__init__</code> est identique : on le remonte</li>
  <li>
<code class="language-plaintext highlighter-rouge">__eq__</code> est identique : on ne peut cependant pas le remonter car on ne teste pas l’égalité des Francs entres eux.</li>
  <li>on rajoute le test des Francs entres eux et on en profite pour rajouter un todo sur la comparaison entre Franc et Dollar. On ne le fait pas tout de suite car on a pas fini notre item. ON ne fait qu’une chose à la fois sinon plus rien ne fonctionne. On se rappelle qu’on ne <strong>code que sur du vert</strong>.</li>
  <li>on copie colle les tests du dollar</li>
</ol>

<h4 id="testspy-5">tests.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    
<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-6">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="tbd-10">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li>compare Franc et Dollar</li>
</ul>

<h3 id="8----franc-et-dollar">8 -  Franc et Dollar</h3>

<h4 id="tbd-11">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li><strong>compare Franc et Dollar</strong></li>
</ul>

<h4 id="testspy-6">tests.py</h4>

<p>Allons-y pour un petit test en plus</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    
<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-7">money.py</h4>

<p>Une façon simple de corriger cela est de rajouter le fait que les 2 objets à comparer soient de la même classe : la classe d’un objet est l’attribut spécial <code class="language-plaintext highlighter-rouge">__class__</code> présent dans chaque objet.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Attention, ceci n’est pas du tout une bonne façon de coder. Votre <strong>code smell</strong> (qui vient avec le temps) devrait vous avertir. Notre comparateur utilise ce que sont les devise d’un point de vue de python (deux classes différentes) pas d’un point de vue de la finance (devise ?). Ce n’est jamais bon. Ca risque (va) nous sauter à la figure tôt ou tard. On rajoute donc un todo pour montrer que cela nous embête tout de même un peu.</p>

<h4 id="tbd-12">tbd</h4>

<p>tous les péchés doivent être expiés, on rajoute donc ce qu’il faut corriger dans la todo list.</p>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li><del>compare Franc et Dollar</del></li>
  <li>utilisation de devise ?</li>
</ul>

<h3 id="9----duplication-francdollar">9 -  Duplication Franc/Dollar</h3>

<h4 id="tbd-13">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><strong>duplication Franc/dollar</strong></li>
  <li><del>même ==</del></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li><del>compare Franc et Dollar</del></li>
  <li>utilisation de devise ?</li>
</ul>

<h4 id="-3">??</h4>

<p>Les 2 implémentations de <code class="language-plaintext highlighter-rouge">__mul__</code> ont l’air extrêmement semblables. La seule chose qui les sépare est le retour soir d’un Franc soit d’un Dollar. En allant par là, l’existence même des 2 classes est sujette à caution : est-il vraiment utile d’avoir 2 classes juste pour une comparaison ?</p>

<p>Donc pour réunifier les 2 classes en une seule, on va commencer par gommer leurs existences dans les tests. Commençons par supprimer la classe dollar en passant par un factory dans le test <code class="language-plaintext highlighter-rouge">test_dollar_multiplication()</code></p>

<h4 id="testspy-7">tests.py</h4>

<p>Allons-y pour un petit test en plus</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>
<span class="kn">import</span> <span class="nn">money</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    
<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-8">money.py</h4>

<p>Un factory de la classe <code class="language-plaintext highlighter-rouge">Dollar</code> dans <code class="language-plaintext highlighter-rouge">money.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Les tests passent (en ajoutant l’import des factory) ! Donc on remplace toute référence à <code class="language-plaintext highlighter-rouge">Dollar</code> en <code class="language-plaintext highlighter-rouge">money.dollar</code> dans les tests</p>

<h4 id="testspy-8">tests.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Franc</span>
<span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>Avant de faire la même chose pour les Francs, posons nous la question de l’utilité de garder ces tests. Ont-ils une utilité dans le code ? Pas sûr puisque on ne fait plus qu’une seule classe, mais dons le doute on les conserve, mais on l’ajoute à la todo list.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>On est maintenant dans une meilleure position qu’au début. Le code utilisateur n’étant pas au courant qu’il existe 2 classes différentes. On va pouvoir passer à la suite du programme les supprimer également dans le code.</p>

<h4 id="tbd-14">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><strong>duplication Franc/dollar</strong></li>
  <li><del>même ==</del></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li>compare Franc et Dollar</li>
  <li>utilisation de devise ?</li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<h4 id="moneypy-9">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="10---devises">10 - devises</h3>

<p>Pour pouvoir supprimer les 2 sous classes, il va nous falloir un moyen de distinguer les Francs des Dollars. Donc autant travailler sur l’ajout d’une devise.</p>

<h4 id="tbd-15">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
    <ul>
      <li>presque identique.</li>
    </ul>
  </li>
  <li>compare Franc et Dollar</li>
  <li><strong>utilisation de devise ?</strong></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<h4 id="testspy-9">tests.py</h4>

<p>On ajoute un test pour vérifier que les dollars et les francs ont des devises différentes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_currencies</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>
    
    
<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-10">money.py</h4>

<p>une <em>obvious implementation</em> plus tard :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"CHF"</span>

<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"USD"</span>
</code></pre></div></div>

<p>On peut maintenant travailler à faire monter les currencies au niveau de <code class="language-plaintext highlighter-rouge">Money</code>. Commençons par les faire monter au niveu des classes. On va créer un attribut <code class="language-plaintext highlighter-rouge">currency</code> dans chaque classe et l’utiliser dans les méthodes. Il faut pour cela redescendre les <code class="language-plaintext highlighter-rouge">__init__</code> dans chaque classe.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Afin de faire remonter l’attribut <code class="language-plaintext highlighter-rouge">currency</code> dans la classe Money, on va commencer par dire que currency est un paramètre des <code class="language-plaintext highlighter-rouge">__init__</code>. Comme toute devise est créé avec le factory, ça devrait passer et nous permettre ensuite de ne faire plus qu’une seule classe puisque seuls les paramètres des méthodes vont différer.</p>

<p>En ajoutant le paramètre les tests plantent ! C’est parce que l’on a oublié d’ajouter un paramètre aux factory :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<p>Les tests plantent encore… C’est parce que <code class="language-plaintext highlighter-rouge">__mul__</code> n’utilise pas le factory :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Ouf, les tests passent. On peut faire pareil pour dollar :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Il nous reste plus qu’à utiliser le paramètre <code class="language-plaintext highlighter-rouge">currency</code> des constructeurs dans les factory. Les classes se ressemblent de plus en plus :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Le <code class="language-plaintext highlighter-rouge">__init__</code> est re le même, ainsi que <code class="language-plaintext highlighter-rouge">currencies</code>on peut les bouger dans money (courage on y est presque) :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Tout est prêt pour maintenant supprimer les sous-classes.</p>

<h4 id="tbd-16">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
    <ul>
      <li>presque identique.</li>
    </ul>
  </li>
  <li>compare Franc et Dollar</li>
  <li><del>utilisation de devise ?</del></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<p>Ici, utiliser une tâche annexe (les devises) nous a permis d’avancer vers notre but : supprimer les sous classes.</p>

<h3 id="11----unification-de-">11 -  unification de <code class="language-plaintext highlighter-rouge">*</code>
</h3>

<p>Tout est prêt pour unifier les <code class="language-plaintext highlighter-rouge">__mul__</code> et ainsi faire disparaitre les dernières différences entre les 2 classes.</p>

<h4 id="tbd-17">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li><strong><code class="language-plaintext highlighter-rouge">*</code> presque identique.</strong></li>
  <li>compare Franc et Dollar</li>
  <li><del>utilisation de devise ?</del></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<h4 id="moneypy-11">money.py</h4>

<p>Les deux <code class="language-plaintext highlighter-rouge">__mul__</code> ne changent que par la classe produite. Donc commençons par expliciter la construction en remplaçant le factory par l’utilisation explicite des constructeurs :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>On peut maintenant ajouter une méthode <code class="language-plaintext highlighter-rouge">__mul__</code> das la classe money :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>En supprimant la methode <code class="language-plaintext highlighter-rouge">__mul__</code> des Francs, et en rendant un <code class="language-plaintext highlighter-rouge">Money</code> dans le factory <code class="language-plaintext highlighter-rouge">franc</code>, les tests passent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>Mais supprimer la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> de <code class="language-plaintext highlighter-rouge">Dollar</code> casse les tests : le test d’égalité est cassé. C’est normal il compare des classes et pas des <code class="language-plaintext highlighter-rouge">currency</code>. On revient donc en arrière jusqu’à ce que les tests passes (on remet la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> à <code class="language-plaintext highlighter-rouge">Dollar</code>) puis on corrige la méthode <code class="language-plaintext highlighter-rouge">__eq__</code> pour qu’elle compare les <code class="language-plaintext highlighter-rouge">currency</code> plutôt que les classes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>On peut maintenant supprimer la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> de <code class="language-plaintext highlighter-rouge">Dollar</code> et ainsi supprimer les 2 classes. ON vient de supprimer 2 items en un seul refactoring.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="tbd-18">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><del>duplication Franc/dollar</del></li>
  <li><del>même ==</del></li>
  <li>~~ * presque identique.~~</li>
  <li>compare Franc et Dollar</li>
  <li><del>utilisation de devise ?</del></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<p>Maintenant les tests d’égalité et de multiplication des <code class="language-plaintext highlighter-rouge">Franc</code> sont vraiment inutiles puisque le code est le même que celui de dollar :</p>

<h4 id="testspy-10">tests.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_currencies</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-12">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="tbd-19">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><del>duplication Franc/dollar</del></li>
  <li><del>même ==</del></li>
  <li><del>* presque identique.</del></li>
  <li><del>compare Franc et Dollar</del></li>
  <li><del>utilisation de devise ?</del></li>
  <li><del>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</del></li>
</ul>

<h3 id="raz-de-la-todo-list">RAZ de la todo list</h3>

<p>On est arrivé à un point clé de notre projet. La classe <code class="language-plaintext highlighter-rouge">Money</code> permet de gérer plusieurs devises et de multiplier les montant par un entier.</p>

<p>A partir de maintenant, on va vous laisser un peu plus libre.</p>

<p>On va épurer la todo list en supprimant les améliorations possibles de <code class="language-plaintext highlighter-rouge">==</code> et la gestion des arrondis (que l’on vous laisse en exercice :-)) :</p>

<h4 id="tbd-20">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
</ul>

<h3 id="addition-13">Addition 1/3</h3>

<p>Avant de traiter l’addition de deux monnaies différentes, commençons par traiter le cas de 1 unique monnaie :</p>

<h4 id="tbd-21">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><strong>$5 + $5 = $10</strong></li>
</ul>

<p>Commençons par écrire un test permettant de tester que $5 + $5 = $10 en supposant que :</p>

<ul>
  <li>on utilise la méthode <code class="language-plaintext highlighter-rouge">plus</code> de <code class="language-plaintext highlighter-rouge">Money</code> qui rend un objet <code class="language-plaintext highlighter-rouge">Money</code>
</li>
  <li>les objets de la classe <code class="language-plaintext highlighter-rouge">Money</code> sont toujours non mutables</li>
</ul>

<p>Ce test réalisé, on l’oplémente (une obvious implémentation devrait suffire)</p>

<h4 id="testspy-11">tests.py</h4>

<p>On a ajouté le test ci-après à la batterie de test précédent</p>

<pre><code class="language-pyhton">def test_sum():
    sum = money.dollar(5).plus(money.dollar(5))

    assert money.dollar(10) == sum
</code></pre>

<h4 id="moneypy-13">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="addition">addition</h4>

<p>Tout comme <code class="language-plaintext highlighter-rouge">__mul__</code> il existe une méthode en python pour gérer l’addition : <code class="language-plaintext highlighter-rouge">__add__</code>. On modifie nos tests et le code pour l’utiliser.</p>

<h4 id="testspy-12">tests.py</h4>

<p>On a ajouté le test ci-après à la batterie de test précédent</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_sum</span><span class="p">():</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sum</span>
</code></pre></div></div>

<h4 id="moneypy-14">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="addition-23">Addition 2/3</h3>

<p>Notre implémentation de <code class="language-plaintext highlighter-rouge">+</code> qui rend un objet de type <code class="language-plaintext highlighter-rouge">Money</code> ne sera pas tenable longtemps. En effet <code class="language-plaintext highlighter-rouge">$5 + 2.5CHF</code> ne peut être un objet de type <code class="language-plaintext highlighter-rouge">Money</code>. Ce sont deux devises différentes qui vont avoir une valeur dépendant du cours actuel, qui va fluctuer sans cesse. Il faut donc résoudre deux problèmes :</p>

<ul>
  <li>comment stocker plusieurs devises</li>
  <li>comment convertir une monnaie ou un ensemble de monnaies en une autre.</li>
</ul>

<h4 id="tests-py">tests. py</h4>

<p>Pour imaginer cela rien de mieux qu’un test ! On va l’écrire à l’envers, en partant du résultat, car  on sait où on veut arriver : à $10 :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_simple_addition</span><span class="p">():</span>
    <span class="c1"># ...
</span>    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">reduced</span>
</code></pre></div></div>

<p>Ces $10 viennent d’une conversion en dollar d’une somme de deux monnaies, conversion qui – d’un point de vue métier – ne peut venir que d’une banque</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_simple_addition</span><span class="p">():</span>
    <span class="c1"># ...
</span>    <span class="n">reduced</span> <span class="o">=</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">reduced</span>
</code></pre></div></div>

<p>Banque qu’il faut créer :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_simple_addition</span><span class="p">():</span>
    <span class="c1"># ...
</span>    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">reduced</span> <span class="o">=</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">reduced</span>
</code></pre></div></div>

<p>Il ne reste plus qu’à fabriquer notre expression pur avoir notre test final :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_simple_addition</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">five</span> <span class="o">+</span> <span class="n">five</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">reduced</span> <span class="o">=</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="nb">sum</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">reduced</span>
</code></pre></div></div>

<h4 id="moneypy-15">money.py</h4>

<p>On fake le tout pour avoir un test qui passe et du pain sur la planche pour plus tard.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Bank</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="addition-33">Addition 3/3</h3>

<p>L’implémentation réelle de tout ce qu’on a <em>faké</em> n’est pas si évidente que ça. On va donc devoir faire des choix restrictifs et ajouter à la todo list les généralisations à effectuer pour terminer le travail.</p>

<p>On va considérer que toute somme de deux monnaies est une nouvelle classe somme (on va cependant ajouter que la somme de 2 monnaies identiques devrait rendre une monnaie dans la todo list).</p>

<p>Donc :</p>

<ul>
  <li>on ajoute que la somme de deux monnaies $ devrait donner des $ dans la todo list</li>
  <li>on supprime du coup le test <code class="language-plaintext highlighter-rouge">test_sum</code> qui vérifie que $5 + $5 = $10 ce qui n’est plus vrai.</li>
  <li>on ajoute un test pour montrer que la somme de deux monnaies est un objet contenant une partie gauche (la partie à gauche du <code class="language-plaintext highlighter-rouge">+</code>) et une partie droite (la partie à droite du <code class="language-plaintext highlighter-rouge">+</code>).</li>
</ul>

<p>Une fois ceci fait, on implémente le tout en <em>obvious implementation</em>.</p>

<h4 id="tbd-22">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><strong>$5 + $5 = quelque chose qui correspond à $10</strong></li>
  <li>$5 + $5 devrait rendre une Money</li>
</ul>

<h4 id="tests-py-1">tests. py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_plus_returns_sum</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">three</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="n">five</span> <span class="o">+</span> <span class="n">three</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">.</span><span class="n">left</span> <span class="o">==</span> <span class="n">five</span>
    <span class="k">assert</span> <span class="nb">sum</span><span class="p">.</span><span class="n">right</span> <span class="o">==</span> <span class="n">three</span>
</code></pre></div></div>

<h4 id="moneypy-16">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="c1"># ... 
</span>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Sum</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span>
</code></pre></div></div>

<h4 id="reduce-13">reduce 1/3</h4>

<p>Il faut faire en sorte de trianguler pour l’implémentation de la méthode <code class="language-plaintext highlighter-rouge">reduce</code> de la banque (pour l’instant c’est un <em>fake</em> qui rend 10 dollar). Maintenant elle prend en paramètre une somme. On va donc faire un test qui vérifiera que <code class="language-plaintext highlighter-rouge">bank.reduce(money.dollar(3) + money.dollar(4), "USD")</code> rende bien 7 dollars.</p>

<p>En implémentant la méthode (après avoir écrit le test bien sur), on considérera que la partie gauche et droite de la somme sont de la monnaie du deuxième paramètre pour l’instant.</p>

<p>En faisant cette implémentation, on va rajouter un todo pour noter que l’on doit aussi implémenter <code class="language-plaintext highlighter-rouge">Bank.reduce</code> pour un objet de type Money (et pas juste pour les sommes)</p>

<h4 id="tbd-23">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><strong>$5 + $5 = quelque chose qui correspond à $10</strong></li>
  <li>$5 + $5 devrait rendre une <code class="language-plaintext highlighter-rouge">Money</code>
</li>
  <li><code class="language-plaintext highlighter-rouge">Bank.reduce(Money)</code></li>
</ul>

<h4 id="tests-py-2">tests. py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_bank_reduce_sum</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="s">"USD"</span><span class="p">)</span>
</code></pre></div></div>
<h4 id="moneypy-17">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Bank</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">expression</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span> <span class="n">expression</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="reduce-23">reduce 2/3</h4>

<p>Implémenter juste la méthode <code class="language-plaintext highlighter-rouge">reduce</code> pour la banque pose quelques problèmes. En particulier : la banque doit connaître l’implémentation de Money pour avoir accès à l’attribut amount.</p>

<p>Pour cela on va déplacer le corps de la méthode <code class="language-plaintext highlighter-rouge">reduce</code> de la <code class="language-plaintext highlighter-rouge">Bank</code> à <code class="language-plaintext highlighter-rouge">Sum</code>. Banque ne fera qu’appeler la méthode de <code class="language-plaintext highlighter-rouge">Sum</code>. Pour l’instant on ne va considérer qu’un seul paramètre pour la méthode <code class="language-plaintext highlighter-rouge">reduce</code> de <code class="language-plaintext highlighter-rouge">Sum</code>, la devise d’arrivée (on rajoutera la banque comme paramètre plus tard, lorsque l’on utilisera effectivement des conversions. On place tout de même cette fonctionnalité dans la todo list pour ne pas l’oublier).</p>

<h4 id="moneypy-18">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Bank</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expression</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Sum</span><span class="p">:</span>
    <span class="c1"># ... 
</span>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="reduce-33">reduce 3/3</h4>

<p>L’étape précédente a permis de baisser le niveau de connaissance de la banque des objets qui l’entourent. C’est une bonne chose. Un bon programme utilise plein d’objets qui interagissent entre eux mais qui ne connaissent pas l’implémentation des autres classes. Les objets doivent être le plus découplé possible.</p>

<p>Monter le reduce au niveau de <code class="language-plaintext highlighter-rouge">Sum</code> nous permet également de traiter le cas où Bank.reduce à une Money comme paramètre. Il suffit de rajouter  une méthode <code class="language-plaintext highlighter-rouge">reduce</code> à Money !</p>

<p>Pour faire cela, on commence par faire un test où l’argument de reduce pour la banque est un objet de type <code class="language-plaintext highlighter-rouge">Money</code> puis on écrit le code correspondant. De même que précédemment, on va considérer que le seul paramètre de la méthode <code class="language-plaintext highlighter-rouge">reduce</code> pour <code class="language-plaintext highlighter-rouge">Money</code> est la devise d’arrivée et on ajoute dans la todo list qu’il faudra implémenter une conversion si nécessaire.</p>

<h4 id="tbd-24">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 + $5 = quelque chose qui correspond à $10</del></li>
  <li>$5 + $5 devrait rendre une Money</li>
  <li><del>Bank.reduce(Money)</del></li>
  <li>Sum.reduce avec conversion</li>
  <li>Money.reduce avec conversion</li>
</ul>

<h4 id="tests-py-3">tests. py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_reduce_money</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"USD"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="moneypy-19">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="c1"># ...
</span>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></div>

<h3 id="taux-de-change-12">Taux de change 1/2</h3>

<p>On va maintenant s’attaquer à la conversion. Commençons simple avec les objets de type <code class="language-plaintext highlighter-rouge">Money</code></p>

<h4 id="tbd-25">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 + $5 = quelque chose qui correspond à $10</del></li>
  <li>$5 + $5 devrait rendre une Money</li>
  <li><del>Bank.reduce(Money)</del></li>
  <li>Sum.reduce avec conversion</li>
  <li><strong>Money.reduce avec conversion</strong></li>
</ul>

<p>On va écrire un test permettant de gérer le change :</p>

<ul>
  <li>on veut convertir $2 en CHF</li>
  <li>le taux de change que l’on ajoute à la banque lors du test. par exemple 1CHF -&gt; $2 (on y est presque en réalité)</li>
</ul>

<p>Il faut donc ajouter une méthode <code class="language-plaintext highlighter-rouge">add_rate</code> à la banque dont les paramètres pourraient être la monnaie d’origine, la monnaie d’arrivée et le taux de change.</p>

<p>Une fois le test créé, on implémente le tout. En commençant par un fake, puis petit à petit on ajoute la bonne implémentation. Cela peut être long car il vous faudra déterminer comment fonctionne le taux de change.</p>

<h4 id="tbd-26">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 + $5 = quelque chose qui correspond à $10</del></li>
  <li>$5 + $5 devrait rendre une Money</li>
  <li><del>Bank.reduce(Money)</del></li>
  <li>Sum.reduce avec conversion</li>
  <li><del>Money.reduce avec conversion</del></li>
</ul>

<h4 id="tests-py-4">tests. py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_reduce_money_conversion</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">bank</span><span class="p">.</span><span class="n">add_rate</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_identity_rate</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="n">rate</span><span class="p">(</span><span class="s">"USD"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="moneypy-20">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Bank</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expression</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_currency</span><span class="p">,</span> <span class="n">to_currency</span><span class="p">,</span> <span class="n">rate</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_rate</span><span class="p">[(</span><span class="n">from_currency</span><span class="p">,</span> <span class="n">to_currency</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rate</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">_rate</span><span class="p">[(</span><span class="n">to_currency</span><span class="p">,</span> <span class="n">from_currency</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rate</span>

    <span class="k">def</span> <span class="nf">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_currency</span><span class="p">,</span> <span class="n">to_currency</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">from_currency</span> <span class="o">==</span> <span class="n">to_currency</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">_rate</span><span class="p">[(</span><span class="n">from_currency</span><span class="p">,</span> <span class="n">to_currency</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="c1"># ... 
</span>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">bank</span><span class="p">.</span><span class="n">rate</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">,</span> <span class="n">currency</span><span class="p">),</span> <span class="n">currency</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">Sum</span><span class="p">:</span>
    <span class="c1"># ... 
</span>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>    
</code></pre></div></div>

<h3 id="taux-de-change-22">Taux de change 2/2</h3>

<p>Pour l’instant notre conversion pour les sommes ne considère que les mêmes devises. On va travailler maintenant sur des devises différentes.</p>

<p>On va écrire un test pour convertir une somme de 2 devises différentes. Puis implémentez le tout.</p>

<h4 id="tbd-27">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 + $5 = quelque chose qui correspond à $10</del></li>
  <li>$5 + $5 devrait rendre une Money</li>
  <li><del>Bank.reduce(Money)</del></li>
  <li><del>Sum.reduce avec conversion</del></li>
  <li><del>Money.reduce avec conversion</del></li>
</ul>

<h4 id="tests-py-5">tests. py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_sum_reduce_different_currency</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">bank</span><span class="p">.</span><span class="n">add_rate</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="s">"CHF"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="moneypy-21">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sum</span><span class="p">:</span>
    <span class="c1"># ... 
</span>    <span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="n">left_money</span> <span class="o">=</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">left</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
        <span class="n">right_money</span> <span class="o">=</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">right</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">left_money</span><span class="p">.</span><span class="n">amount</span> <span class="o">+</span> <span class="n">right_money</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="expressions">Expressions</h3>

<p>Pour finir, il nous reste à généraliser le tout. C’est à dire que l’on aimerait bien pouvoir multiplier une <code class="language-plaintext highlighter-rouge">Sum</code> par un entier par exemple ou additionner des <code class="language-plaintext highlighter-rouge">Sum entre elles</code>.</p>

<p>A priori, une partie de la somme de sommes est déjà implémentée. 
Par exemple le test suivant doit passer :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_sum_of_sum_1</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">bank</span><span class="p">.</span><span class="n">add_rate</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>
</code></pre></div></div>

<p>Mais pas celui là :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_sum_of_sum_2</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">bank</span><span class="p">.</span><span class="n">add_rate</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>
</code></pre></div></div>

<p>Pourquoi ?</p>

<p>(réfléchissez un peu)</p>

<p>Implémentons la solution.</p>

<h4 id="moneypy-22">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sum</span><span class="p">:</span>
    <span class="c1"># ... 
</span>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="testspy-13">tests.py</h4>

<p>Il ne reste plus qu’à tester la multiplication</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">test_sum_of_sum</span><span class="p">():</span>
    <span class="n">bank</span> <span class="o">=</span> <span class="n">Bank</span><span class="p">()</span>
    <span class="n">bank</span><span class="p">.</span><span class="n">add_rate</span><span class="p">(</span><span class="s">"CHF"</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">bank</span><span class="p">.</span><span class="nb">reduce</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="moneypy-23">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Sum</span><span class="p">:</span>
    <span class="c1"># ...
</span>    
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Sum</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">left</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">right</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
