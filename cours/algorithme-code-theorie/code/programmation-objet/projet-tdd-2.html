<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>TDD et test pattern : partie 2/3 | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="TDD et test pattern : partie 2/3">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">
<meta property="og:url" content="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">
<meta property="og:site_name" content="cours d’informatique">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="TDD et test pattern : partie 2/3">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"François Brucker"},"description":"Support de cours/td d’informatique de François Brucker.","headline":"TDD et test pattern : partie 2/3","url":"/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">TDD et test pattern : partie 2/3</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span>
  </header>

  <div class="post-content">
    <p>Partie 2/3.</p>

<!--more-->

<blockquote class="chemin">
  <p><a href="/cours_informatique/cours/algorithme-code-theorie/">Algorithme, code et théorie</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/">code</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/">programmation objet</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">projet : TDD</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">partie 2/3</a></p>

  <p><strong>prérequis :</strong></p>

  <ul>
    <li><a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-1.html">partie 1/3</a></li>
  </ul>

</blockquote>

<h2 id="principe-du-tdd">Principe du TDD</h2>

<p>On rappelle le principe du TDD :</p>

<blockquote class="note">
  <p><strong>Principe du TDD :</strong></p>

  <ol>
    <li>
<strong>rouge</strong> :
      <ul>
        <li>écrire <em>rapidement</em> un <em>petit</em> test</li>
        <li>lancer les tests et les voir planter, voir même  ne correspondre à aucun code.</li>
      </ul>
    </li>
    <li>
<strong>vert</strong> :
      <ul>
        <li>écrire le code <em>minimal</em> qui permet de faire passer le test</li>
        <li>lancer les tests et les voir tous réussir</li>
      </ul>
    </li>
    <li>
<strong>code/refactor</strong> :
      <ul>
        <li>élimine les duplications tout en conservant la validité des tests.</li>
      </ul>
    </li>
  </ol>

  <p>La partie refactor, qui est la partie réelle où l’on code ne se fait <strong>que sur du vert</strong> : on est assuré de ne pas casser le code puisque les tests passent.</p>
</blockquote>

<p>Cela va être bien présent dans cette partie ou l’on va drastiquement modifier notre code. On va créer des tests qui seront notre filet de sécurité puis une fois que tout est vert on codera <strong>tout en conservant le vert</strong>.</p>

<p>Cela permet, en plus d’avoir un feedback immédiat en cas d’erreur (les tests ne passent plus on est <strong>rouge</strong>), d’avoir confiance dans ce que l’on code (si c’est vert c’est quo’n a rien cassé).</p>

<h2 id="todo-list-initiale">todo list initiale</h2>

<p>On reprend la todo list de la fin de la partie 1 :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ul>

<h2 id="6----les-francs">6 -  les Francs</h2>

<p>Le seul item dans la todo list qui ne soit pas de l’optimisation est : \$5 + 2.5CHF = \$10 si le taux de change est 1:.5.</p>

<p>Cela semble bien trop ambitieux pour une seule étape. On va la découper, en commençant par introduire les CHF.</p>

<h3 id="todo-list-6.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item"><strong>[-] 5 CHF * 2 = 10CHF</strong></li>
</ul>

<h3 id="faire-6.1">faire</h3>

<p>On est habitué depuis la première partie, on commence par faire un test. Ici, on ne va pas trop s’embêter : on va dupliquer le test des dollars pour les Francs.</p>

<ul>
  <li>heureusement qu’on a un peu modifier les tests avant, non ?</li>
  <li>on a le droit de commettre les pires péchés pour faire marcher le projet (<em>that works</em>), ensuite on fait les choses bien (<em>clean code</em>)</li>
</ul>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_multiplication_dollar</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_multiplication_franc</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1"># ... 
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>Faite fonctionner les tests en copiant/collant de <code class="language-plaintext highlighter-rouge">Dollar</code> une classe <code class="language-plaintext highlighter-rouge">Franc</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="todo-list-6.2">todo list</h3>

<p>Tous les péchés qui ont été commis pour faire passer le test doivent être expiés. Pour s’en rappeler, on rajoute  ce qu’il faut corriger dans la todo list.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
</ul>

<p>Notez que même s’il n’y pas de duplication proprement dite entre les deux méthode <code class="language-plaintext highlighter-rouge">__mul__</code> elles sont trop semblable pour être honnêtes. On rajoute donc un item dans la todo list pour voir si à un moment donné il ne faudra pas les unifier.</p>

<h2 id="7---même---pour-tous">7 - même <code class="language-plaintext highlighter-rouge">==</code>  pour tous</h2>

<h3 id="todo-list-7.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item"><strong>[-] même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
</ul>

<h3 id="faire-7.1">faire</h3>

<p>Pour avoir le même égal on va essayer d’avoir une unique classe qui la contienne. On pourrait faire hériter une monnaie réelle de l’autre mais c’est pas super (qui serait la classe principale ?).</p>

<p>Autant faire une classe abstraite qui les englobe tous les 2. On va ajouter pas à pas une classe mère aux deux classes <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code>.</p>

<blockquote class="a-faire">
  <ol>
    <li>Vérifiez que les tests passent</li>
    <li>ajoutez une classe <code class="language-plaintext highlighter-rouge">Monnaie</code> qui ne fait rien</li>
    <li>Vérifiez que les tests passent</li>
    <li>faites hériter <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code> de la classe <code class="language-plaintext highlighter-rouge">Monnaie</code>
</li>
    <li>Vérifiez que les tests passent</li>
  </ol>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># ...
</span>
</code></pre></div></div>

</div></details>

<p>Maintenant on va faire monter les méthodes identiques des classes filles à la classe mère.</p>

<blockquote class="a-faire">
  <p>La méthode <code class="language-plaintext highlighter-rouge">__init__</code> est identique : remontez la dans la classe mère</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>



<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># pas de méthode __init__
</span>    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># pas de méthode __init__
</span>    <span class="c1"># ...
</span>
</code></pre></div></div>

</div></details>

<p>Attention, même si la méthode <code class="language-plaintext highlighter-rouge">__eq__</code> est identique pour les deux classe, on ne teste pas encore l’égalité ou non entre 2 <code class="language-plaintext highlighter-rouge">Franc</code>, on ne sait donc pas si le mouvement de <code class="language-plaintext highlighter-rouge">__eq__</code> dans la classe mère va se passer sans problème.</p>

<blockquote class="a-faire">
  <p>Ajoutez des tests d’égalité et de différence pour les Francs</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>On se rend compte que l’on ne teste pas l’inégalité entre <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code> : <strong>on ne le fait pas tout de suite</strong>, car on a pas fini notre item de la todo list</p>

<blockquote class="note">
  <p><strong>Test pattern :</strong> On ne fait pas 2 choses en même temps. On résout chaque item de la todo  list les uns à la suite des autres.</p>
</blockquote>

<p>En revanche, comme il va falloir le faire :</p>

<blockquote class="a-faire">
  <p>ajoutez la comparaison entre franc et dollar dans la todo list</p>
</blockquote>

<h3 id="todo-list-7.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item"><strong>[-] même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>compare Franc et Dollar</li>
</ul>

<h3 id="faire-7.2">faire</h3>

<p>Tout est prêt pour finaliser notre item :</p>

<blockquote class="a-faire">
  <p>Remontez la méthode <code class="language-plaintext highlighter-rouge">__eq__</code> dans la classe mère.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>
</code></pre></div></div>

</div></details>

<h3 id="todo-list-7.3">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>compare Franc et Dollar</li>
</ul>

<h2 id="8----franc-et-dollar">8 -  Franc et Dollar</h2>

<p>On peut maintenant s’occuper de la tâche que l’on vient de rajouter.</p>

<h3 id="todo-list-8.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item"><strong>[-] compare Franc et Dollar</strong></li>
</ul>

<h3 id="faire-8.1">faire</h3>

<blockquote class="a-faire">
  <p>Ajoutez un test qui vérifie que des francs ne sont pas des dollars</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et les tests ratent ! En effet, selon <code class="language-plaintext highlighter-rouge">__eq__</code> les Francs <strong>sont</strong> des dollars.</p>

<p>Une façon simple de corriger cela est de rajouter le fait que les 2 objets à comparer soient de la même classe.</p>

<p>En python, la classe d’un objet est l’attribut spécial <code class="language-plaintext highlighter-rouge">__class__</code> présent dans chaque objet.</p>

<blockquote>
  <p>Modifiez le code de <code class="language-plaintext highlighter-rouge">__eq__</code> pour vérifier que les classes des 2 objets sont bien différentes.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<blockquote class="attention">
  <p>Votre <strong>code smell</strong> doit être en alerte maximale !</p>
</blockquote>

<p>Ceci n’est en effet pas du tout une bonne façon de coder. Notre comparateur utilise ce que sont les devise d’un point de vue de python (deux classes différentes) pas d’un point de vue de la finance (devise ?). Ce n’est jamais bon. Ça risque (va) nous sauter à la figure tôt ou tard.</p>

<blockquote class="note">
  <p>Dans la mesure du possible, votre code doit être écrit du point de vue de ce que représentent les objets codées et non comment ils sont codés</p>
</blockquote>

<p>On rajoute donc un item dans la todo list pour montrer que cela nous embête tout de même un peu.</p>

<h3 id="todo-list-8.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utilisation de devises plutôt que de classes ?</li>
</ul>

<h3 id="9----duplication-francdollar">9 -  Duplication Franc/Dollar</h3>

<h3 id="todo-list-9.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item"><strong>[-] duplication Franc/dollar</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utilisation de devises plutôt que de classes ?</li>
</ul>

<h3 id="faire-9.1">faire</h3>

<p>Les 2 implémentations de <code class="language-plaintext highlighter-rouge">__mul__</code> sont très semblables : la seule chose qui les sépare est leurs retours (un <code class="language-plaintext highlighter-rouge">Franc</code> ou un <code class="language-plaintext highlighter-rouge">Dollar</code>).</p>

<p>C’est même la seule chose qui diffère entre <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code>… L’existence des 2 classes est sujette à caution : est-il vraiment utile d’avoir 2 classes juste pour une comparaison ?</p>

<p><strong>On ne va garder qu’une seule classe</strong>.</p>

<p>Mais avant cela on va s’assurer que les fonctionnalités des <code class="language-plaintext highlighter-rouge">Franc</code> et des <code class="language-plaintext highlighter-rouge">Dollars</code> sont bien toutes représentées dans nos tests, ceci nous permettra de supprimer les classes en confiance : leurs fonctionnalités sont préservées grâce aux tests on ne risque pas de supprimer une fonctionnalité par inadvertance.</p>

<blockquote class="a-faire">
  <p>Regardez les fonctionnalités différentes ajouter un test pour chaque monnaie si ce n’est pas encore fait.</p>
</blockquote>
<details><summary>solution</summary><div>
<p>Il n’y a rien à changer, tous les tests sont fait et pour les <code class="language-plaintext highlighter-rouge">Dollar</code> et pour les <code class="language-plaintext highlighter-rouge">Franc</code>.</p>

</div></details>

<p>POur supprimer des bout de code, il ne faut pas qu’ils soient utilisés. Pour supprimer les classes <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code>, on va ainsi commencer par gommer leurs existences dans les tests (dans l’utilisation du code).</p>

<p>Une fois l’utilisation des classes masquées dans les tests, on pourra les supprimer tranquillement du code en gardant du vert.</p>

<h3 id="faire-9.2">faire</h3>

<p>Gommer supprimer l’utilisation des classes, on va utiliser un design pattern :</p>

<blockquote class="note">
  <p>Un <a href="https://fr.wikipedia.org/wiki/Patron_de_conception">design patterns</a>, ou façons de faire, est pour ainsi dire de l’algorithmie objet. C’est une organisation de classes pratique pour résoudre des problèmes courant en développement.</p>

  <p>Ils permettent de résoudre nombre de problèmes courants en développement et d’éviter les <a href="http://sahandsaba.com/nine-anti-patterns-every-programmer-should-be-aware-of-with-examples.html">erreurs classiques</a>, aussi appelées <a href="https://fr.wikipedia.org/wiki/Antipattern">anti-pattern</a>.</p>
</blockquote>

<p>Le pattern que l’on va utiliser est appelé <strong>factory</strong>, puisqu’il utilise des fonctions pour créer des objets.</p>

<blockquote class="note">
  <p><strong>design pattern :</strong> <a href="https://refactoring.guru/fr/design-patterns/factory-method">factory</a></p>

  <p>On crée les objets via des fonctions sans (ou très peu) de paramètres plutôt qu’avec le constructeur.</p>

  <p>L’intérêt est que l’on a pas à se rappeler de toutes les possibilités du constructeur, les cas classiques d’objets sont directement accessible via une fonction.</p>
</blockquote>

<p>Commençons par tester le <em>factory</em> la classe <code class="language-plaintext highlighter-rouge">Dollar</code>  dans le test <code class="language-plaintext highlighter-rouge">test_multiplication_dollar()</code> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">monnaie</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>
<span class="kn">import</span> <span class="nn">monnaie</span>

<span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_multiplication_dollar</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p>Bien sur nos tests ne passent pas (encore) :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>___________________________________________________
test_multiplication_dollar 
___________________________________________________

    def test_multiplication_dollar():
&gt;       cinq = monnaie.dollar(5)
E       AttributeError: module 'monnaie' has no attribute 'dollar'

test_monnaie.py:6: AttributeError
</code></pre></div></div>

<p>Ici la fonction <code class="language-plaintext highlighter-rouge">dollar</code> définie dans le module <code class="language-plaintext highlighter-rouge">monnaie</code> (le fichier <em>“monnaie.py”</em>) est le
<em>factory</em> des objets de classe <code class="language-plaintext highlighter-rouge">Dollar</code>.</p>

<blockquote class="a-faire">
  <p>Créez la fonction <code class="language-plaintext highlighter-rouge">dollar</code> dans le module <code class="language-plaintext highlighter-rouge">monnaie</code> pour faire passer les tests.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et hop ! Les tests passent : on est sur du vert. On va pouvoir modifier massivement nos tests.</p>

<h3 id="faire-9.3">faire</h3>

<p>Maintenant que notre <em>factory</em> fonctionne (on est sur du vert), on remplace toute référence à <code class="language-plaintext highlighter-rouge">Dollar</code> en <code class="language-plaintext highlighter-rouge">monnaie.dollar</code> dans les tests.</p>

<blockquote class="a-faire">
  <p>Remplacez toute référence à <code class="language-plaintext highlighter-rouge">Dollar</code> par <code class="language-plaintext highlighter-rouge">monnaie.dollar</code> dans les tests</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">monnaie</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>
<span class="kn">import</span> <span class="nn">monnaie</span>


<span class="k">def</span> <span class="nf">test_multiplication_dollar</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_multiplication_franc</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div></div>

</div></details>

<p>Avant de faire la même chose pour <code class="language-plaintext highlighter-rouge">Franc</code>, posons nous la question de l’utilité de garder ces tests. Ont-ils une utilité dans le code ? Pas sûr puisque on ne fait plus qu’une seule classe, mais dons le doute on les conserve, mais on l’ajoute à la todo list.</p>

<h3 id="todo-list-9.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item"><strong>[-] duplication Franc/dollar</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h3 id="faire-9.4">faire</h3>

<p>Maintenant que notre <em>factory</em> fonctionne (on est sur du vert), on remplace toute référence à <code class="language-plaintext highlighter-rouge">Franc</code> en <code class="language-plaintext highlighter-rouge">monnaie.franc</code> dans les tests.</p>

<blockquote class="a-faire">
  <p>Remplacez toute référence à <code class="language-plaintext highlighter-rouge">Franc</code> par <code class="language-plaintext highlighter-rouge">monnaie.franc</code> dans les tests. POur cela procédez comme pour les <code class="language-plaintext highlighter-rouge">Dollar</code>:</p>

  <ol>
    <li>on modifie 1 occurence de <code class="language-plaintext highlighter-rouge">Franc</code>par <code class="language-plaintext highlighter-rouge">monnaie.franc</code>
</li>
    <li>on fait passer les tests.</li>
    <li>Une fois sur du vert on fait la modification en masse.</li>
  </ol>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">monnaie</span>


<span class="k">def</span> <span class="nf">test_multiplication_dollar</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_multiplication_franc</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

</code></pre></div></div>

</div></details>

<p>On est maintenant dans une meilleure position qu’au début pour notre projet d’unifier les classes <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code> puisque Le code utilisateur n’est pas au courant qu’il existe deux classes différentes (grâce au <em>factory</em>).</p>

<p>On va pouvoir passer à la suite qui consiste à les supprimer également dans le code.</p>

<h3 id="todo-list-9.3">todo list</h3>

<p>Il reste des duplications entre Franc et Dollar, mais pour les supprimer il faut passer par quelque chose qui les remplace. Il est donc plus judicieux de faire un autre item de notre liste.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h2 id="10---devises">10 - devises</h2>

<p>Pour pouvoir supprimer les deux classes <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code>, il va nous falloir un moyen de les distinguer. Donc autant travailler sur l’ajout d’une devise.</p>

<h3 id="todo-list-10.1">todo list</h3>

<p>Il reste des duplications entre Franc et Dollar, mais pour les supprimer il faut passer par quelque chose qui les remplace. Il est donc plus judicieux de faire un autre item de notre liste.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item"><strong>[-] utilisation de devises plutôt que de classes ?</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h3 id="faire-10.1">faire</h3>

<p>La classe <code class="language-plaintext highlighter-rouge">Devise</code> que l’on veut créer doit avoir un attribut qui nous permettra de distinguer les <code class="language-plaintext highlighter-rouge">Franc</code> des <code class="language-plaintext highlighter-rouge">Dollar</code>.</p>

<p>Faisons un test pour implémenter cette idée :</p>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_devise</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>

<span class="c1"># ...
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>Faites passer les tests en créant cet attribut dans les classes <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

<p>On implémente cet attribut sous la forme d’un attribut de classe, en le définissant directement dans la classe.</p>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="n">devise</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="c1"># ...
</span>

<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="n">devise</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>On peut maintenant travailler à faire monter les devise au niveau de la classe <code class="language-plaintext highlighter-rouge">Monnaie</code>.</p>

<h3 id="faire-10.2">faire</h3>

<p>L’idée est ici de placer la bonne devise lors dela création de l’objet dans <code class="language-plaintext highlighter-rouge">Monnaie</code>. Pour faire cela dans les règle de l’art on va utiliser un <a href="https://martinfowler.com/books/refactoring.html">pattern de refactoring</a> qui permet de modifier le code sans problème.</p>

<p>On va utiliser :</p>

<blockquote class="note">
  <p><strong>refactoring pattern :</strong> <a href="https://refactoring.guru/fr/pull-up-field">Pull Up Field</a></p>

  <p>Le but est de faire remonter un champ de sous-classes à la classe mère.</p>

  <p>Pour cela, on rend <strong>identique</strong> le champ dans chacune des sous-classes puis on le déplace dans la classe mère.</p>
</blockquote>

<p>En premier lieu :</p>

<blockquote class="a-faire">
  <p>Faite de l’attribut <code class="language-plaintext highlighter-rouge">devise</code> deux attributs affectés chacun affecté dans sa classe</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Afin de faire remonter l’attribut <code class="language-plaintext highlighter-rouge">devise</code> dans la classe <code class="language-plaintext highlighter-rouge">Monnaie</code>, il va falloir ajouter la devise en paramètre du constructeur.</p>

<p>Pour que cela se passe sans risque, on va commencer par juste ajouter le paramètre et voir ce que ça donne :</p>

<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

<p>Et les tests plantent :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    def __init__(self, montant):
&gt;       super().__init__(montant)
E       TypeError: __init__() missing 1 required positional argument: 'devise'

monnaie.py:19: TypeError
</code></pre></div></div>

<p>On a oublié de modifier l’appel au constructeur dans les constructeur des classes.</p>

<blockquote class="a-faire">
  <p>Ajouter devise dans l’appel au <code class="language-plaintext highlighter-rouge">super</code> du constructeur des classes <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et nos tests passent ! On est sur du vert, c’est bien. On peut finir notre refactoring pattern :</p>

<blockquote class="a-faire">
  <p>Faite remonter l’attribut <code class="language-plaintext highlighter-rouge">devise</code> dans <code class="language-plaintext highlighter-rouge">Monnaie</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="n">devise</span>

    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et nos tests passent ! Félicitations, vous avez réussi votre premier refactoring pattern.</p>

<h3 id="faire-10.3">faire</h3>

<p>Pour supprimer les classes, il faut créer nos objets avec la classe <code class="language-plaintext highlighter-rouge">Monnaie</code>. Notre problème est encore un problème de refactoring :</p>

<blockquote class="note">
  <p><strong>refactoring pattern :</strong> <a href="https://refactoring.guru/fr/pull-up-method">Pull Up Method</a></p>

  <p>Le but est de faire remonter une méthode de sous-classes à la classe mère.</p>

  <p>Pour cela, on rend <strong>identique</strong> la méthode dans chacune des sous-classes puis on le déplace dans la classe mère.</p>
</blockquote>

<p>Puisque si les constructeurs sont identique, on pourra facilement créer nos objets avec <code class="language-plaintext highlighter-rouge">Monnaie</code> plutôt qu’avec <code class="language-plaintext highlighter-rouge">Franc</code> ou <code class="language-plaintext highlighter-rouge">Dollar</code>. C’est encore impossible pour l’instant car les constructeurs sont :</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">__init__(self, montant)</code> pour <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li>
<code class="language-plaintext highlighter-rouge">def __init__(self, montant, devise)</code> pour <code class="language-plaintext highlighter-rouge">Devise</code>
</li>
</ul>

<p>On va petit à petit modifier les constructeurs (et les effets de bords dans le code) pour les rendre identique.</p>

<blockquote class="a-faire">
  <p>Ajoutez un champ devise au constructeur de <code class="language-plaintext highlighter-rouge">Franc</code> et lancez les tests.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Les tests donnent :</p>

<pre><code class="language-test">    def franc(montant):
&gt;       return Franc(montant)
E       TypeError: __init__() missing 1 required positional argument: 'devise'

monnaie.py:6: TypeError
</code></pre>

<p>C’est le factory.</p>

<blockquote class="a-faire">
  <p>Modifiez le factory pour qu’il corresponde au constructeur. On donnera <code class="language-plaintext highlighter-rouge">None</code> comme paramètre pour devise.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<blockquote>
  <p>On met <code class="language-plaintext highlighter-rouge">None</code> comme paramètre car comme sa valeur n’est pas utile pour l’instant autant ne pas s’en occuper.</p>
</blockquote>

<p>Les tests ratent toujours :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def __mul__(self, multiplicateur):
&gt;       return Franc(self.montant * multiplicateur)
E       TypeError: __init__() missing 1 required positional argument: 'devise'

monnaie.py:31: TypeError
</code></pre></div></div>

<p>Ah, c’est inattendu… On avait oublié <code class="language-plaintext highlighter-rouge">__mul__</code>: elle n’utilise pas le factory pour créer ses objets.</p>

<blockquote class="a-faire">
  <p>Modifiez la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> de <code class="language-plaintext highlighter-rouge">Franc</code> pour qu’elle utilise le factory.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et nos tests passent !</p>

<blockquote class="a-faire">
  <p>Faites la même chose pour <code class="language-plaintext highlighter-rouge">Dollar</code> en ajoutant un champ devise au constructeur.</p>

  <p>Faites en sorte que les tests passent.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="faire-10.4">faire</h3>

<p>Maintenant que les signatures des constructeurs sont les mêmes, pour finir le travail il faut que le corps des fonctions soient égales.</p>

<blockquote class="a-faire">
  <p>Le second paramètre du constructeur de <code class="language-plaintext highlighter-rouge">Franc</code> est pour l’instant inutile. Rendez le utile en utilisant son factory (la chaine <code class="language-plaintext highlighter-rouge">"CHF"</code> doit aller du factory au constructeur)</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Les tests passent, on peut donc faire pareil avec <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

<blockquote class="a-faire">
  <p>Le second paramètre du constructeur de <code class="language-plaintext highlighter-rouge">Dollar</code> est pour l’instant inutile. Rendez le utile en utilisant son factory (la chaine <code class="language-plaintext highlighter-rouge">"USD"</code> doit aller du factory au constructeur)</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>

<span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">().</span><span class="n">__init__</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Tout est enfin prêt : nos constructeurs sont identiques.</p>

<blockquote class="a-faire">
  <p>Supprimez les constructeurs des classes <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Les testes passent : tout est prêt pour maintenant supprimer les sous-classes.</p>

<h3 id="todo-list-10.2">todo list</h3>

<p>Il reste des duplications entre Franc et Dollar, mais pour les supprimer il faut passer par quelque chose qui les remplace. Il est donc plus judicieux de faire un autre item de notre liste.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h3 id="11----unification-de-">11 -  unification de <code class="language-plaintext highlighter-rouge">*</code>
</h3>

<p>Tout est prêt pour unifier les <code class="language-plaintext highlighter-rouge">__mul__</code> et ainsi faire disparaitre les dernières différences entre les 2 classes.</p>

<h3 id="todo-list-11.1">todo list</h3>

<p>Il reste des duplications entre Franc et Dollar, mais pour les supprimer il faut passer par quelque chose qui les remplace. Il est donc plus judicieux de faire un autre item de notre liste.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item"><strong>[-] <code class="language-plaintext highlighter-rouge">*</code> presque identique</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h3 id="faire-11.1">faire</h3>

<p>Les deux <code class="language-plaintext highlighter-rouge">__mul__</code> ne changent que par le factory utilisé.</p>

<blockquote class="a-faire">
  <p>Remplacez le factory du retour de la méthode par un appel explicite à la classe.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">,</span> <span class="s">"USD)


class Franc(Monnaie):
    def __mul__(self, multiplicateur):
        return Franc(self.montant * multiplicateur; "</span><span class="n">CHF</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>les tests sont toujours Ok. Parfait.</p>

<p>On peut maintenant ajouter une méthode <code class="language-plaintext highlighter-rouge">__mul__</code> dans la classe money :</p>

<blockquote class="a-faire">
  <p>Ajoutez une méthode <code class="language-plaintext highlighter-rouge">__mul__</code> dans <code class="language-plaintext highlighter-rouge">Monnaie</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="n">devise</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>On va maintenant supprimer les méthodes <code class="language-plaintext highlighter-rouge">__mul__</code> des classes filles pour utiliser celle de <code class="language-plaintext highlighter-rouge">Monnaie</code>.</p>

<blockquote class="a-faire">
  <p>Supprimez la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> de la classe <code class="language-plaintext highlighter-rouge">Franc</code> et lancez les tests.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Les tests ratent.</p>

<p>Et oui, on le savait quand on l’a fait que ça allait nous sauter à la figure : c’est le <code class="language-plaintext highlighter-rouge">__eq__</code> et sa comparaison entre classes.</p>

<p>En TDD il est <strong>interdit</strong> de modifier du code alors qu’on est rouge. On revient donc en arrière :</p>

<blockquote class="a-faire">
  <p>Replacez la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> dans <code class="language-plaintext highlighter-rouge">Franc</code> et assurez vous que les tests passent.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Maintenant qu’on est sur du vert, on peut modifier du code :</p>

<blockquote class="a-faire">
  <p>Modifiez <code class="language-plaintext highlighter-rouge">__eq__</code> de <code class="language-plaintext highlighter-rouge">Monnaie</code> pour qu’il utilise l’attribut <code class="language-plaintext highlighter-rouge">devise</code> plutôt que la classe</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">devise</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Les tests repassent ! On peut retenter la suppression de <code class="language-plaintext highlighter-rouge">__mul__</code> :</p>

<blockquote class="a-faire">
  <p>Supprimez la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> dans <code class="language-plaintext highlighter-rouge">Franc</code> et assurez vous que les tests passent.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p><strong>victoire !</strong> Nos tests passent.</p>

<p>On procède de même avec <code class="language-plaintext highlighter-rouge">Dollar</code> :</p>

<blockquote class="a-faire">
  <p>Supprimez la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> dans <code class="language-plaintext highlighter-rouge">Dollar</code> et assurez vous que les tests passent.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Jusqu’à présent tout va bien. On est toujours vert.</p>

<h3 id="todo-list-11.2">todo list</h3>

<p>On a fini un item (<code class="language-plaintext highlighter-rouge">__mul__</code>) et on peut directement enchaîner sur le suivant :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item"><strong>[-] duplication Franc/dollar</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h3 id="faire-11.2">faire</h3>

<p>On se sent en confiance.</p>

<blockquote class="a-faire">
  <p>Utilisez le constructeur de <code class="language-plaintext highlighter-rouge">Monnaie</code>  pour les deux factory.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et enfin :</p>

<blockquote class="a-faire">
  <p>Supprimez les classes <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code></p>
</blockquote>

<h3 id="todo-list-11.3">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h2 id="fin-de-partie">Fin de Partie</h2>

<p>Maintenant les tests d’égalité et de multiplication des <code class="language-plaintext highlighter-rouge">Franc</code> sont vraiment inutiles puisque le code est le même que celui de dollar :</p>

<blockquote class="a-faire">
  <p>Suprimez les tests de concernant les francs.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">monnaie</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_devise</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>

</code></pre></div></div>

</div></details>

<h3 id="todo-list-fin">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked><code class="language-plaintext highlighter-rouge">*</code> presque identique</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>utilisation de devises plutôt que de classes ?</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>supprimer les tests de <code class="language-plaintext highlighter-rouge">Franc</code> ?</li>
</ul>

<h2 id="bilan">bilan</h2>

<p>Vous voyez le développement organique en TDD. On a commencé par deux classes distinctes, puis en codant, on s’est rendu compte qu’elles étaient inutiles et on les a petit à petit supprimées.</p>

<p>Si vous aviez codés sans tests, cela aurait été impossible de réaliser cette opérations en un temps aussi court. De plus, vous n’auriez pas été tenté de le faire car les conséquences auraient pu être dramatique en effet de bord sur le code.</p>

<h3 id="élagage-de-la-todo-list">élagage de la todo list</h3>

<p>En supprimant les items effectués, il nous reste à faire ;</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code> avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ul>

<h3 id="code">code</h3>

<h4 id="test_monnaiepy"><em>“test_monnaie.py”</em></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">monnaie</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_egalite</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_devise</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">monnaie</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">devise</span>

</code></pre></div></div>

<h4 id="monnaiepy"><em>“monnaie.py”</em></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">montant</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="n">montant</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">,</span> <span class="n">devise</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">=</span> <span class="n">devise</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">devise</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Monnaie</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">devise</span><span class="p">)</span>

</code></pre></div></div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
