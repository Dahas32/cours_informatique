<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>TDD et test pattern : partie 2/3 | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="TDD et test pattern : partie 2/3">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">
<meta property="og:url" content="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="TDD et test pattern : partie 2/3">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique de François Brucker.","@type":"WebPage","author":{"@type":"Person","name":"François Brucker"},"url":"/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html","headline":"TDD et test pattern : partie 2/3","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
<script>MathJax={"tex":{"inlineMath":[["$","$"],["\\(","\\)"]],"displayMath":[["\\[","\\]"]]},"svg":{"fontCache":"global"},"svg":{"fontCache":"global"}}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">TDD et test pattern : partie 2/3</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span>
  </header>

  <div class="post-content">
    <p>Partie 2/3.</p>

<!--more-->

<blockquote class="chemin">
  <p><a href="/cours_informatique/cours/algorithme-code-theorie/">Algorithme, code et théorie</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/">code</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/">programmation objet</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd.html">projet : TDD</a> / <a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-2.html">partie 2/3</a></p>

  <p><strong>prérequis :</strong></p>

  <ul>
    <li><a href="/cours_informatique/cours/algorithme-code-theorie/code/programmation-objet/projet-tdd-1.html">partie 1/3</a></li>
  </ul>

</blockquote>

<h2 id="todo-list-initiale">todo list initiale</h2>

<p>On reprend la tdo list de la fin de la partie 1 :</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
</ul>

<h2 id="6----les-francs">6 -  les Francs</h2>

<p>Le seul item dans la todolist qui ne soit pas de l’optimisation est : \$5 + 2.5CHF = \$10 si le taux de change est 1:.5.</p>

<p>Cela semble bien trop ambitieux pour une seule étape. On va la découper, en commençant par introduire les CHF.</p>

<h3 id="todo-list-6.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item"><strong>[-] 5 CHF * 2 = 10CHF</strong></li>
</ul>

<h3 id="faire-6.1">faire</h3>

<p>On est habitué depuis la première partie, on commence par faire un test. Ici, on ne va pas trop s’embêter : on va dupliquer le test des dollars pour les Francs.</p>

<ul>
  <li>heureusement qu’on a un peu modifier les tests avant, non ?</li>
  <li>on a le droit de commettre les pires péchés pour faire marcher le projet (<em>that works</em>), ensuite on fait les choses bien (<em>clean code</em>)</li>
</ul>

<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_multiplication_dollar</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_multiplication_franc</span><span class="p">():</span>
    <span class="n">cinq</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">cinq</span> <span class="o">*</span> <span class="mi">3</span>

<span class="c1"># ... 
</span></code></pre></div></div>

<blockquote class="a-faire">
  <p>Faite fonctionner les tests en copiant/collant de <code class="language-plaintext highlighter-rouge">Dollar</code> une classe <code class="language-plaintext highlighter-rouge">Franc</code></p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<h3 id="todo-list-6.2">todo list</h3>

<p>Tous les péchés qui ont été commis pour faire passer le test doivent être expiés. Pour s’en rappeler, on rajoute  ce qu’il faut corriger dans la todo list.</p>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
</ul>

<p>Notez que même s’il n’y pas de duplication proprement dite entre les deux méthode <code class="language-plaintext highlighter-rouge">__mul__</code> elles sont trop semblable pour être honnêtes. On rajoute donc un item dans la toto-list pour voir si à un moment donné il ne faudra pas les unifier.</p>

<h2 id="7---même---pour-tous">7 - même <code class="language-plaintext highlighter-rouge">==</code>  pour tous</h2>

<h3 id="todo-list-7.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item"><strong>[-] même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
</ul>

<h3 id="faire-7.1">faire</h3>

<p>Pour avoir le même égal on va essayer d’avoir une unique classe qui la contienne. On pourrait faire hériter une monnaie réelle de l’autre mais c’est pas super (qui serait la classe principale ?).</p>

<p>Autant faire une classe abstraite qui les englobe tous les 2. On va ajouter pas à pas une classe mère aux deux classes <code class="language-plaintext highlighter-rouge">Franc</code> et <code class="language-plaintext highlighter-rouge">Dollar</code>.</p>

<blockquote class="a-faire">
  <ol>
    <li>Vérifiez que les tests passent</li>
    <li>ajoutez une classe <code class="language-plaintext highlighter-rouge">Monnaie</code> qui ne fait rien</li>
    <li>Vérifiez que les tests passent</li>
    <li>faites hériter <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code> de la classe <code class="language-plaintext highlighter-rouge">Monnaie</code>
</li>
    <li>Vérifiez que les tests passent</li>
  </ol>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># ...
</span>
</code></pre></div></div>

</div></details>

<p>Maintenant on va faire monter les méthodes identiques des classes filles à la classe mère.</p>

<blockquote class="a-faire">
  <p>La méthode <code class="language-plaintext highlighter-rouge">__init__</code> est identique : remontez la dans la classe mère</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>



<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># pas de méthode __init__
</span>    <span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="c1"># pas de méthode __init__
</span>    <span class="c1"># ...
</span>
</code></pre></div></div>

</div></details>

<p>Attention, même si la méthode <code class="language-plaintext highlighter-rouge">__eq__</code> est identique pour les deux classe, on ne teste pas encore l’égalité ou non entre 2 <code class="language-plaintext highlighter-rouge">Franc</code>, on ne sait donc pas si le mouvement de <code class="language-plaintext highlighter-rouge">__eq__</code> dans la classe mère va se passer sans problème.</p>

<blockquote class="a-faire">
  <p>Ajoutez des tests d’égalité et de différence pour les Francs</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_non_egalite_franc</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>On se rend compte que l’on ne teste pas l’inégalité entre <code class="language-plaintext highlighter-rouge">Dollar</code> et <code class="language-plaintext highlighter-rouge">Franc</code> : <strong>on ne le fait pas tout de suite</strong>, car on a pas fini notre item de la todo list</p>

<blockquote class="note">
  <p><strong>Test pattern :</strong> On ne fait pas 2 choses en même temps. On résoud chaque item de la todo  list les uns à la suite des autres.</p>
</blockquote>

<p>En revanche, comme il va falloir le faire :</p>

<blockquote class="a-faire">
  <p>ajoutez la comparaison entre franc et dollar dans la todo list</p>
</blockquote>

<h3 id="todo-list-7.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item"><strong>[-] même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>compare Franc et Dollar</li>
</ul>

<h3 id="faire-7.2">faire</h3>

<p>Tout est prêt pour finaliser notre item :</p>

<blockquote class="a-faire">
  <p>Remontez la méthode <code class="language-plaintext highlighter-rouge">__eq__</code> dans la classe mère.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">montant</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">=</span> <span class="n">montant</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Monnaie</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">*</span> <span class="n">multiplicateur</span><span class="p">)</span>
</code></pre></div></div>

</div></details>

<h3 id="todo-list-7.3">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>compare Franc et Dollar</li>
</ul>

<h2 id="8----franc-et-dollar">8 -  Franc et Dollar</h2>

<p>On peut maintenant s’occuper de la tâche que l’on vient de rajouter.</p>

<h3 id="todo-list-8.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li class="task-list-item"><strong>[-] compare Franc et Dollar</strong></li>
</ul>

<h3 id="faire-8.1">faire</h3>

<blockquote class="a-faire">
  <p>Ajoutez un test qui vérifie que des francs ne sont pas des dollars</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“test_monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">def</span> <span class="nf">test_franc_dollar</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<p>Et les tests ratent ! En effet, selon <code class="language-plaintext highlighter-rouge">__eq__</code> les Francs <strong>sont</strong> des dollars.</p>

<p>Une façon simple de corriger cela est de rajouter le fait que les 2 objets à comparer soient de la même classe.</p>

<blockquote>
  <p>En python, la classe d’un objet est l’attribut spécial <code class="language-plaintext highlighter-rouge">__class__</code> présent dans chaque objet.</p>
</blockquote>

<blockquote>
  <p>Modifiez le code de <code class="language-plaintext highlighter-rouge">__eq__</code> pour vérifier que les classes des 2 objets sont bien différentes.</p>
</blockquote>
<details><summary>solution</summary><div>
<p><em>“monnaie.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ...
</span>
<span class="k">class</span> <span class="nc">Monnaie</span><span class="p">:</span>
    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">montant</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">montant</span>

    <span class="c1"># ...
</span>
<span class="c1"># ...
</span></code></pre></div></div>

</div></details>

<blockquote class="attention">
  <p>Votre <strong>code smell</strong> doit être en alerte maxiale !</p>
</blockquote>

<p>Ceci n’est en effet pas du tout une bonne façon de coder. Notre comparateur utilise ce que sont les devise d’un point de vue de python (deux classes différentes) pas d’un point de vue de la finance (devise ?). Ce n’est jamais bon. Ca risque (va) nous sauter à la figure tôt ou tard.</p>

<blockquote class="note">
  <p>Dans la mesure du possible, votre code doit être écrit du point de vue de ce que représentent les objets codées et non comment ils sont codés</p>
</blockquote>

<p>On rajoute donc un todo pour montrer que cela nous embête tout de même un peu.</p>

<h3 id="todo-list-8.2">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>duplication Franc/dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utilisation de devises plutôt que de classes ?</li>
</ul>

<h3 id="9----duplication-francdollar">9 -  Duplication Franc/Dollar</h3>

<h3 id="todo-list-9.1">todo list</h3>

<ul class="task-list">
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>\$5 + 2.5CHF = \$10 si le taux de change est 1:.5</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>gestion des arrondis (lorsque les montants seront des réels)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">== None</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">==</code>avec autre chose qu’un <code class="language-plaintext highlighter-rouge">Dollar</code>
</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>5 CHF * 2 = 10CHF</li>
  <li class="task-list-item"><strong>[-] duplication Franc/dollar</strong></li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>même <code class="language-plaintext highlighter-rouge">==</code> (code identique dans 2 classes différentes)</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled><code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled checked>compare Franc et Dollar</li>
  <li class="task-list-item">
<input type="checkbox" class="task-list-item-checkbox" disabled>utilisation de devises plutôt que de classes ?</li>
</ul>

<h3 id="faire-9.1">faire</h3>

<p>Les 2 implémentations de <code class="language-plaintext highlighter-rouge">__mul__</code> sont très semblables : la seule chose qui les sépare est leurs retours (un <code class="language-plaintext highlighter-rouge">Franc</code> ou un <code class="language-plaintext highlighter-rouge">Dollar</code>).</p>

<p>C’est même la seule chose qui diffère entre <code class="language-plaintext highlighter-rouge">DOllar</code> et <code class="language-plaintext highlighter-rouge">Franc</code>… L’existence même des 2 classes est sujette à caution : est-il vraiment utile d’avoir 2 classes juste pour une comparaison ?</p>

<p><strong>On ne va garder qu’une seule classe</strong>.</p>

<p>Pour réaliser cela, on va commencer par gommer leurs existences dans les tests.</p>

<blockquote class="tbd">
  <p>ici : parler de factory. Design pattern évident &gt; on crée les objet par des méthodes pas par des construteurs</p>
</blockquote>

<p>Commençons par supprimer la classe dollar en passant par un factory dans le test <code class="language-plaintext highlighter-rouge">test_dollar_multiplication()</code></p>

<h4 id="testspy">tests.py</h4>

<p>Allons-y pour un petit test en plus</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Dollar</span><span class="p">,</span> <span class="n">Franc</span>
<span class="kn">import</span> <span class="nn">money</span>

<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
    
<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy">money.py</h4>

<p>Un factory de la classe <code class="language-plaintext highlighter-rouge">Dollar</code> dans <code class="language-plaintext highlighter-rouge">money.py</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Les tests passent (en ajoutant l’import des factory) ! Donc on remplace toute référence à <code class="language-plaintext highlighter-rouge">Dollar</code> en <code class="language-plaintext highlighter-rouge">money.dollar</code> dans les tests</p>

<h4 id="testspy-1">tests.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">money</span> <span class="kn">import</span> <span class="n">Franc</span>
<span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">Franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>Avant de faire la même chose pour les Francs, posons nous la question de l’utilité de garder ces tests. Ont-ils une utilité dans le code ? Pas sûr puisque on ne fait plus qu’une seule classe, mais dons le doute on les conserve, mais on l’ajoute à la todo list.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<p>On est maintenant dans une meilleure position qu’au début. Le code utilisateur n’étant pas au courant qu’il existe 2 classes différentes. On va pouvoir passer à la suite du programme les supprimer également dans le code.</p>

<h4 id="tbd">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><strong>duplication Franc/dollar</strong></li>
  <li><del>même ==</del></li>
  <li>
<code class="language-plaintext highlighter-rouge">*</code> presque identique.</li>
  <li>compare Franc et Dollar</li>
  <li>utilisation de devise ?</li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<h4 id="moneypy-1">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="10---devises">10 - devises</h3>

<p>Pour pouvoir supprimer les 2 sous classes, il va nous falloir un moyen de distinguer les Francs des Dollars. Donc autant travailler sur l’ajout d’une devise.</p>

<h4 id="tbd-1">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
    <ul>
      <li>presque identique.</li>
    </ul>
  </li>
  <li>compare Franc et Dollar</li>
  <li><strong>utilisation de devise ?</strong></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<h4 id="testspy-2">tests.py</h4>

<p>On ajoute un test pour vérifier que les dollars et les francs ont des devises différentes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_currencies</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>
    
    
<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_dollar_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>


<span class="k">def</span> <span class="nf">test_franc_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-2">money.py</h4>

<p>une <em>obvious implementation</em> plus tard :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"CHF"</span>

<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">"USD"</span>
</code></pre></div></div>

<p>On peut maintenant travailler à faire monter les currencies au niveau de <code class="language-plaintext highlighter-rouge">Money</code>. Commençons par les faire monter au niveu des classes. On va créer un attribut <code class="language-plaintext highlighter-rouge">currency</code> dans chaque classe et l’utiliser dans les méthodes. Il faut pour cela redescendre les <code class="language-plaintext highlighter-rouge">__init__</code> dans chaque classe.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Afin de faire remonter l’attribut <code class="language-plaintext highlighter-rouge">currency</code> dans la classe Money, on va commencer par dire que currency est un paramètre des <code class="language-plaintext highlighter-rouge">__init__</code>. Comme toute devise est créé avec le factory, ça devrait passer et nous permettre ensuite de ne faire plus qu’une seule classe puisque seuls les paramètres des méthodes vont différer.</p>

<p>En ajoutant le paramètre les tests plantent ! C’est parce que l’on a oublié d’ajouter un paramètre aux factory :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
</code></pre></div></div>

<p>Les tests plantent encore… C’est parce que <code class="language-plaintext highlighter-rouge">__mul__</code> n’utilise pas le factory :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Ouf, les tests passent. On peut faire pareil pour dollar :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"CHF"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s">"USD"</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Il nous reste plus qu’à utiliser le paramètre <code class="language-plaintext highlighter-rouge">currency</code> des constructeurs dans les factory. Les classes se ressemblent de plus en plus :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Le <code class="language-plaintext highlighter-rouge">__init__</code> est re le même, ainsi que <code class="language-plaintext highlighter-rouge">currencies</code>on peut les bouger dans money (courage on y est presque) :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span>
</code></pre></div></div>

<p>Tout est prêt pour maintenant supprimer les sous-classes.</p>

<h4 id="tbd-2">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li>
    <ul>
      <li>presque identique.</li>
    </ul>
  </li>
  <li>compare Franc et Dollar</li>
  <li><del>utilisation de devise ?</del></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<p>Ici, utiliser une tâche annexe (les devises) nous a permis d’avancer vers notre but : supprimer les sous classes.</p>

<h3 id="11----unification-de-">11 -  unification de <code class="language-plaintext highlighter-rouge">*</code>
</h3>

<p>Tout est prêt pour unifier les <code class="language-plaintext highlighter-rouge">__mul__</code> et ainsi faire disparaitre les dernières différences entre les 2 classes.</p>

<h4 id="tbd-3">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li>duplication Franc/dollar</li>
  <li><del>même ==</del></li>
  <li><strong><code class="language-plaintext highlighter-rouge">*</code> presque identique.</strong></li>
  <li>compare Franc et Dollar</li>
  <li><del>utilisation de devise ?</del></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<h4 id="moneypy-3">money.py</h4>

<p>Les deux <code class="language-plaintext highlighter-rouge">__mul__</code> ne changent que par la classe produite. Donc commençons par expliciter la construction en remplaçant le factory par l’utilisation explicite des constructeurs :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>On peut maintenant ajouter une méthode <code class="language-plaintext highlighter-rouge">__mul__</code> das la classe money :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Franc</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>En supprimant la methode <code class="language-plaintext highlighter-rouge">__mul__</code> des Francs, et en rendant un <code class="language-plaintext highlighter-rouge">Money</code> dans le factory <code class="language-plaintext highlighter-rouge">franc</code>, les tests passent.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">__class__</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">__class__</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>Mais supprimer la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> de <code class="language-plaintext highlighter-rouge">Dollar</code> casse les tests : le test d’égalité est cassé. C’est normal il compare des classes et pas des <code class="language-plaintext highlighter-rouge">currency</code>. On revient donc en arrière jusqu’à ce que les tests passes (on remet la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> à <code class="language-plaintext highlighter-rouge">Dollar</code>) puis on corrige la méthode <code class="language-plaintext highlighter-rouge">__eq__</code> pour qu’elle compare les <code class="language-plaintext highlighter-rouge">currency</code> plutôt que les classes.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Franc</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">Dollar</span><span class="p">(</span><span class="n">Money</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Dollar</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<p>On peut maintenant supprimer la méthode <code class="language-plaintext highlighter-rouge">__mul__</code> de <code class="language-plaintext highlighter-rouge">Dollar</code> et ainsi supprimer les 2 classes. ON vient de supprimer 2 items en un seul refactoring.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="tbd-4">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><del>duplication Franc/dollar</del></li>
  <li><del>même ==</del></li>
  <li>~~ * presque identique.~~</li>
  <li>compare Franc et Dollar</li>
  <li><del>utilisation de devise ?</del></li>
  <li>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</li>
</ul>

<p>Maintenant les tests d’égalité et de multiplication des <code class="language-plaintext highlighter-rouge">Franc</code> sont vraiment inutiles puisque le code est le même que celui de dollar :</p>

<h4 id="testspy-3">tests.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">money</span>


<span class="k">def</span> <span class="nf">test_currencies</span><span class="p">():</span>
    <span class="k">assert</span> <span class="s">"USD"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s">"CHF"</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">currencies</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_equality</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">franc</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_multiplication</span><span class="p">():</span>
    <span class="n">five</span> <span class="o">=</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="k">assert</span> <span class="n">money</span><span class="p">.</span><span class="n">dollar</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">==</span> <span class="n">five</span> <span class="o">*</span> <span class="mi">3</span>
</code></pre></div></div>

<h4 id="moneypy-4">money.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dollar</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"USD"</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">franc</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s">"CHF"</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Money</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">currency</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">=</span> <span class="n">currency</span>

    <span class="k">def</span> <span class="nf">currencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">currency</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">amount</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Money</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">amount</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">currency</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="tbd-5">tbd</h4>

<ul>
  <li>$5 + 2.5CHF = $10 si le taux de change est 1:.5</li>
  <li><del>$5 * 2 = $10</del></li>
  <li><del>utiliser <code class="language-plaintext highlighter-rouge">amount</code> ? Le rendre privé</del></li>
  <li><del>five == 10 n’est pas vraiment super. non mutable</del></li>
  <li>gestion des arrondis</li>
  <li><del>==</del></li>
  <li>== None</li>
  <li>== autre chose qu’un Dollar</li>
  <li><del><code class="language-plaintext highlighter-rouge">__mul__</code></del></li>
  <li><del>5 CHF * 2 = 10CHF</del></li>
  <li><del>duplication Franc/dollar</del></li>
  <li><del>même ==</del></li>
  <li><del>* presque identique.</del></li>
  <li><del>compare Franc et Dollar</del></li>
  <li><del>utilisation de devise ?</del></li>
  <li><del>supprimer <code class="language-plaintext highlighter-rouge">test_franc_multiplication</code> ?</del></li>
</ul>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
