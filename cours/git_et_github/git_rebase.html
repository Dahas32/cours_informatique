<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>git rebase, la tronçonneuse magique | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="git rebase, la tronçonneuse magique">
<meta name="author" content="Fanis Michalakis">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/git_et_github/git_rebase.html">
<meta property="og:url" content="/cours_informatique/cours/git_et_github/git_rebase.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="git rebase, la tronçonneuse magique">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique de François Brucker.","author":{"@type":"Person","name":"Fanis Michalakis"},"@type":"WebPage","url":"/cours_informatique/cours/git_et_github/git_rebase.html","headline":"git rebase, la tronçonneuse magique","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">git rebase, la tronçonneuse magique</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Fanis Michalakis</span></span>
  </header>

  <div class="post-content">
    <h2 id="but">But</h2>

<p>Le but de ce tuto est de comprendre pourquoi et comment utiliser <code class="language-plaintext highlighter-rouge">git rebase</code>. Il s’agit d’une version allégée du déjà très digeste <a href="https://www.miximum.fr/blog/git-rebase/">article</a> de Thibault Jouannic. Une bonne idée pourrait être de commencer par celui-ci, puis de lire le tuto originel pour approfondir.</p>

<p>Sommaire :</p>

<table>
  <tbody>
    <tr>
      <td><a href="#pourquoi">Le pourquoi</a></td>
    </tr>
    <tr>
      <td><a href="#quoi">Le quoi</a></td>
    </tr>
    <tr>
      <td><a href="#usage">Cas d’usage</a></td>
    </tr>
    <tr>
      <td>Récapitulatif des commandes</td>
    </tr>
    <tr>
      <td><a href="#sources">Sources et ressources</a></td>
    </tr>
  </tbody>
</table>

<h2 id="pourquoi">Pourquoi</h2>

<p>Pourquoi donc s’embêter à utiliser une commande comme <code class="language-plaintext highlighter-rouge">rebase</code>, souvent perçue comme obscure, même pour certains vétérans du git, alors qu’il existe quelque chose de simple et de connu comme <code class="language-plaintext highlighter-rouge">git merge</code> ? Pour deux raisons principales, que nous détaillerons par la suite :</p>

<ol>
  <li>En fait, contrairement à ce qu’on peut penser, <code class="language-plaintext highlighter-rouge">git rebase</code> n’est pas obscure du tout</li>
  <li>Et c’est même souvent mieux qu’une bonne vieille fusion, pour plein de raisons.</li>
</ol>

<h2 id="quoi">Quoi</h2>

<p>Tout d’abord, que fait exactement la commande <code class="language-plaintext highlighter-rouge">git rebase</code> ? Elle permet ni plus ni moins de prendre une branche, de la découper, puis de la recoller ailleurs. En général, on veut la recoller au bout de la branche <em>master</em>, avec la commande suivante :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase master mabranche
</code></pre></div></div>

<p>Mais pourquoi donc s’embêter à faire ça ? Voyons sur un petit exemple : j’ai créée une branche <em>mabranche</em> à partir de <em>master</em>, et je souhaite maintenait amener les modifications effectuées dans <em>mabranche</em> sur <em>master</em>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---C---D ← master
     <span class="se">\</span>
      E---F---G ← mabranche
</code></pre></div></div>

<p>Il y a en gros deux écoles qui s’affrontent dans un combat titanesque : merge vs rebase.</p>

<p>Les partisans du <em>merge</em> vont se contenter de fusionner <em>mabranche</em> dans <em>master</em> à l’aide de la commande :</p>

<pre><code class="language-shel">git merge mabranche
</code></pre>

<p>Ce qui donne graphiquement quelque chose comme ça :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---C---D---H ← master
     <span class="se">\ </span>        /
      E---F---G ← mabranche
</code></pre></div></div>

<p>De leur côté, les défenseurs du rebase préconisent d’agir en deux temps :</p>
<ol>
  <li>On découpe la branche <em>mabranche</em> là où elle est reliée à <em>master</em> (en B) et on la recolle à la fin (en H)</li>
  <li>Ensuite, on peut “merger” de façon triviale <em>mabranche</em> dans <em>master</em>.</li>
</ol>

<p>Graphiquement, le rebase donne ceci :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---C---D ← master
             <span class="se">\</span>
              E---F---G ← mabranche
</code></pre></div></div>

<p>Et à l’issue de la fusion :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---C---D---E---F---G ← master
                         <span class="se">\</span>
                          mabranche
</code></pre></div></div>

<p>On peut ensuite supprimer <em>mabranche</em>, devenue inutile, en utilisant :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch <span class="nt">-d</span> mabranche
</code></pre></div></div>

<p>On obtient donc un historique linéaire, clair, là où auparavant on aurait eu des diverticules :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---C---D---E---F---G ← master
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<p>Tout cela est bien joli, mais à quoi est-ce que ça sert de découper une branche pour la recoller à la fin avant de fusionner sur <em>master</em> ? Cela peut en effet sembler être une perte de temps, dans la mesure où les problèmes (notamment les conflits) qui se déclarent habituellement lors d’un merge se déclareront lors du rebase. Petit panorama de l’utilité du rebase.</p>

<h3 id="un-historique-propre">Un historique propre</h3>

<p>En découpant les branches pour les recoller plus loin, <code class="language-plaintext highlighter-rouge">git rebase</code> permet de conserver un historique de modification plus clair, qu’on décide ensuite de fusionner la branche fille à <em>master</em> ou non.</p>

<p>On peut ainsi décider de fusionner une branche peu importante, comme une simple correction de bug par exemple, sans que celle-ci n’apparaisse comme une excroissance de la branche principale. Pour se faire, on commence par rebaser la branche de correction de bug (appelée <em>bug</em>) sur <em>master</em>, puis on merge, et enfin on supprime la branche :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase master bug
git checkout master
git merge bug
git branch <span class="nt">-d</span> bug
</code></pre></div></div>

<p>Cela nous permet d’obtenir un bel historique bien plat au lieu de quelque chose de plus alambiqué et qui, à la longue, les corrections de bug se succédant, risque d’alourdir inutilement l’arbre de l’historique de version.</p>

<p>On pourrait aussi vouloir, pour certaines raisons, conserver dans l’historique la trace de branches passées et de leur existence. Autrement dit, on peut désirer qu’il soit visible que tel ou tel développement a été effectué sur une branche bien précise, avant d’être fusionné dans la branche principale. Dans ce cas, l’utilisation de <code class="language-plaintext highlighter-rouge">rebase</code> permet tout de même un historique plus clair (un arbre moins touffu), en particulier lorsque plusieures branches existent en parallèle.</p>

<p>Imaginons que j’ai deux fonctionnalités, 1 et 2, qui évoluent en parallèle, chacune sur sa branche dérivée de <em>master</em>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          F---G ← fonctionnalité 2
         /
A---B---E---H---I ← master
     <span class="se">\</span>
      C---D ← fonctionnalité 1
</code></pre></div></div>

<p>L’une des deux fonctionnalités va être achévée (disons la 2), après tests je la merge dans master. Puis, vient le tour de la fonctionnalité 1. Ce qui donne quelque chose comme ça :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>          F---G ← fonctionnalité 2
         /     <span class="se">\</span>
A---B---E---H---I---L ← master
     <span class="se">\ </span>            / 
      C---D---J---K ← fonctionnalité 1
</code></pre></div></div>

<p>On a donc deux branches qui s’échappent du tronc et, visuellement, ça peut déjà sembler un peu brouillon. On va donc astucieusement utiliser rebase pour que, à la fin, les branches filles se succèdent les unes après les autres plutôt que se superposer :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---E---H-------I---------------L ← master
             <span class="se">\ </span>    / <span class="se">\ </span>            / 
              F---G   C---D---J---K 
</code></pre></div></div>

<p>On conserve donc bien l’historique en branches, mais avec beaucoup plus de clarté. Pour se faire, on va à chaque fois se rebaser sur <em>master</em> avant de fusionner, comme on le faisait avant. Mais en plus, on va utiliser l’option de merge “no fast forward” (<code class="language-plaintext highlighter-rouge">--no-ff</code>) pour que git conserve la trace des branches dans l’historique :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase master fonctionnalite1
git checkout master
git merge fonctionnalite1 <span class="nt">--no-ff</span>
git branch <span class="nt">-d</span> fonctionnalite1
git rebase master fonctionnalite2
git checkout master
git merge fonctionnalite2 <span class="nt">--no-ff</span>
git branch <span class="nt">-d</span> fonctionnalite2
</code></pre></div></div>

<h3 id="corriger-des-erreurs">Corriger des erreurs</h3>

<p>Git rebase permet également de réparer certaines boulettes, particulièrement celles que l’on a tendance à commettre tôt le matin ou tard le soir. L’une d’elles consiste par exemple à créer une nouvelle branche à partir d’une branche fille plutôt qu’à partir de master :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---H---I ← master
     <span class="se">\</span>
      C---D---G ← bug1
       <span class="se">\</span>
        E---F ← bug2
</code></pre></div></div>

<p>Sans rebase, il faudrait donc d’abord terminer bug2 et le fusionner dans bug1, avant de pouvoir espérer fusionner bug1 (et donc bug2) dans master. Pas pratique du tout ! On va donc pouvoir utiliser rebase pour découper la petite brindille bug2 pour la coller au bout de master. Ainsi, on peut maintenant traiter les branches et les fusionner dans l’ordre le plus opportun. L’option <code class="language-plaintext highlighter-rouge">--onto</code> nous permet même de spécifier l’endroit de <em>master</em> où l’on souhaite coller <em>bug2</em>.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git rebase bug1 bug2 <span class="nt">--onto</span> B
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      E---F ← bug2
     /
A---B---H---I ← production
     <span class="se">\</span>
      C---D---G ← bug1
</code></pre></div></div>

<p>Où B, pour rappel, est l’étiquette d’un commit (<code class="language-plaintext highlighter-rouge">e73f3d6</code> par exemple).</p>

<h3 id="diviser-pour-mieux-régner">Diviser pour mieux régner</h3>

<p>Parfois, on peut se traîner pendant de longues semaines la branche d’une fonctionnalité particulièrement longue à développer. Pendant ce temps, la branche <em>master</em> a le temps de connaître de nombreuses évolutions, et on risque donc de passer toute une demi-journée à résoudre des conflits lors de la fusion de notre branche avec <em>master</em>. Sauf si …</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A---B---H---I--- … <span class="nt">---J---E---F</span> ← master
      <span class="se">\</span>
       C---D---G--- … <span class="nt">---H---I</span> ← longue_fonctionnalite
</code></pre></div></div>

<p>Sauf si on a pris le temps, tous les matins par exemple, de rebaser notre branche sur <em>master</em> pour prendre en compte les dernières modifications et corriger régulièrement les conflits, plutôt que tous à la fois à la fin.</p>

<p>Après, il y a peut-être deux écoles, comme entre ceux qui préfèrent faire la vaisselle après chaque repas, et ceux qui donnent un bon coup à la fin de la semaine.</p>

<h3 id="le-jardinage-de-commits-rebase-interactif">Le jardinage de commits (rebase interactif)</h3>

<p>Le rebase interactif (<code class="language-plaintext highlighter-rouge">git rebase -i</code>) est très utile dans le cadre de l’utilisation de commits atomiques, afin de réorganiser l’historique et de fusionner plusieurs commits entre eux. Pour plus de détails, voir le tuto détaillé sur les commits atomiques.</p>

<h2 id="sources">Sources</h2>

<ul>
  <li>Ce superbe <a href="https://www.miximum.fr/blog/git-rebase/">tuto</a> réalisé par Thibault Jouannic, et sur lequel se base une bonne partie du présent tuto.</li>
  <li>
<a href="https://stackoverflow.com/questions/21364636/git-pull-rebase-preserve-merges">https://stackoverflow.com/questions/21364636/git-pull-rebase-preserve-merges</a> qui montre l’utilité de <code class="language-plaintext highlighter-rouge">git --rebase=merges</code> qui préserve les merges locaux s’il y en a.</li>
</ul>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
