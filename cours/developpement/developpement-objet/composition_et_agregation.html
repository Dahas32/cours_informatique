<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Composition et agrégation | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Composition et agrégation" />
<meta name="author" content="François Brucker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/developpement/developpement-objet/composition_et_agregation.html" />
<meta property="og:url" content="/cours_informatique/cours/developpement/developpement-objet/composition_et_agregation.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Composition et agrégation" />
<script type="application/ld+json">
{"headline":"Composition et agrégation","description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/developpement/developpement-objet/composition_et_agregation.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Composition et agrégation</h1></p>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></p>
  </header>

  <div class="post-content">
    <p>Le but de cette séance est de consolider les concepts fondamentaux de classe et d’objet et d’ajouter les notions de
composition, d’agrégation et d’attributs de classe. Vous (re)découvrirez aussi les tests unitaires.</p>

<h2 id="composition-et-agréagation">composition et agréagation</h2>

<p>Composition et agrégation permettent de lier des classes ensembles, et plus principalement lorsqu’une classe admet comme attribut des objets de l’autre classe.</p>

<p>Ce qui les distingue :</p>

<ul>
  <li><strong>agrégation</strong> : quand les objets utilisés sont créés en dehors de la classe,</li>
  <li><strong>composition</strong> : quand les objets utilisés sont créés dans le constructeur de la classe qui les utilise.</li>
</ul>

<p>Il est important de comprendre que si des objets n’ont pas été crées dans la classe qui l’utilise, ils peuvent être connus par d’autres méthodes du programme et donc être modifiées par celles-ci.</p>

<p>Les exemple de composition et d’agrégation de <em>la vraie vie</em> sont souvent un peu bizarre. Mais par exemple :</p>

<ul>
  <li>Un livre est composé de pages : pour créer le livre on a créé les pages : c’est une <strong>composition</strong></li>
  <li>Les télécommandes ont besoin de piles pour fonctionner, mais on peut les remplacer : c’est une <strong>agrégation</strong>.</li>
</ul>

<blockquote class="attention">
  <p>Si une classe est composée d’autres objets, ces parties peuvent être modifiées en dehors de la classe, même pour une compositio.</p>
</blockquote>

<p>Il se passe la même chose lorsqu’une méthode retourne un objet qui est un attribut. Une fois qu’un objet a été <em>donné</em> au monde extérieur on ne contrôle plus son état et il peut être utilisé a priori par n’importe quoi d’autre dans le programme.</p>

<p>Pour illustrer l’avertissemnt</p>

<p>Pour que tout se passe comme prévu, il faut donc s’assurer que soit :</p>

<ol>
  <li>on s’en fiche qu’ils changent</li>
  <li>on refait un nouvel objet à nous pour s’assurer qu’il ne changera pas</li>
  <li>on se rappelle de ce qu’on peut faire avec les objets à tout instant</li>
  <li>les objets que l’on retourne et qui sont des attributs sont non modifiables (des entiers, réels, chaînes de caractères, tuples, etc)</li>
</ol>

<h3 id="schémas-uml">schémas uml</h3>

<p>Le diagramme uml de l’agrégation est :</p>

<p><img src="img/uml_composition_agregation.png" alt="uml composition et agregation" /></p>

<p>C’est la solution 1 que nous appliquons dans ce td. Les objets <code class="language-plaintext highlighter-rouge">dice</code> du <code class="language-plaintext highlighter-rouge">GreenCarpet</code> peuvent bouger (n’importe qui peut les lancer) sans que ça ne gène le fonctionnement de l’objet de classe <code class="language-plaintext highlighter-rouge">GreenCarpet</code>.</p>

<p>Refaire des nouveaux à chaque fois peut s’avérer coûteux s’ils ne sont pas modifiés souvent et il est illusoire de se rappeller tout le temps ce qu’on a le droit (ou pas) de faire avec des objets (encore plus quand le projet contient plusieurs personne ou que sa durée de développement/maintient est longue, c’est à dire plus de 2h…)</p>

<p>La solution 4. est une solution très efficace lorsque les objets sont plus souvent lu que modifié. On ne créer que des objets qui ne peuvent pas être modifié : on appelle ça des 
<a href="https://en.wikipedia.org/wiki/Value_object">value object</a>. Ces objets possèdent des valeurs et des méthodes pour y accéder mais que l’on ne peut pas modifier. La seule façon de changer de valeur c’est de recréer de nouveaux objets. Pour que l’utilisation de ce genre d’objets soit fluide, on fait en sorte qu’ils puissent supporter l’opération <code class="language-plaintext highlighter-rouge">==</code>.</p>

<p>Vous avez utilisé des value objects bien souvent en python comme : les  entiers, les réels ou encore les chaines de caractères. Enfin de nombreux objets modifiables en python ont leur contrepartie non modifiable comme les tuples qui sont des listes non modifiables ou encore les <code class="language-plaintext highlighter-rouge">frozenset</code>sont des ensembles non modifiables.</p>

<p>Une bonne façon de programmer est de n’utiliser par défaut que des objets non modifiables et que si le besoin s’en fait sentir de les rendre modifiables.</p>

<h2 id="exemple--des-cartes">exemple : des cartes</h2>

<h3 id="modèle-simple">modèle simple</h3>

<p>pb du roi valet ? pour ordre</p>

<h3 id="composition">composition</h3>

<p>compose valeur à chaque carte</p>

<h3 id="les-courleurs">les courleurs</h3>

<p>en mettant des constantes</p>

<h2 id="le-jeu-de-carte">le jeu de carte</h2>

<p>deck : agregation</p>

<h3 id="probleme">probleme</h3>

<h3 id="creation">creation</h3>

<h2 id="bilan">bilan</h2>

<p>value object pour les cartes : on ne doit pas pouvoir les modiifer.</p>

<h2 id="utilisation-des-tests">utilisation des tests</h2>

<p>on teste chaque methode et des faon de construire les objets.</p>

<p>Le <a href="ressources/TD_2_impression.pdf">sujet au format pdf</a>.</p>

<h2 id="séance-code">Séance code</h2>

<h3 id="dice-et-tests-unitaires">Dice et tests unitaires</h3>

<p>On vous propose l’implémentation minimale suivante de la classe <code class="language-plaintext highlighter-rouge">Dice</code> que vous avez du réaliser la dernière fois.</p>

<h4 id="dicepy">dice.py</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy.random</span>

<span class="k">class</span> <span class="nc">Dice</span><span class="p">:</span>
  <span class="n">NUMBER_FACES</span> <span class="o">=</span> <span class="mi">6</span>

  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">probabilities</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
    <span class="k">if</span> <span class="n">probabilities</span><span class="p">:</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">probabilities</span> <span class="o">=</span> <span class="n">probabilities</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="p">.</span><span class="n">NUMBER_FACES</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="p">.</span><span class="n">NUMBER_FACES</span>

  <span class="k">def</span> <span class="nf">get_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">position</span>

  <span class="k">def</span> <span class="nf">set_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_position</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">new_position</span>

  <span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="n">choice</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">NUMBER_FACES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">probabilities</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="mainpy">main.py</h4>

<p>Ecrivez un petit programme qui crée 5 dés, les lance 10 fois et affiche à l’écran la moyenne de la somme des 5 dés.</p>

<h4 id="test_dicepy">test_dice.py</h4>

<p>Pour être sur que l’on puisse utiliser nos dés, on ajoute des tests permettant de vérifier le bon fonctionnement de nos classes.</p>

<p>Tout ce que vous allez implémenter dans tous les TP à partir de celui-ci doit être vérifié par des tests unitaires.</p>

<p>Configurez l’environnement de tests pour faire passer les tests unitaires. Prenez le temps de
regarder la structure des tests. Si tous ces tests passent êtes vous assurés que l’implémentation est correcte ?</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">dice</span> <span class="kn">import</span> <span class="n">Dice</span>

<span class="k">def</span> <span class="nf">test_dice_creation_no_argument</span><span class="p">():</span>
    <span class="n">dice</span> <span class="o">=</span> <span class="n">Dice</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">dice</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">test_set_position</span><span class="p">():</span>
    <span class="n">dice</span> <span class="o">=</span> <span class="n">Dice</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">dice</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">dice</span><span class="p">.</span><span class="n">set_position</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">dice</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span>

<span class="k">def</span> <span class="nf">test_roll</span><span class="p">():</span>
    <span class="n">dice</span> <span class="o">=</span> <span class="n">Dice</span><span class="p">()</span>
    <span class="n">dice</span><span class="p">.</span><span class="n">roll</span><span class="p">()</span>
    <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">dice</span><span class="p">.</span><span class="n">get_position</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">dice</span><span class="p">.</span><span class="n">NUMBER_FACES</span>
</code></pre></div></div>

<p>On n’a pas testé :</p>

<ul>
  <li>la création avec un argument. Ajoutez un test qui vérifie que l’argument est bien la position du dé.</li>
  <li>les probabilités. Ajoutez un test qui vérifie que si une probabilité est à 1 et les autres à 0, on trouve bien la bonne valeur après un roll.</li>
</ul>

<h3 id="greencarpet">GreenCarpet</h3>

<p>Implémentez la classe <code class="language-plaintext highlighter-rouge">GreenCarpet</code> vue en TD.</p>

<p>On va utiliser les tests pour la créer <strong>au fur et à mesure</strong>. L’idée est de rajouter un test d’une petite fonctionnalité que l’on n’a pas encore puis de rajouter le code correspondant. Cette méthode est appelée <em>Test Driven Development</em>. Elle se décompose en plusieurs étapes :</p>

<ul>
  <li>écrire un test qui teste une fonctionnalité qu’on veut implémenter,</li>
  <li>vérifier qu’il échoue (car le code qu’il teste n’existe pas), afin de vérifier que le test est valide,</li>
  <li>écrire juste le code correspondant au test,</li>
  <li>vérifier que le test passe,</li>
  <li>recommencer avec une autre fonctionnalité.</li>
</ul>

<p>On pourra ainsi. Dans l’ordre :</p>

<ul>
  <li>commencer par vérifier que l’on peut créer un objet de la classe GreenCarpet</li>
  <li>qu’un objet de la classe <code class="language-plaintext highlighter-rouge">GreenCarpet</code> a un attribut nommé <code class="language-plaintext highlighter-rouge">dice</code> qui contient 5 dés.</li>
  <li>que la classe <code class="language-plaintext highlighter-rouge">GreenCarpet</code> contient une méthode roll() qui lance tous les dés.</li>
  <li>que la classe <code class="language-plaintext highlighter-rouge">GreenCarpet</code> contient une méthode somme() qui rend la somme de la valeur des 5 dés.</li>
</ul>

<p>Une fois ceci fait, créez un fichier <em>main.py</em> qui modifie le programme de la question précédente en utilisant la classe <code class="language-plaintext highlighter-rouge">GreenCarpet</code>.</p>

<h3 id="pour-aller-plus-loin">Pour aller plus loin</h3>

<p>Ajoutez une méthode permettant de relancer les dés tant qu’on n’obtient pas une paire, un brelan, etc.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
