<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Composition et agrégation | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Composition et agrégation" />
<meta name="author" content="François Brucker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/developpement/programmation-objet/composition-agregation.html" />
<meta property="og:url" content="/cours_informatique/cours/developpement/programmation-objet/composition-agregation.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Composition et agrégation" />
<script type="application/ld+json">
{"headline":"Composition et agrégation","description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/developpement/programmation-objet/composition-agregation.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Composition et agrégation</h1>Auteurs :
      <ul>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Célia Châtel</span></span></li>
      
      </ul></p></p>
  </header>

  <div class="post-content">
    <p>Le but de cette séance est de consolider les concepts fondamentaux de classe et d’objet et d’ajouter les notions de
composition, d’agrégation et d’attributs de classe. On verra aussi l’utilisation des tests.</p>

<h2 id="liens-entre-classes">liens entre classes</h2>

<p>Composition et agrégation permettent de lier des classes ensembles, et plus principalement lorsqu’une classe admet comme attribut des objets de l’autre classe.</p>

<p>Ce qui les distingue :</p>

<ul>
  <li><strong>agrégation</strong> : quand les objets utilisés sont créés en dehors de la classe,</li>
  <li><strong>composition</strong> : quand les objets utilisés sont créés dans le constructeur de la classe qui les utilise.</li>
</ul>

<p>Il est important de comprendre que si des objets n’ont pas été crées dans la classe qui l’utilise, ils peuvent être connus par d’autres méthodes du programme et donc être modifiées par celles-ci.</p>

<p>Les exemple de composition et d’agrégation de <em>la vraie vie</em> sont souvent un peu bizarre. Mais par exemple :</p>

<ul>
  <li>Un livre est composé de pages : pour créer le livre on a créé les pages : c’est une <strong>composition</strong></li>
  <li>Les télécommandes ont besoin de piles pour fonctionner, mais on peut les remplacer : c’est une <strong>agrégation</strong>.</li>
</ul>

<h3 id="exemple-du-panier-de-fruit">exemple du panier de fruit</h3>

<p>Prenons un autre exemple, le panier de fruits. Je voudrais modéliser un panier de fruits. Il doit avoir les propriétés suivantes :</p>

<ul>
  <li>il doit être vide initialement</li>
  <li>je dois pouvoir ajouter des fruits dans le panier</li>
  <li>je dois pouvoir montrer les fruits que j’a dans le panier</li>
  <li>je dois pouvoir reprendre un fruit du panier</li>
</ul>

<h4 id="modélisation-uml">modélisation uml</h4>

<p>Comme à notre habitude commençons par créer une boîte uml presque vide :</p>

<pre><code class="language-uml">-----------------------
| Panier              |
|---------------------|
| ?                   |
|---------------------|
| __init__()          |
| ajoute(Fruit)       |
| montre_panier()     |
| supprime(Fruit)     |
-----------------------
</code></pre>

<p>Pour que l’on puisse faire ces différentes méthodes, il faut que <code class="language-plaintext highlighter-rouge">Panier</code> puisse stocker ses fruit. On lui ajoute donc un attribut qui sera une liste.</p>

<pre><code class="language-uml">-----------------------
| Panier              |
|---------------------|
| stock: list         |
|---------------------|
| __init__()          |
| ajoute(Fruit)       |
| montre_panier()     |
| supprime(Fruit)     |
-----------------------
</code></pre>

<h4 id="code-python">code python</h4>

<p>Ceci s’implémente aisément en python :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Panier</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stock</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">ajoute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fruit</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stock</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">fruit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">montre_panier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">stock</span>

    <span class="k">def</span> <span class="nf">supprime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fruit</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">stock</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fruit</span><span class="p">)</span>
</code></pre></div></div>

<p>On peut alors utiliser notre classe, par exemple :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">panier</span> <span class="o">=</span> <span class="n">Panier</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">())</span>

<span class="n">panier</span><span class="p">.</span><span class="n">ajoute</span><span class="p">(</span><span class="s">"pomme"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">())</span>

<span class="n">panier</span><span class="p">.</span><span class="n">ajoute</span><span class="p">(</span><span class="s">"pomme"</span><span class="p">)</span>
<span class="n">panier</span><span class="p">.</span><span class="n">ajoute</span><span class="p">(</span><span class="s">"poire"</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">())</span>

<span class="n">panier</span><span class="p">.</span><span class="n">supprime</span><span class="p">(</span><span class="s">"pomme"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">())</span>
</code></pre></div></div>

<h4 id="composition-et-agrégation">composition et agrégation</h4>

<ul>
  <li>Le stock est une <strong>composition</strong> : il est crée avec le panier</li>
  <li>les fruits sont une <strong>agrégation</strong> : ils sont ajouté par une méthode dans l’objet.</li>
</ul>

<h4 id="attention">attention</h4>

<blockquote class="attention">
  <p>Si une classe est composée d’autres objets, ces parties peuvent être modifiées en dehors de la classe, même pour une composition.</p>
</blockquote>

<p>Dans notre exemple, une méthode retourne un objet qui est un attribut. Une fois qu’un objet a été <em>donné</em> au monde extérieur on ne contrôle plus son état et il peut être utilisé a priori par n’importe quoi d’autre dans le programme.</p>

<p>Regardez le code suivant :</p>

<p>```python :</p>

<p>panier = Panier()</p>

<p>print(panier.montre_panier())</p>

<p>panier.ajoute(“pomme”)</p>

<p>copie = panier.montre_panier()</p>

<p>copie.append(“champignon”)
print(panier.montre_panier())</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
On a ajouté un champignon à notre panier sans que l'objet panier ne le sache !

Ce n'est pas forcément un problème, sauf si on vérifiait que ce qu'on ajoute dans le panier doit être un fruit.

Pour que tout se passe comme prévu, il faut donc s'assurer que pour les attributs , soit :

1. on s'en fiche qu'ils changent
2. on refait un nouvel objet à nous pour s'assurer qu'il ne changera pas
3. les objets que l'on retourne et qui sont des attributs sont non modifiables (des entiers, réels, chaînes de caractères, tuples, etc)

La 1ère solution est ce qu'on a pur l'instant.

La seconde solution reviendrait à donner un nouveau panier à chaque fois en modifiant la méthode `donne_panier()` :

```python
class Panier:
    # ...

    def montre_panier(self):
      return list(self.stock)
    
    #...
</code></pre></div></div>

<p>Enfin, la dernière solution reviendrait à ne pas pouvoir modifier l’attribut et à le recréer à chaque modification, par exemple dans la méthode <code class="language-plaintext highlighter-rouge">ajoute_fruit()</code>. On utilise un <a href="https://python.doctor/page-apprendre-tuples-tuple-python">tuple</a> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Panier</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="bp">self</span><span class="p">.</span><span class="n">stock</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>

    <span class="c1"># ...
</span>
    <span class="k">def</span> <span class="nf">ajoute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fruit</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">temp</span><span class="p">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">stock</span><span class="p">)</span>
        <span class="n">temp</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">fruit</span><span class="p">)</span>

        <span class="bp">self</span><span class="p">.</span><span class="n">stock</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
    
    <span class="c1">#...
</span></code></pre></div></div>

<p>Selon que l’on aura beaucoup d’ajout ou beaucoup de montrage de panier, on choisira l’une au l’autre solution. Mais si on a pas d’idée, on préférera <strong>toujours</strong> la 3ème solution qui est la plus robuste.</p>

<p>Le fait d’avoir des objet qui ne se modifient pas est appelé <a href="https://en.wikipedia.org/wiki/Value_object">value object</a>.</p>

<p>Ces objets possèdent des valeurs et des méthodes pour y accéder mais que l’on ne peut pas modifier. La seule façon de changer de valeur c’est de recréer de nouveaux objets. Pour que l’utilisation de ce genre d’objets soit fluide, on fait en sorte qu’ils puissent supporter l’opération <code class="language-plaintext highlighter-rouge">==</code>.</p>

<p>Vous avez utilisé des value objects bien souvent en python comme : les  entiers, les réels ou encore les chaines de caractères. Enfin de nombreux objets modifiables en python ont leur contrepartie non modifiable comme les <code class="language-plaintext highlighter-rouge">tuple</code> qui sont des listes non modifiables ou encore les <code class="language-plaintext highlighter-rouge">frozenset</code> sont des ensembles non modifiables.</p>

<blockquote>
  <p>Une bonne façon de programmer est de n’utiliser par défaut que des objets non modifiables et que si le besoin s’en fait sentir de les rendre modifiables.</p>
</blockquote>

<h3 id="schémas-uml">schémas uml</h3>

<p>Lorsque l’on utilise la composition ou l’agrégation de nos classes dans des schéma uml, on liera la classe composé (<em>resp.</em> agrégée) à la classe l’utilisant par une flèche. Cette flèche sera différente pour une composition ou une agrégation :</p>

<p><img src="/cours_informatique/assets/cours/developpement/programmation-objet/uml_composition_agregation.png" alt="uml composition et agrégation" /></p>

<h2 id="tests">tests</h2>

<p>Lorsque l’on crée ses propres objets, il est important de tester leurs fonctionnalités. On procède alors ainsi :</p>

<ul>
  <li>chaque méthode doit être testée</li>
  <li>chaque test doit être indépendant</li>
</ul>

<p>Dans la mesure du possible, on ne teste pas la valeur des attributs. On utilise des méthodes publique pour tester. En effet les attributs montrent l’implémentation de la classe et pas son usage.</p>

<p>Par exemple, pour notre panier. Fichier <em>“test_panier.py”</em> :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">panier</span> <span class="kn">import</span> <span class="n">Panier</span>


<span class="k">def</span> <span class="nf">test_init</span><span class="p">():</span>
    <span class="n">panier</span> <span class="o">=</span> <span class="n">Panier</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">panier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>


<span class="k">def</span> <span class="nf">test_montre_panier_vide</span><span class="p">():</span>
    <span class="n">panier</span> <span class="o">=</span> <span class="n">Panier</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">()</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">test_ajoute</span><span class="p">():</span>
    <span class="n">panier</span> <span class="o">=</span> <span class="n">Panier</span><span class="p">()</span>
    <span class="n">panier</span><span class="p">.</span><span class="n">ajoute</span><span class="p">(</span><span class="s">"pomme"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="s">"pomme"</span><span class="p">,)</span>


<span class="k">def</span> <span class="nf">test_supprime_dans_panier</span><span class="p">():</span>
    <span class="n">panier</span> <span class="o">=</span> <span class="n">Panier</span><span class="p">()</span>
    <span class="n">panier</span><span class="p">.</span><span class="n">ajoute</span><span class="p">(</span><span class="s">"pomme"</span><span class="p">)</span>
    <span class="n">panier</span><span class="p">.</span><span class="n">supprime</span><span class="p">(</span><span class="s">"pomme"</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">panier</span><span class="p">.</span><span class="n">montre_panier</span><span class="p">()</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">()</span>
</code></pre></div></div>

<blockquote>
  <ul>
    <li>pour l’initialisation, on vérifie juste que notre objet existe. Comme il n’a pas de paramètre, on ne peut pas tester grand chose d’autre</li>
    <li>On crée pour chaque test un nouveau objet, pour être sur que les tests n’interfèrent pas les uns avec les autres</li>
    <li>Chaque test doit permettre d’utiliser la méthode testée comme elle doit être utilisée dans le code</li>
  </ul>
</blockquote>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
