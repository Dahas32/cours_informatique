<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projet numérologie : partie 2 / niveau 1 / serveur web minimal | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Projet numérologie : partie 2 / niveau 1 / serveur web minimal" />
<meta name="author" content="François Brucker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/web/projets/numerologie/partie-2-post-get/niveau-1/1-serveur-web-minimal.html" />
<meta property="og:url" content="/cours_informatique/cours/web/projets/numerologie/partie-2-post-get/niveau-1/1-serveur-web-minimal.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Projet numérologie : partie 2 / niveau 1 / serveur web minimal" />
<script type="application/ld+json">
{"headline":"Projet numérologie : partie 2 / niveau 1 / serveur web minimal","description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/web/projets/numerologie/partie-2-post-get/niveau-1/1-serveur-web-minimal.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Projet numérologie : partie 2 / niveau 1 / serveur web minimal</h1></p>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></p>
  </header>

  <div class="post-content">
    <blockquote class="chemin">
  <p><a href="/cours_informatique/cours/web/projets/numerologie/">numérologie</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-post-get/">partie 2</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-post-get/niveau-1/">niveau 1</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-post-get/niveau-1/1-serveur-web-minimal.html">serveur web minimal</a></p>
</blockquote>

<p>On utilise node comme un serveur web qui dit bonjour.</p>

<h2 id="prérequis">prérequis</h2>

<p>Vous devez avoir un projet de la <a href="/cours_informatique/cours/web/projets/numerologie/partie-1-front/">partie 1</a>. Nous nous baserons sur les <a href="/cours_informatique/cours/web/projets/numerologie/partie-1-front/niveau-1/5-structures.html">fichiers du niveau 1</a>.</p>

<p>On suppose que la racine du projet est <em>“numerologie”</em>.</p>

<h2 id="un-serveur-web-minimal">un serveur web minimal</h2>

<p>Le but d’un serveur web est d’attendre qu’un client le contacte et lui demande des choses sous la forme d’une url et d’une méthode. Le serveur lui répond avec un status et un message.</p>

<h3 id="le-code">le code</h3>

<p>Créez un fichier <em>“numerologie/index.js”</em> qui sera le point d’entrée de notre serveur :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hostname</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">127.0.0.1</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">hostname</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server running at http://</span><span class="p">${</span><span class="nx">hostname</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">/`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<blockquote>
  <p>Ce serveur est celui donné dans <a href="https://nodejs.org/api/synopsis.html#synopsis_example">la doc de node</a></p>
</blockquote>

<p>Pour exécuter ce fichier, dans un terminal placé dans le dossier où se trouve <em>“index.js”</em> (normalement <em>“numerologie”</em>), tapez la commande :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node index.js
</code></pre></div></div>

<p>Le programme s’exécute dans le terminal et il ne rend pas la main. Il ne s’arrête pas et demande d’aller voir à l’url : <a href="http://127.0.0.1:3000">http://127.0.0.1:3000</a>.</p>

<p>SI on tape cette adresse dans un navigateur on voit le texte : <code class="language-plaintext highlighter-rouge">Hello World</code> s’afficher.</p>

<h3 id="anatomie-du-code">anatomie du code</h3>

<p>Regardons la syntaxe :</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">const</code> : déclaration de constantes.</li>
  <li><code class="language-plaintext highlighter-rouge">require</code> : importation d’une bibliothèque (ici la bibliothèque <a href="https://nodejs.org/api/http.html">http</a> de node) et affectation de celle-ci à une constante : en javascript <strong>on importe toujours quelque chose</strong></li>
  <li>les fonctions peuvent se créer à la volée avec : <code class="language-plaintext highlighter-rouge">nomFonction((paramètres) =&gt; {})</code></li>
</ul>

<p>Que fait le code :</p>

<ol>
  <li>on crée un serveur avec la fonction <a href="https://nodejs.org/api/http.html#http_http_createserver_options_requestlistener">http.createServer</a>. Cette fonction prend <strong>1 paramètre</strong> en argument qui est une fonction. Cette fonction sera appelée à chaque appelle au serveur avec deux paramètres :
    <ol>
      <li><code class="language-plaintext highlighter-rouge">req</code> (qui contiendra la <strong>requête <code class="language-plaintext highlighter-rouge">http</code></strong>) : de type <a href="https://nodejs.org/api/http.html#http_class_http_incomingmessage"><code class="language-plaintext highlighter-rouge">http.IncomingMessage</code></a></li>
      <li><code class="language-plaintext highlighter-rouge">res</code> (qui contiendra notre <strong>réponse <code class="language-plaintext highlighter-rouge">http</code></strong>) : de type <a href="https://nodejs.org/api/http.html#http_class_http_serverresponse"><code class="language-plaintext highlighter-rouge">http.ServerResponse</code></a></li>
    </ol>
  </li>
  <li>une fois le serveur crée on le place derrière un port de la machine, ici 3000.</li>
</ol>

<blockquote class="attention">
  <p>La réponse aux requêtes du serveur est un objet qui existe déjà, ce n’est pas la réponse de notre fonction. Le boulot d’un serveur node est de renseigner les champs de cet objet puis de l’envoyer (avec <a href="https://nodejs.org/api/http.html#http_response_end_data_encoding_callback"><code class="language-plaintext highlighter-rouge">res.end()</code></a> par exemple).</p>
</blockquote>

<h3 id="protocole-http">protocole http</h3>

<p>On ne va pas faire un long cours sur le <a href="https://fr.wikipedia.org/wiki/Hypertext_Transfer_Protocol">protocole http</a>, on va juste décrire succinctement les requêtes (ce que le serveur reçoit du navigateur) et les réponses (ce que le serveur envoie au navigateur).</p>

<blockquote>
  <p>Utiliser node nous permet de nous concentrer sur ce qui est important : répondre correctement aux demande du navigateur, sans avoir besoin d’écrire des requêtes http convfrme (ce qui n’est pas très marrant).</p>
</blockquote>

<h4 id="requête-http">requête http</h4>

<p>On peut afficher l’url de la requête : On récupère les variables <em>hostname</em> et <em>port</em> et on les affiche dans la console.</p>

<p>Une requête http est en deux parties :</p>

<ul>
  <li>des entêtes qui font la demande</li>
  <li>le corps du message (qui est souvent vide)</li>
</ul>

<p>On peut par exemple modifier notre serveur dans le fichier <em>“numerologie/index.js”</em> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">-------</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">========</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">httpVersion</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">========</span><span class="dl">"</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span><span class="p">);</span>


    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello World</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// ... </span>
</code></pre></div></div>

<p>Si l’on recharge le serveur dans le vaviguateur, on obtient quelque chose du genre :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-------
/
========
GET
========
1.1
========
{
  host: '127.0.0.1:3000',
  connection: 'keep-alive',
  'cache-control': 'max-age=0',
  'sec-ch-ua': '"Google Chrome";v="93", " Not;A Brand";v="99", "Chromium";v="93"',
  'sec-ch-ua-mobile': '?0',
  'sec-ch-ua-platform': '"macOS"',
  'upgrade-insecure-requests': '1',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36',
  accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
  'sec-fetch-site': 'none',
  'sec-fetch-mode': 'navigate',
  'sec-fetch-user': '?1',
  'sec-fetch-dest': 'document',
  'accept-encoding': 'gzip, deflate, br',
  'accept-language': 'fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7'
}
-------
/favicon.ico
========
GET
========
1.1
========
{
  host: '127.0.0.1:3000',
  connection: 'keep-alive',
  pragma: 'no-cache',
  'cache-control': 'no-cache',
  'sec-ch-ua': '"Google Chrome";v="93", " Not;A Brand";v="99", "Chromium";v="93"',
  'sec-ch-ua-mobile': '?0',
  'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36',
  'sec-ch-ua-platform': '"macOS"',
  accept: 'image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8',
  'sec-fetch-site': 'same-origin',
  'sec-fetch-mode': 'no-cors',
  'sec-fetch-dest': 'image',
  referer: 'http://127.0.0.1:3000/',
  'accept-encoding': 'gzip, deflate, br',
  'accept-language': 'fr-FR,fr;q=0.9,en-US;q=0.8,en;q=0.7'
}

</code></pre></div></div>

<blockquote>
  <p>A chaque actualisation, le serveur est <strong>sollicité deux fois</strong>, une fois pour l’url <code class="language-plaintext highlighter-rouge">/</code> et une autre fois pour l’url <a href="https://fr.wikipedia.org/wiki/Favicon"><code class="language-plaintext highlighter-rouge">/flavicon.ico</code></a>.</p>
</blockquote>

<p>Pour résumer :</p>

<ul>
  <li>le navigateur parle en http 1.1 (ce qui est ok)</li>
  <li>les <a href="https://developer.mozilla.org/fr/docs/Web/HTTP/Headers">headers</a> nous informent un peut plus sur lui</li>
  <li>il demande avec la <a href="https://developer.mozilla.org/fr/docs/Web/HTTP/Methods">méthode</a> <strong>GET</strong> l’url <code class="language-plaintext highlighter-rouge">/</code> au serveur puis l’url <code class="language-plaintext highlighter-rouge">/flavicon.ico</code></li>
</ul>

<p><strong>Pour répondre à une requête http de façon satisfaisante, le serveur à toujours besoin de :</strong></p>

<ul>
  <li>l’url</li>
  <li>de la méthode http utilisée par le serveur</li>
</ul>

<p>La version de l’http n’est pas importante pour nous, c’est node qui s’occupe de communiquer directement avec le navigateur.</p>

<h4 id="réponse-http">réponse http</h4>

<p>Une réponse http <strong>est toujours</strong> en trois parties :</p>

<ul>
  <li>le <a href="https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP">status code</a> qui résume ce que le serveur a fait avec la requête</li>
  <li>des <a href="https://developer.mozilla.org/en-US/docs/Glossary/Response_header">headers</a></li>
  <li>le corps du message (qui peut, mais c’est rare) être vide.</li>
</ul>

<p>Dans notre cas :</p>

<ul>
  <li>le status est <a href="https://http.cat/200">200</a> (ou <a href="https://httpstatusdogs.com/200">200</a> si vous êtes ce genre de personnes)</li>
  <li>le header informe le navigateur du <a href="https://developer.mozilla.org/fr/docs/Web/HTTP/Headers/Content-Type">type de message</a> : ici du texte</li>
  <li>le message complet : ici la chaine de caractère <code class="language-plaintext highlighter-rouge">'Hello World\n'</code></li>
</ul>

<h2 id="status">status</h2>

<p>Les <a href="https://fr.wikipedia.org/wiki/Liste_des_codes_HTTP">status HTTP</a> d’un serveur sont importants car ils informent le client de comment on a compris leur requête.</p>

<p>Dans les <a href="/cours_informatique/cours/web/tuto_outils_dev.html">outils de développement</a>, c’est l’onglet network qui renseigne de ces champs.</p>

<p>En gros :</p>

<ul>
  <li>2XX: ok</li>
  <li>3XX : redirection</li>
  <li>4XX : requête non trouvée/non autorisée</li>
  <li>5XX : erreur serveur</li>
</ul>

<blockquote>
  <p>Les informaticiens aiment le lol. Le status 418 fait parti d’une RFC publiée le 1/04/1998.</p>
</blockquote>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
