<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projet numérologie : partie 2 / niveau 1 / web statique | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Projet numérologie : partie 2 / niveau 1 / web statique" />
<meta name="author" content="François Brucker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/niveau-1/2-serveur-web-statique.html" />
<meta property="og:url" content="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/niveau-1/2-serveur-web-statique.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Projet numérologie : partie 2 / niveau 1 / web statique" />
<script type="application/ld+json">
{"headline":"Projet numérologie : partie 2 / niveau 1 / web statique","description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/niveau-1/2-serveur-web-statique.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Projet numérologie : partie 2 / niveau 1 / web statique</h1></p>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></p>
  </header>

  <div class="post-content">
    <blockquote class="chemin">
  <p><a href="/cours_informatique/cours/web/projets/numerologie/">numérologie</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/">partie 2</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/niveau-1/">niveau 1</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/niveau-1/2-serveur-web-statique.html">serveur web statique</a></p>
</blockquote>

<p>On utilise node comme un serveur web de fichiers statiques.</p>

<blockquote class="attention">
  <p>Il ne faut jamais servir de fichier statique en <strong>production</strong> avec node. C’est <strong>mal</strong> car il n’est pas fait pour ça. L’usage veut qu’on utilise un serveur dédié comme <a href="https://www.nginx.com/">nginx</a> qui fait du cache, de la répartition de charge et tout ce genre de choses.</p>
</blockquote>

<h2 id="but">But</h2>

<p>Le but d’un serveur web est de répondre quelque chose à partir d’une requête constituée d’une url et d’une méthode (GET ou POST). Certaines url vont nécessiter du travail comme faire une requête en base de données, calculer des choses, etc, et d’autres consisteront seulement à rendre un fichier html, css ou encore javascript qui sera exécuté par le navigateur.</p>

<p>Ces fichiers qui seront pris sur le disque dur du serveur et envoyé au navigateur sont appelées <strong>fichiers statiques</strong>.</p>

<blockquote>
  <p>Plus on a de fichiers statiques, mieux c’est puisque ces fichiers ne changent pas on peut utiliser des méthodes de <a href="https://fr.wikipedia.org/wiki/Cache_web">cache</a> (côté client et serveur) ou de <a href="https://fr.wikipedia.org/wiki/R%C3%A9partition_de_charge">load-balancing</a> pour accélérer le résultat (le réseau coute toujours du temps).</p>

  <p>De là, si vous avez le choix entre un serveur web ou juste des fichiers statiques, choisissez <strong>toujours</strong> la seconde possibilité.</p>
</blockquote>

<p>Nous allons ici utiliser la gestion de fichiers statiques pour monter la gestion des url d’un serveur web.</p>

<h2 id="gestion-des-fichiers-avec-node">gestion des fichiers avec node</h2>

<p>On a déja vu un peu ça dans <a href="/cours_informatique/cours/web/projets/numerologie/partie-1-front/niveau-2/2-code_js.html#node-fichier">le niveau 2 de la partie 1</a>. On chargeait entièrement le fichier avant de le traiter.</p>

<p>Commençons par utiliser ça pour charger le fichier <em>“numerologie/index.html”</em></p>

<h3 id="on-rend-tout-le-temps-la-même-chose">on rend tout le temps la même chose</h3>

<p>Modifions le fichier <em>“numerologie/index.js”</em> pour répondre le contenu d’un fichier :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">hostname</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">127.0.0.1</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>

    <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">./index.html</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">})</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">fichier</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="nx">hostname</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`Server running at http://</span><span class="p">${</span><span class="nx">hostname</span><span class="p">}</span><span class="s2">:</span><span class="p">${</span><span class="nx">port</span><span class="p">}</span><span class="s2">/`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>On teste le serveur et on voit que ça ne marche qu’à peut prêt.</p>

<p>En effet, on rend toujours la même chose : le fichier <em>“index.html”</em> même si le client demande autre chose. Regardons ce que demande le client en ajoutant une ligne au début de notre serveur :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>

    <span class="c1">// ...</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p>Re-testons le serveur et regardons le résultat dans la console :</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Server running at http://127.0.0.1:3000/
/
/main.css
/numerologie.js
/favicon.ico
</code></pre></div></div>

<p>La lecture du fichier <em>“numerologie/index/html”</em> par le client lance de nouvelles requêtes au serveur pour obtenir <em>“main.css”</em>, <em>“numerologie.js”</em> et … <em>“flavicon.ico”</em>.</p>

<h3 id="on-rend-une-chose-ou-404">on rend une chose ou 404</h3>

<p>Modifions le code de notre serveur  pour qu’il ne rendre <em>“index.html”</em> que and il faut :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span> <span class="o">||</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">/index.html</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>
    
        <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">./index.html</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">fichier</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p>On voit que notre serveur va répondre aux url valant <code class="language-plaintext highlighter-rouge">/</code> (c’est l’url par défaut même s’il n’y a rien) et <code class="language-plaintext highlighter-rouge">/index.html</code>. Il retournera un 404 pour tout le reste.</p>

<blockquote>
  <p><a href="https://www.guru99.com/difference-equality-strict-operator-javascript.html"><code class="language-plaintext highlighter-rouge">==</code>vs <code class="language-plaintext highlighter-rouge">===</code> en javascript</a> : l’un fait de la conversion de type (<code class="language-plaintext highlighter-rouge">10 == "10"</code>sera vrai) l’autre non (<code class="language-plaintext highlighter-rouge">10 === "10"</code>sera faux).</p>
</blockquote>

<p>Vous pouvez voir dans la console des <a href="/cours_informatique/cours/web/tuto_outils_dev.html">outils de éveloppement</a> les erreurs produites par les 404.</p>

<h3 id="on-vérifie-que-le-fichier-existe-avant">on vérifie que le fichier existe avant</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>
    
        <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">./index.html</span><span class="dl">"</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">fichier</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">.</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>
    
        <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="dl">"</span><span class="s2">.</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">fichier</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">404</span><span class="p">;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<blockquote>
  <p>Notez que le <code class="language-plaintext highlighter-rouge">res.end()</code> est indispensable dans la gestion du 404, sinon le navigateur attendra la réponse du serveur jusqu’à la fin des temps (ou un timeout).</p>
</blockquote>

<h2 id="on-jardine">on jardine</h2>

<p>On va juste un peut améliorer notre code pour le rendre :</p>

<ol>
  <li>plus joli</li>
  <li>plus portable</li>
</ol>

<h3 id="headers">headers</h3>

<p>On peut utiliser <code class="language-plaintext highlighter-rouge">res.writeHead(200,  {'Content-Type': 'text/html'})</code> pour écrire en une fois le status et le type de la réponse.</p>

<h3 id="localisation-des-fichiers">localisation des fichiers</h3>

<p>La localisation d’un fichier sur le disque dur est une opération :</p>

<ul>
  <li>non triviale</li>
  <li>dépendante de l’architecture du disque dur sur lequel le programme tourne</li>
</ul>

<p>C’est très problématique pour les serveur web puisque l’on veut que le code fonctionne sur la machine du (des) développeur(s) et sur la (les) machine(s) de production. Chacune ayant un autre disque dur et une autre architecture.</p>

<p>La seule chose donc on peut être sur c’est que le projet est identique sur toutes ces machines. On utilise alors une notation relative pour trouver le fichier.</p>

<p>Nous avons utiliser la notation <code class="language-plaintext highlighter-rouge">"./index.html"</code> pour indiquer que le fichier <em>“index.html”</em> se trouve dans le dossier courant. Mais qu’est-ce que le dossier courant ?</p>

<p>Le <strong>dossier courant</strong> est le dossier dans lequel se trouve le terminal qui a exécuté la commande node. De là, notre serveur :</p>

<ul>
  <li><strong>fonctionnera</strong> si on le lance depuis le dossier où se trouve les fichier avec la commande : <code class="language-plaintext highlighter-rouge">node index.js</code></li>
  <li><strong>ne fonctionnera pas</strong> si on le lance depuis le dossier parent avec la commande : <code class="language-plaintext highlighter-rouge">node numerologie/index.js</code>. Le serveur trouvera bien <em>“numerologie/index.js”</em> mais n’arrivera pas à trouver <em>”./index.html”</em> dans le code.</li>
</ul>

<p>Il ne faut donc pas prendre comme référence le dossier courant mais le dossier où est <em>“index.js”</em>.</p>

<p>Node nous permet de faire ça avec la constante <code class="language-plaintext highlighter-rouge">__dirname</code> qui contient le dossier où se trouve le fichier exécuté par node (il y a aussi <code class="language-plaintext highlighter-rouge">__filename</code> pour connaitre son nom)</p>

<blockquote>
  <p>Si l’on exécute juste <code class="language-plaintext highlighter-rouge">node</code> pour se retrouver dans l’interpréteur, si <code class="language-plaintext highlighter-rouge">__dirname</code> ni <code class="language-plaintext highlighter-rouge">__filename</code> ne sont défini, ce qui est logique.</p>
</blockquote>

<p>Enfin, on ne concatène <strong>jamais</strong> des fichiers à la main. On utilise <strong>toujours</strong> une bibliothèque pour cela (sinon c’est <em>bad karma</em> : ça va forcément vous sauter à la tête un jour) qui traite tous les cas particulier pour vous. En node, c’est la <a href="https://nodejs.org/api/path.html">bibliothèque path</a> qui s’occupe de ça.</p>

<p>Fichier <em>“numerologie/index.js”</em> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">"</span><span class="s2">./index.html</span><span class="dl">"</span><span class="p">)</span>        
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span>  <span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">fichier : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">fichier</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">fichier</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span>  <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">})</span>
    
        <span class="nx">fichier</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">fichier</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span><span class="dl">'</span><span class="s1">utf8</span><span class="dl">'</span><span class="p">})</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">fichier</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span>  <span class="p">{</span><span class="dl">'</span><span class="s1">Content-Type</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">})</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<blockquote>
  <p>On a aussi utilisé le principe du <a href="https://fr.wikipedia.org/wiki/Ne_vous_r%C3%A9p%C3%A9tez_pas">DRY</a> en factorisant les lignes identiques.</p>
</blockquote>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
