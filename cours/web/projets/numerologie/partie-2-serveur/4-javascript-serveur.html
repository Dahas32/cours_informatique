<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projet numérologie : partie 2 / niveau 1 / javascript serveur | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="Projet numérologie : partie 2 / niveau 1 / javascript serveur">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/4-javascript-serveur.html">
<meta property="og:url" content="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/4-javascript-serveur.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Projet numérologie : partie 2 / niveau 1 / javascript serveur">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique de François Brucker.","author":{"@type":"Person","name":"François Brucker"},"@type":"WebPage","url":"/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/4-javascript-serveur.html","headline":"Projet numérologie : partie 2 / niveau 1 / javascript serveur","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Projet numérologie : partie 2 / niveau 1 / javascript serveur</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span>
  </header>

  <div class="post-content">
    <blockquote class="chemin">
  <p><a href="/cours_informatique/cours/web/projets/numerologie/">numérologie</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/">partie 2</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-2-serveur/4-javascript-serveur.html">javascript serveur</a></p>
</blockquote>

<p>On crée notre première route écrite en javascript et on récupère le résultat dans le front.</p>

<h2 id="route-avec-paramètre">route avec paramètre</h2>

<p>Il existe plusieurs façon de passer des paramètres au serveur depuis le navigateur. Nous allons en voir 2.</p>

<h3 id="paramètres-dans-reqparams">paramètres dans <code class="language-plaintext highlighter-rouge">req.params</code>
</h3>

<p>La première façon de faire est de mettre la dernière partie de l’url en paramètre.
Ajoutez la route suivante dans le fichier <em>“numerologie/index.js”</em> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/chaine/:prenom</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">})</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<p>Tout ce qui suit <code class="language-plaintext highlighter-rouge">/chaine</code> dans l’url sera considéré comme notre variable <code class="language-plaintext highlighter-rouge">prenom</code>. Ainsi la requête <a href="http://127.0.0.1:3000/chaine/Fran%C3%A7ois">http://127.0.0.1:3000/chaine/François</a></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="err">prenom:</span><span class="w"> </span><span class="err">'François'</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<blockquote>
  <p>le paramètre ne peut cependant pas contenir de <code class="language-plaintext highlighter-rouge">/</code> car c’est un séparateur de parties d’url.</p>
</blockquote>

<h3 id="url-et-utf8">url et utf8</h3>

<p>Lorsque vous tapez des urls en utf8, celles ci sont encodés en transformant les caractères non ascii par des nombres précédés d’un <code class="language-plaintext highlighter-rouge">%</code> : c’est <a href="https://fr.wikipedia.org/wiki/Encodage-pourcent">l’encodage %</a>.</p>

<p>On le voit dans le log console de la requête <a href="http://127.0.0.1:3000/chaine/Fran%C3%A7ois">http://127.0.0.1:3000/chaine/François</a> qui est  <code class="language-plaintext highlighter-rouge">Time: 19/09/2021 20:29:08 ; url : /chaine/Fran%C3%A7ois</code> : le <code class="language-plaintext highlighter-rouge">ç</code> a été transformé en <code class="language-plaintext highlighter-rouge">%C3%A7</code>.</p>

<p>Cela ne se voit cependant pas dans le code node car les paramètres sont reconvertis en chaine unicode pour le traitement.</p>

<blockquote class="attention">
  <p>Ce n’est cependant pas le cas pour la requête de base, ainsi une route qui aura comme base : <code class="language-plaintext highlighter-rouge">'/chaîne/:prenom'</code> donnera tout le temps un 404. C’est la route <code class="language-plaintext highlighter-rouge">cha%C3%AEne/:prenom</code> qui sera reconnue.
Pour ne pas à avoir à se rappeler des encodage, on pourra utiliser les fonction <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/encodeURI">encodeURI()</a> et <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Reference/Global_Objects/decodeURI">decodeURI</a></p>
</blockquote>

<h3 id="paramètres-dans-reqquery">paramètres dans <code class="language-plaintext highlighter-rouge">req.query</code>
</h3>

<p>Nous allons regarder ici la plus ancienne de ces méthodes, qui consiste à passer les paramètres directement dans l’url sous la forme de <a href="https://en.wikipedia.org/wiki/Query_string">query string</a>. C’est la façon classique de passer des paramètres à une url et c’est donc celle-ci que nous garderons ici.</p>

<p>Dans notre cas, on aimerait que notre serveur reconnaisse les requêtes du type : <a href="http://localhost:3000/pr%C3%A9nom?valeur=fran%C3%A7ois">http://localhost:3000/prénom?valeur=françois</a>.</p>

<blockquote>
  <p>si vous voulez plusieurs paramètres, il faut les séparer par des <code class="language-plaintext highlighter-rouge">&amp;</code> comme indiqué dans <a href="https://en.wikipedia.org/wiki/Query_string">la documentation</a></p>
</blockquote>

<p>Express permet de le faire tout aussi simplement que précédemment. Ajoutez la route suivante dans le fichier <em>“numerologie/index.js”</em> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nb">encodeURI</span><span class="p">(</span><span class="dl">'</span><span class="s1">/prénom</span><span class="dl">'</span><span class="p">),</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">})</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<blockquote>
  <p>On a utilisé <code class="language-plaintext highlighter-rouge">encodeURI</code> pour un chemin on ascii.</p>
</blockquote>

<p>On récupère la <code class="language-plaintext highlighter-rouge">query</code> sous la forme d’un dictionnaire directement avec <code class="language-plaintext highlighter-rouge">req.query</code>. Notez que la conversion en utf8 s’est faite toute seule pour la query.</p>

<h2 id="retour-en-json">retour en json</h2>

<p>Le retour de cette requête sera un objet <a href="https://developer.mozilla.org/fr/docs/Learn/JavaScript/Objects/JSON">json</a>. Il pourra répondre à la requête <a href="http://localhost:3000/pr%C3%A9nom?valeur=fran%C3%A7ois">http://localhost:3000/prénom?valeur=françois</a> :</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="err">prénom:</span><span class="w"> </span><span class="s2">"François"</span><span class="p">,</span><span class="w">
  </span><span class="err">chiffre:</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Avant de donner une véritable valeur en utilisant <em>“numerologie.js”</em> occupons nous de rendre du json.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nb">encodeURI</span><span class="p">(</span><span class="dl">'</span><span class="s1">/prénom</span><span class="dl">'</span><span class="p">),</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
    <span class="nx">prenom</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">[</span><span class="dl">"</span><span class="s2">valeur</span><span class="dl">"</span><span class="p">]</span>
    <span class="nx">chiffre</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">prénom</span><span class="p">:</span> <span class="nx">prenom</span><span class="p">,</span>
        <span class="na">chiffre</span><span class="p">:</span> <span class="nx">chiffre</span><span class="p">,</span>
    <span class="p">})</span>
<span class="p">})</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<blockquote>
  <p>Il n’y a pas de soucis avec la ligne <code class="language-plaintext highlighter-rouge">chiffre: chiffre</code>. Le 1er chiffre est un nom, le second une variable.</p>
</blockquote>

<h2 id="intégration-au-html">intégration au html</h2>

<blockquote>
  <p>TBD :
expliquer mieux fetch, son retour et ce qu’est une promesse.</p>

</blockquote>

<p>Pour récupérer ce json dans le fichier html, il faut que l’on envoie une requête avec la query lorsque l’on clique sur le bouton et que l’on attende la réponse du serveur avant de changer la valeur dans le paragraphe.</p>

<p>Ceci peut se faire simplement avec un petit bout de javascript côté client, en utilisant la fonction <a href="https://developer.mozilla.org/fr/docs/Web/API/Fetch_API/Using_Fetch">fetch</a>, très pratique, qui permet de récupérer des choses sur internet avec des <a href="https://developer.mozilla.org/fr/docs/Web/JavaScript/Guide/Using_promises">promesses</a> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#form-button</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">prenom</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#form-input</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prenom</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/prénom/?valeur=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">prenom</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
            <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#chiffre</span><span class="dl">"</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">chiffre</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
            <span class="p">})</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#chiffre</span><span class="dl">"</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">?</span><span class="dl">"</span>
    <span class="p">}</span>

    <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Une promesse permet d’attendre que quelque chose d’asynchrone se fasse (ici le retour de notre appel serveur), puis (avec <code class="language-plaintext highlighter-rouge">.then</code>) de faire des choses. Ici :</p>

<ol>
  <li>une fois que le serveur a répondu, on transforme le résultat en json</li>
  <li>avec le json (le second <code class="language-plaintext highlighter-rouge">.then</code>) on peut facilement accéder aux données pour changer le chiffre.</li>
</ol>

<p>Ce qui donne le fichier html suivant :</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"fr"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>Numérologie<span class="nt">&lt;/title&gt;</span>
        
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://unpkg.com/purecss@2.0.6/build/pure-min.css"</span> <span class="na">integrity=</span><span class="s">"sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5"</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span><span class="nt">&gt;</span>
        
        <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"main.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"main"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"pure-form"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;label&gt;</span>Prénom :<span class="nt">&lt;/label&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"form-input"</span><span class="nt">/&gt;</span>
            
                <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">id=</span><span class="s">"form-button"</span> <span class="na">class=</span><span class="s">"pure-button pure-button-primary"</span><span class="nt">&gt;</span>Envoi<span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pure-g"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pure-u-1-3"</span><span class="nt">&gt;&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pure-u-1-3"</span><span class="nt">&gt;&lt;p</span> <span class="na">id=</span><span class="s">"chiffre"</span><span class="nt">&gt;</span>7<span class="nt">&lt;/p&gt;&lt;/div&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"pure-u-1-3"</span><span class="nt">&gt;&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;script&gt;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#form-button</span><span class="dl">"</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">prenom</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#form-input</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">prenom</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">fetch</span><span class="p">(</span><span class="dl">'</span><span class="s1">/prénom/?valeur=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">prenom</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
                    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#chiffre</span><span class="dl">"</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">chiffre</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
                    <span class="p">})</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#chiffre</span><span class="dl">"</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">?</span><span class="dl">"</span>
            <span class="p">}</span>

            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="p">})</span>
        <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p>On a aussi supprimé l’appel au fichier <em>“numérologie.js”</em> qui est maintenant inutile.</p>

<h2 id="module-javascript">module javascript</h2>

<p>Il nous reste plus qu’à transférer le fichier <em>“static/numerologie.js”</em> du côté du back.</p>

<p>Pour cela, on va le placer dans un dossier particulier : <em>“numerologie/back/numerologie.js”</em>.</p>

<p>Il faut ensuite transformer le fichier en module node, appelable par <code class="language-plaintext highlighter-rouge">require</code> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">function</span> <span class="nx">nombre</span><span class="p">(</span><span class="nx">chaine</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">somme</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">chaine</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">somme</span> <span class="o">+=</span> <span class="nx">chaine</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">somme</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">somme</span><span class="p">(</span><span class="nx">nombre</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">somme</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">chaine</span> <span class="o">=</span> <span class="nb">String</span><span class="p">(</span><span class="nx">nombre</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">chaine</span><span class="p">.</span><span class="nx">length</span> <span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">somme</span> <span class="o">+=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">chaine</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">somme</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">chiffreAssocie</span><span class="p">(</span><span class="nx">chaine</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">valeur</span> <span class="o">=</span> <span class="nx">nombre</span><span class="p">(</span><span class="nx">chaine</span><span class="p">)</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">valeur</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">valeur</span> <span class="o">=</span> <span class="nx">somme</span><span class="p">(</span><span class="nx">valeur</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">valeur</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">chiffre</span><span class="p">:</span> <span class="nx">chiffreAssocie</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Lorsque l’on <code class="language-plaintext highlighter-rouge">require</code> un fichier, on rend l’objet <code class="language-plaintext highlighter-rouge">module.exports</code>. Pour numérologie.js, j’exporte un objet qui a un attribut <code class="language-plaintext highlighter-rouge">chiffre</code> associé à la fonction chiffreAssocie.</p>

<p>On peut alors l’utiliser comme ça dans <em>“serveur.js”</em> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ...</span>

<span class="kd">const</span> <span class="nx">numerologie</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./back/numerologie</span><span class="dl">'</span><span class="p">);</span> <span class="c1">//import</span>

<span class="c1">// ...</span>

<span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nb">encodeURI</span><span class="p">(</span><span class="dl">'</span><span class="s1">/prénom</span><span class="dl">'</span><span class="p">),</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
    <span class="nx">prenom</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">[</span><span class="dl">"</span><span class="s2">valeur</span><span class="dl">"</span><span class="p">]</span>
    <span class="nx">chiffre</span> <span class="o">=</span> <span class="nx">numerologie</span><span class="p">.</span><span class="nx">chiffre</span><span class="p">(</span><span class="nx">prenom</span><span class="p">)</span> <span class="c1">//utilisation</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">({</span>
        <span class="na">prénom</span><span class="p">:</span> <span class="nx">prenom</span><span class="p">,</span>
        <span class="na">chiffre</span><span class="p">:</span> <span class="nx">chiffre</span><span class="p">,</span> 
    <span class="p">})</span>
<span class="p">})</span>

<span class="c1">// ...</span>
</code></pre></div></div>

<blockquote>
  <p>Les import qui sont des fichiers à nous sont décrit par leur chemin relatif, et commencent donc par <code class="language-plaintext highlighter-rouge">./</code>.</p>
</blockquote>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
