<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projet numérologie : partie 5 / tests unitaires | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Projet numérologie : partie 5 / tests unitaires" />
<meta name="author" content="François Brucker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/1-tests-unitaires.html" />
<meta property="og:url" content="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/1-tests-unitaires.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Projet numérologie : partie 5 / tests unitaires" />
<script type="application/ld+json">
{"headline":"Projet numérologie : partie 5 / tests unitaires","description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/web/projets/numerologie/partie-5-tests/1-tests-unitaires.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Projet numérologie : partie 5 / tests unitaires</h1></p>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></p>
  </header>

  <div class="post-content">
    <blockquote class="chemin">
  <p><a href="/cours_informatique/cours/web/projets/numerologie/">numérologie</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/">partie 5</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/1-tests-unitaires.html">tests unitaires</a></p>
</blockquote>

<blockquote>
  <p>TBD
mock ?
asynchrone
before/after</p>
</blockquote>

<h2 id="bibliothèque-de-test">bibliothèque de test</h2>

<p>Il existe plusieurs bibliothèques permettant de faire des tests unitaires. Nous allons utiliser <a href="https://jestjs.io/">jest</a></p>

<p>Commençons par l’installer :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save-dev</span> jest
</code></pre></div></div>

<p>Remarquez qu’on a pas utilisé le classique <code class="language-plaintext highlighter-rouge">--save</code> mais le nouveau <code class="language-plaintext highlighter-rouge">--save-dev</code>. Ceci à changer le fichier <em>“package.json”</em> :</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"numerologie"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"de la numérologie"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index.js"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"init"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node db-init.js"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"echo </span><span class="se">\"</span><span class="s2">Error: no test specified</span><span class="se">\"</span><span class="s2"> &amp;&amp; exit 1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node index.js"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">"François Brucker"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WTFPL"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"express"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.17.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sequelize"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^6.7.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sqlite3"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^5.0.2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"jest"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^27.3.1"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Une valeur a été ajoutée : <code class="language-plaintext highlighter-rouge">"devDependencies"</code> pour distinguer les dépendances utiles en production (<code class="language-plaintext highlighter-rouge">"dependencies"</code>) et celles utiles en développement. En tapant :</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">npm install</code> : toutes les dépendances (<code class="language-plaintext highlighter-rouge">"dependencies"</code> et <code class="language-plaintext highlighter-rouge">"devDependencies"</code>) seront installées</li>
  <li><code class="language-plaintext highlighter-rouge">npm install --production</code> : uniquement les dépendances <code class="language-plaintext highlighter-rouge">"dependencies"</code>  seront installées</li>
</ul>

<p>Voir <a href="https://docs.npmjs.com/cli/v7/commands/npm-install">la documentation</a> pour de plus amples informations.</p>

<h2 id="usage">usage</h2>

<p><code class="language-plaintext highlighter-rouge">jest</code> va exécuter des tests écrit dans des fichiers. Par défaut ces fichiers sont :</p>

<ul>
  <li>les fichiers finissant par <em>“.test.js”</em> (ou <em>“.spec.js”</em>) du projet ou dans ses sous dossiers</li>
  <li>tous les fichiers du dossier <em>“<strong>tests</strong>”</em> s’il existe.</li>
</ul>

<h3 id="commande">commande</h3>

<p>On peut exécuter jest de deux façon, soit via <code class="language-plaintext highlighter-rouge">npm</code> et une configuration dans <em>“package.json”</em> ou en ligne de commande.</p>

<h4 id="npm">npm</h4>

<p>On commence par associer <code class="language-plaintext highlighter-rouge">jest</code> aux tests en renseignant le champ <code class="language-plaintext highlighter-rouge">"test"</code> de l’attribut <code class="language-plaintext highlighter-rouge">"script"</code> du fichier <em>“package.json”</em> :</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">...</span><span class="w">

  </span><span class="nl">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"init"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node db-init.js"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"test"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jest"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node index.js"</span><span class="w">
  </span><span class="p">}</span><span class="err">,</span><span class="w">

</span><span class="err">...</span><span class="w">
</span></code></pre></div></div>

<p>Puis on exécute <code class="language-plaintext highlighter-rouge">jest</code> en tapant la commande :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">test</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">npm test</code> est un raccourci pour <code class="language-plaintext highlighter-rouge">npm run test</code></p>
</blockquote>

<h4 id="cli">CLI</h4>

<p>Le programme <code class="language-plaintext highlighter-rouge">jest</code> est rangé dans le dossier <em>“node_modules/.bin”</em>, on peut donc l’appeler directement par la commande :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./node_modules/.bin/jest
</code></pre></div></div>

<h3 id="tests">tests</h3>

<p>les tests seront tous de la forme (repris des <a href="https://jestjs.io/fr/docs/getting-started">premiers pas</a>) :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">deux plus deux font quatre</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">expect</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Chaque test aura :</p>

<ul>
  <li>un nom. Ici : <code class="language-plaintext highlighter-rouge">'deux plus deux font quatre'</code></li>
  <li>le test en lui même qui est une fonction et dont le but est de comparer une valeur théorique à une valeur réelle. Ici on cherche à vérifier que <code class="language-plaintext highlighter-rouge">2 + 2</code> vaut <code class="language-plaintext highlighter-rouge">4</code>.</li>
</ul>

<p>L’essence même d’un test est l’utilisation de <a href="https://jestjs.io/fr/docs/using-matchers">comparateurs</a></p>

<h3 id="blocs-de-tests">blocs de tests</h3>

<p>Par défaut, on va grouper les tests similaire dans un même fichier. Si l’on a besoin de sous-groupes à l’intérieur d’un fichier, par exemple en faisant un groupe pour les tests d’une fonction, on peut utiliser un bloc <a href="https://jestjs.io/fr/docs/api#describename-fn">describe</a>.</p>

<h2 id="tests-métiers">tests métiers</h2>

<p>On va tester ici les méthodes <em>métiers</em> c’esrt à dire tout ce qui n’est pas des routes. Notre projet à un unique fichier métier : <em>“numerologie/back/numerologie.js”</em></p>

<p>On doit tester toutes les méthodes de ce fichier : <code class="language-plaintext highlighter-rouge">nombre</code>, <code class="language-plaintext highlighter-rouge">somme</code> et <code class="language-plaintext highlighter-rouge">chiffreAssocie</code>.</p>

<p>Il n’y a jamais de bonne réponses à la question : quoi tester ? La seule réponse satisfaisante est: juste assez pour que l’on soit intimement persuadé que la fonction marche si les testent passent.</p>

<p>De toute façon, si l’on se rend compte (ou plutôt quand on se rendra compte) qu’il y a un bug, on écrira un test qui mettra en évidence le bug, puis on le corrigera. De cette façon ce bug ne pourra plus jamais réapparaitre, les tests étant conservés.</p>

<blockquote>
  <p>Lorsqu’un programme et muni de tests, il ne peut jamais régresser : Kent Beck dit que c’est une progression par <a href="https://fr.wikipedia.org/wiki/Cliquet_(m%C3%A9canique)">cliquet</a></p>
</blockquote>

<p>Chaque test doit tester une seule chose, et on peut s’appuyer sur une fonction que si les tests des fonctions qui la composent sont testées. On doit donc tester <code class="language-plaintext highlighter-rouge">nombre</code> et <code class="language-plaintext highlighter-rouge">somme</code> avant de tester <code class="language-plaintext highlighter-rouge">chiffreAssocie</code>.</p>

<h3 id="module-rewire">module rewire</h3>

<p>Il reste un dernier problème à résoudre avant de commencer les tests proprement dit : <code class="language-plaintext highlighter-rouge">nombre</code> et <code class="language-plaintext highlighter-rouge">somme</code> ne sont pas exportées, il est donc a priori impossible de simplement les importer pour les tester. POur faire cela, on va utiliser le module <a href="">rewire</a> comme expliqué dans <a href="https://javascript.plainenglish.io/how-to-test-a-non-export-function-in-javascript-a1d0bc339ac">ce tuto</a> :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">--save-dev</span> rewire
</code></pre></div></div>

<h3 id="numerologietestjs">numerologie.test.js</h3>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
