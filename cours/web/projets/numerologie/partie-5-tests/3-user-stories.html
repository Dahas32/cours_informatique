<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projet numérologie : partie 5 / user stories | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Projet numérologie : partie 5 / user stories" />
<meta name="author" content="François Brucker" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille." />
<link rel="canonical" href="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/3-user-stories.html" />
<meta property="og:url" content="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/3-user-stories.html" />
<meta property="og:site_name" content="cours d’informatique" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Projet numérologie : partie 5 / user stories" />
<script type="application/ld+json">
{"headline":"Projet numérologie : partie 5 / user stories","description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/web/projets/numerologie/partie-5-tests/3-user-stories.html","author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /><!-- Mathjax Support -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
      },
      svg: {
        fontCache: 'global'
      }
    };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
</head>

<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Projet numérologie : partie 5 / user stories</h1>Auteurs :
      <ul>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Yi Mei Jiang</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Léo Laurent</span></span></li>
      
      </ul></p></p>
  </header>

  <div class="post-content">
    <blockquote class="chemin">
  <p><a href="/cours_informatique/cours/web/projets/numerologie/">numérologie</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/">partie 5</a> / <a href="/cours_informatique/cours/web/projets/numerologie/partie-5-tests/3-user-stories.html">user stories</a></p>
</blockquote>

<p>Les user stories sont de utilisations possibles du site. Elles dépendent souvent de <a href="https://fr.wikipedia.org/wiki/Persona_(marketing)">persona</a>, sorte d’utilisateurs idéaux, qui ont des besoins précis et identifiés.</p>

<p>Pour réaliser — et automatiser — ces tests, nous utiliserons la bibliothèque selenium qui permet de prendre le contrôle d’un navigateur.</p>

<h2 id="user-stories-et-tests-fonctionnels">User Stories et Tests Fonctionnels</h2>

<p>Le concept de User Story rejoint celui d’expérience utilisateur.  En effet il s’agit de comment on imagine que l’utilisateur va utiliser le produit, quel est le chemin qu’il va parcourir, surtout quel est le chemin qu’on veut qu’il parcoure. Définir une user story permet également de définir comment sera utilisé le site qu’on va écrire.</p>

<p>Ici, on souhaite tester le comportement du site en fonction du parcours d’un utilisateur.
On doit donc réaliser des tests fonctionnels: On veut observer le résultat d’une séquence d’opérations complexes.</p>

<p>Pour cela, on va utiliser <a href="https://www.selenium.dev">Selenium</a>, un outil qui permet d’automatiser un navigateur web. On peut l’utiliser pour simuler un utilisateur, et donc vérifier que le site fonctionne comme il devrait d’un point de vue utilisateur.
C’est un outil très générique puisqu’il supporte de nombreux navigateurs, il est utilisable avec de nombreux langages également.</p>

<h2 id="installation-de-selenium">Installation de Selenium</h2>

<p>Selenium est écrit en Java, avant de l’utiliser assurez-vous d’avoir Java installé sur votre machine. Vous pouvez le faire en passant par l’installer <a href="https://sdkman.io">sdkman</a>.</p>

<p>Pour utiliser Selenium on va avoir besoin de plusieurs bibliothèques :</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">selenium-webdriver</code>, la bibliothèque de Selenium proprement dit</li>
  <li>un navigateur web :
    <ul>
      <li><code class="language-plaintext highlighter-rouge">geckodriver</code> pour firefox</li>
      <li><code class="language-plaintext highlighter-rouge">chromedriver</code> pour chrome</li>
    </ul>
  </li>
</ul>

<p>On peut les installer avec la commande : <code class="language-plaintext highlighter-rouge">npm instal --save-dev selenium-webdriver chromedriver geckodriver</code></p>

<h2 id="documentation">documentation</h2>

<p>La <a href="https://www.selenium.dev/documentation/">documentation officielle</a> est très précieuse. Il y a en effet plein de possiblités.</p>

<h2 id="exemples">exemples</h2>

<h3 id="premier-exemple">premier exemple</h3>

<h4 id="un-eme-exemple-main">à la main</h4>

<p>On veut aller aller sur la page de google et vérifier que son titre contient <em>Google</em></p>

<p>Tester ça avec une navigation privée sur chrome et firefox</p>

<blockquote>
  <p>Remarquez qu’il y a une fenêtre sur laquelle cliquer pour accéder à la barre de recherche.</p>
</blockquote>

<h4 id="un-eme-exemple-selenium">automatisé</h4>

<p>Créez un nouveau dossier <em>“numerologie/user-stories”</em>, puis un fichier : <em>“numerologie/user-stories/look-at-goole.user-story.js”</em> :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://www.google.com</span><span class="dl">'</span>

<span class="kd">const</span> <span class="nx">webdriver</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>


<span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">geckodriver</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">browser</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">().</span><span class="nx">forBrowser</span><span class="p">(</span><span class="dl">'</span><span class="s1">firefox</span><span class="dl">'</span><span class="p">).</span><span class="nx">build</span><span class="p">()</span>
<span class="p">})</span>


<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">it renders</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
  <span class="kd">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">getTitle</span><span class="p">()</span>
  <span class="nx">expect</span><span class="p">(</span><span class="nx">title</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">'</span><span class="s1">Google</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<p>On exécute le fichier avec jest :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">test</span> <span class="nt">--</span> <span class="nt">--testRegex</span><span class="o">=</span><span class="s2">"user-story.js"</span>
</code></pre></div></div>

<p>La commande précédente exécute jest en cherchant tous les fichiers qui finissent par <code class="language-plaintext highlighter-rouge">user-story.js</code>.</p>

<blockquote>
  <p>On a pas mis nos tests fonctionnels dans les recherche par défaut de jest car ils prennent trop de temps.</p>
</blockquote>

<p>Si vous voulez utiliser google à la place de firefox, remplacez la fonction <code class="language-plaintext highlighter-rouge">beforeEach</code> par :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">chromedriver</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">().</span><span class="nx">forBrowser</span><span class="p">(</span><span class="dl">'</span><span class="s1">chrome</span><span class="dl">'</span><span class="p">).</span><span class="nx">build</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="deuxième-exemple">deuxième exemple</h3>

<h4 id="deux-eme-exemple-main">à la main</h4>

<p>On veut aller aller sur la page de google et :</p>

<ol>
  <li>cliquer sur le bouton <em>j’accepte</em></li>
  <li>rechercher <em>Carole Deumié</em></li>
  <li>prendre un screenshot</li>
</ol>

<p>Tester ça avec une navigation privée sur chrome et firefox</p>

<h4 id="deux-eme-exemple-selenium">automatisé</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">https://www.google.com</span><span class="dl">'</span>

<span class="kd">const</span> <span class="p">{</span><span class="nx">By</span><span class="p">,</span> <span class="nx">Key</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webdriver</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">chromedriver</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">().</span><span class="nx">forBrowser</span><span class="p">(</span><span class="dl">'</span><span class="s1">chrome</span><span class="dl">'</span><span class="p">).</span><span class="nx">build</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">save a picture</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// files saved in ./reports/screenshots by default</span>
    <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
    <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">L2AGLb</span><span class="dl">"</span><span class="p">)).</span><span class="nx">click</span><span class="p">()</span>
    <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">switchTo</span><span class="p">().</span><span class="nx">defaultContent</span><span class="p">();</span>
    <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span><span class="dl">"</span><span class="s2">q</span><span class="dl">"</span><span class="p">)).</span><span class="nx">sendKeys</span><span class="p">(</span><span class="dl">"</span><span class="s2">Carole Deumié</span><span class="dl">"</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">ENTER</span><span class="p">);</span>
    
    <span class="nx">browser</span><span class="p">.</span><span class="nx">takeScreenshot</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">img.png</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">},</span> <span class="mi">10000</span><span class="p">)</span>

<span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<blockquote>
  <p>Incroyable, non ?</p>
</blockquote>

<h2 id="comment-ça-marche">comment ça marche</h2>

<p>Pour réaliser des tests en ligne depuis un navigateur web, on utilise le WebDriver.
Celui-ci communique avec un driver dépendant du navigateur web qu’on souhaite utiliser.
Voici à quoi ressemble le code dans ce cas:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// On charge le webdriver</span>
<span class="kd">const</span> <span class="nx">webdriver</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="dl">'</span><span class="s1">Le site fonctionne</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// Avant chaque test...</span>
        <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">geckodriver</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// On charge le driver</span>
        <span class="nx">browser</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">().</span><span class="nx">forBrowser</span><span class="p">(</span><span class="dl">'</span><span class="s1">firefox</span><span class="dl">'</span><span class="p">).</span><span class="nx">build</span><span class="p">()</span> <span class="c1">// On ouvre le navigateur web</span>
    <span class="p">})</span>

  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">premier test</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Contenu du test</span>
  <span class="p">});</span>

  <span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">second test</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Contenu du test</span>
  <span class="p">});</span>

    <span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// Après chaque test...</span>
        <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">()</span> <span class="c1">// On ferme le navigateur</span>
    <span class="p">})</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Ici on a utilisé firefox et son driver associé geckodriver.
On peut de la même manière utiliser d’autres navigateurs comme Chromium, Edge, Opera…
Il suffit dans le code de changer les noms du driver et du navigateur.
Pour installer et utiliser d’autres drivers <a href="https://www.selenium.dev/documentation/fr/webdriver/driver_requirements/">consultez cette page</a>.</p>

<h3 id="trouver-un-élément-web">Trouver un Élément Web</h3>

<p>Pour naviguer sur le site, on recherche en général des éléments précis sur cette page avec lesquels interagir.
Pour trouver un élément sur une page web, on utilise <code class="language-plaintext highlighter-rouge">findElement</code>.</p>

<p>Cette fonction renvoie un objet WebElement qui représente un noeud de l’arbre DOM,
en prenant en argument un contexte de recherche.
Par exemple, la ligne suivante permet de trouver l’élément dont l’<code class="language-plaintext highlighter-rouge">id</code> est “introduction”,
et de stocker cet objet dans la variable intro :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">intro</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">introduction</span><span class="dl">"</span><span class="p">));</span> 
</code></pre></div></div>

<p><em>Pensez à charger le module <code class="language-plaintext highlighter-rouge">By</code> au début du fichier en rajoutant la ligne suivante :</em></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="p">{</span><span class="nx">By</span><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>Ensuite, si on veut trouver un élément contenu dans l’objet intro (par exemple l’image d’<code class="language-plaintext highlighter-rouge">id</code> <code class="language-plaintext highlighter-rouge">"img-intro"</code>), on écrit :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">imgIntro</span> <span class="o">=</span> <span class="nx">intro</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">img-intro</span><span class="dl">"</span><span class="p">));</span> 
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">findElements</code> renvoie une liste des éléments respectant les critères de recherche :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">listLinks</span> <span class="o">=</span> <span class="nx">intro</span><span class="p">.</span><span class="nx">findElements</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">));</span> 
</code></pre></div></div>

<p>On peut rechercher un Élément en fonction de divers sélecteurs grâce à <code class="language-plaintext highlighter-rouge">By</code>. En voici quelques-uns :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// dont le nom est "a" (un lien):</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span><span class="dl">"</span><span class="s2">a</span><span class="dl">"</span><span class="p">));</span>
<span class="c1">// dont l'id est "truc":</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">truc</span><span class="dl">"</span><span class="p">));</span>
<span class="c1">// possédant a minima les attributs css "#machin" et "bidule":</span>
<span class="kd">const</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="dl">"</span><span class="s2">#machin bidule</span><span class="dl">"</span><span class="p">));</span>
</code></pre></div></div>

<p>De manière générale, il est conseillé de rechercher des éléments par leur <code class="language-plaintext highlighter-rouge">id</code> unique s’il existe,
ou par leurs sélecteurs CSS.
Cela évite de parcourir l’arbre DOM avec plusieurs recherches, ce qui prend plus de temps.</p>

<p>On peut aussi rechercher un élément en fonction de sa position par rapport à un autre élément :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Trouve un bouton en dessous de intro</span>
<span class="kd">const</span> <span class="nx">intro</span> <span class="o">=</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">introduction</span><span class="dl">"</span><span class="p">));</span>
<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">withTagName</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">)</span>
                                        <span class="p">.</span><span class="nx">below</span><span class="p">(</span><span class="dl">"</span><span class="s2">intro</span><span class="dl">"</span><span class="p">));</span>
</code></pre></div></div>

<p>On utilise <code class="language-plaintext highlighter-rouge">withTagName</code> qui remplace <code class="language-plaintext highlighter-rouge">By.name</code>.
On peut rechercher :</p>

<ul>
  <li>au dessus avec <code class="language-plaintext highlighter-rouge">.above</code></li>
  <li>en dessous avec <code class="language-plaintext highlighter-rouge">.below</code></li>
  <li>à gauche avec <code class="language-plaintext highlighter-rouge">.toLeftOf</code></li>
  <li>à droite avec <code class="language-plaintext highlighter-rouge">.toRightOf</code></li>
  <li>à moins de 50px avec <code class="language-plaintext highlighter-rouge">.near</code></li>
</ul>

<p>On peut utiliser plusieurs de ces sélecteurs en même temps :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">withTagName</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">)</span>
                                        <span class="p">.</span><span class="nx">above</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">introduction</span><span class="dl">"</span><span class="p">))</span>
                                        <span class="p">.</span><span class="nx">toRightOf</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">cssSelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">#menu</span><span class="dl">"</span><span class="p">)));</span>
</code></pre></div></div>

<h3 id="réaliser-des-actions-sur-la-page">Réaliser des actions sur la page</h3>

<p>Une fois qu’un élément est trouvé, on peut automatiser les actions de l’utilisateur sur le site.
Les exemples les plus fréquents sont :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Cliquer sur un bouton</span>
<span class="k">await</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span><span class="dl">"</span><span class="s2">button</span><span class="dl">"</span><span class="p">)).</span><span class="nx">click</span><span class="p">();</span>
<span class="c1">// Remplir un champ et valider (penser à charger Key au début du fichier)</span>
<span class="k">await</span> <span class="nx">driver</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">name</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">)).</span><span class="nx">sendKeys</span><span class="p">(</span><span class="dl">"</span><span class="s2">Manu</span><span class="dl">"</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">ENTER</span><span class="p">);</span>
</code></pre></div></div>

<p>Des actions plus précises peuvent être faites
<a href="https://www.selenium.dev/documentation/fr/support_packages/mouse_and_keyboard_actions_in_detail/">à la souris</a> 
comme <a href="https://www.selenium.dev/documentation/fr/webdriver/keyboard/">au clavier</a>.</p>

<h3 id="quelques-commandes-utiles">Quelques commandes utiles</h3>

<p>Pour prendre une capture d’écran et l’enregistrer, on utilise :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">browser</span><span class="p">.</span><span class="nx">takeScreenshot</span><span class="p">().</span><span class="nx">then</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">img.png</span><span class="dl">'</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">})</span>
</code></pre></div></div>

<p>Certaines pages comme Google font apparaitre un popup dans une <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/iframe">iframe</a>.
Dans ce cas, on doit utiliser <code class="language-plaintext highlighter-rouge">switchTo</code> pour accéder à son contenu :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">));</span> <span class="c1">// On trouve d'abord l'iframe</span>

<span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">switchTo</span><span class="p">().</span><span class="nx">frame</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span> <span class="c1">// On rentre dans l'iframe</span>
<span class="c1">// On fait ici nos actions / recherches dans l'iframe</span>
<span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">switchTo</span><span class="p">().</span><span class="nx">defaultContent</span><span class="p">();</span> <span class="c1">// On sort de l'iframe</span>
</code></pre></div></div>

<h2 id="user-story">user story</h2>

<p>Pour notre site. On va exécuter du code en mode test (donc avec une base de donnée en mémoire). Après avoir ajouté les signification des chiffre, on veut tester la user story suivante :</p>

<ol>
  <li>je me connecte au site</li>
  <li>je tape mon nom “François” puis s’appuie sur entré.</li>
  <li>je remarque que mon nom est associé au chiffre 8 et que des projets, j’en ai toujours en pagaille.</li>
  <li>Je vais ensuite sur la page des prénoms et je vérifie que j’ai bien mon nom qui est affiché.</li>
</ol>

<p>Il va falloir lancer notre site dans un mode spécial, pour que nos tests puissent accéder à la base de donnée. On crée donc un nouvel environnement, et on modifie <em>“numerologie/db.js”</em> pour qu’il le prenne compte :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//...</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">env</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sequelize</span><span class="p">(</span><span class="dl">'</span><span class="s1">sqlite::memory:</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">env</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">test-user-stories</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sequelize</span><span class="p">({</span>
    <span class="na">dialect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sqlite</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">storage</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">db-test-user-stories.sqlite</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">});</span>

<span class="k">else</span> <span class="p">{</span>
  <span class="nx">sequelize</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sequelize</span><span class="p">({</span>
    <span class="na">dialect</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sqlite</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">storage</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">db.sqlite</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">//...</span>
</code></pre></div></div>

<p>Une fois cet environnement réalisé, on initialise la base :</p>

<p>sous mac ou unix :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NODE_ENV</span><span class="o">=</span><span class="s1">'test-user-stories'</span> node db-init.js
</code></pre></div></div>

<p>sous powershell  :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$env</span>:NODE_ENV<span class="o">=</span><span class="s1">'test-user-stories'</span> <span class="p">;</span> node db-init.js
</code></pre></div></div>

<p>Puis on peut ensuite exécuter notre serveur :</p>

<p>sous mac/unix :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NODE_ENV</span><span class="o">=</span><span class="s1">'test-user-stories'</span> npm start
</code></pre></div></div>

<p>sous powershell  :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$env</span>:NODE_ENV<span class="o">=</span><span class="s1">'test-user-stories'</span> <span class="p">;</span> npm start
</code></pre></div></div>

<blockquote>
  <p>on peut aussi lier les deux instruction par un <code class="language-plaintext highlighter-rouge">;</code> : sous mac/unix : <code class="language-plaintext highlighter-rouge">NODE_ENV='test-user-stories' node db-init.js ; NODE_ENV='test-user-stories' npm start</code> et sous windows : <code class="language-plaintext highlighter-rouge">$env:NODE_ENV='test-user-stories' ; node db-init.js ; npm start</code></p>
</blockquote>

<p>Enfin, dans un nouveau terminal, on lance notre nouveau test qu’on a placé dans le fichier <em>“numerologie/user-stories/ajout-prenom.user-story.js”</em> :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">By</span><span class="p">,</span> <span class="nx">Key</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webdriver</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">selenium-webdriver</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">test-user-stories</span><span class="dl">'</span>
<span class="kd">const</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../db</span><span class="dl">'</span><span class="p">)</span>

<span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">sequelize</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">beforeEach</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">chromedriver</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">browser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">webdriver</span><span class="p">.</span><span class="nx">Builder</span><span class="p">().</span><span class="nx">forBrowser</span><span class="p">(</span><span class="dl">'</span><span class="s1">chrome</span><span class="dl">'</span><span class="p">).</span><span class="nx">build</span><span class="p">()</span>
<span class="p">})</span>


<span class="nx">test</span><span class="p">(</span><span class="dl">'</span><span class="s1">mon prénom</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://127.0.0.1:3000/</span><span class="dl">"</span><span class="p">)</span>

  
  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">form-input</span><span class="dl">"</span><span class="p">)).</span><span class="nx">sendKeys</span><span class="p">(</span><span class="dl">"</span><span class="s2">François</span><span class="dl">"</span><span class="p">,</span> <span class="nx">Key</span><span class="p">.</span><span class="nx">ENTER</span><span class="p">)</span>
  
  <span class="nx">text</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">wait</span><span class="p">(</span><span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">id</span><span class="p">(</span><span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">)).</span><span class="nx">getText</span><span class="p">(),</span> <span class="mi">5000</span><span class="p">)</span>

  <span class="nx">expect</span><span class="p">(</span><span class="nx">text</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">"</span><span class="s2">Des projets, vous en avez toujours en pagaille</span><span class="dl">"</span><span class="p">)</span>

  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">http://127.0.0.1:3000/static/prenoms.html</span><span class="dl">"</span><span class="p">)</span>
  <span class="nx">expect</span><span class="p">(</span><span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">By</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="dl">"</span><span class="s2">li</span><span class="dl">"</span><span class="p">)).</span><span class="nx">getText</span><span class="p">()).</span><span class="nx">toContain</span><span class="p">(</span><span class="dl">"</span><span class="s2">François</span><span class="dl">"</span><span class="p">)</span>
<span class="p">},</span> <span class="mi">10000</span><span class="p">)</span>

<span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">await</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">quit</span><span class="p">()</span>
<span class="p">})</span>
</code></pre></div></div>

<p>Il est souvent nécessaire d’ajouter des temps d’attente pour laisser le browser réagir. On a mis ici un <a href="https://www.selenium.dev/fr/documentation/webdriver/waits/#explicit-wait">temps d’attente explicite</a> pour laisser au browser le temps de réagir à la fin de la requête : on attend que la méthode <code class="language-plaintext highlighter-rouge">getText()</code> rende une valeur non nulle, et on attend au pire 10s.</p>

<blockquote>
  <p>Si on veut attendre de façon certaine, 2s par exemple, on peut utiliser une fonction qui rend toujours faux : <code class="language-plaintext highlighter-rouge">await browser.wait(() =&gt; false, 2000)</code></p>
</blockquote>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
