<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Projet MD2 - API CRUD en Vue.js + Django | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="Projet MD2 - API CRUD en Vue.js + Django">
<meta name="author" content="Simon Drobinski">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille.">
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille.">
<link rel="canonical" href="/cours_informatique/cours/web/projets/md2_vue_drf.html">
<meta property="og:url" content="/cours_informatique/cours/web/projets/md2_vue_drf.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Projet MD2 - API CRUD en Vue.js + Django">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique à l’école centrale marseille.","author":{"@type":"Person","name":"Simon Drobinski"},"@type":"WebPage","url":"/cours_informatique/cours/web/projets/md2_vue_drf.html","headline":"Projet MD2 - API CRUD en Vue.js + Django","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Projet MD2 - API CRUD en Vue.js + Django</h1>Auteurs :
      <ul>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Simon Drobinski</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Milan Hernando</span></span></li>
      
      </ul>
  </header>

  <div class="post-content">
    <p>Voici un mini-projet permettant de voir une structure simpliste d’app full-stack en Vue.js + Django Rest Framework.</p>

<h2 id="introduction">Introduction</h2>

<p>Le backend est géré par Django, un framework web en Python. 
Django est un outil puissant qui peut réaliser des apps à lui tout seul (Instagram est codé en Django) et peut nécessiter du temps pour en comprendre le fonctionnement. L’idée ici étant simplement de comprendre comment frontend &amp; backend peuvent communiquer entre eux au travers d’API qu’on générera également dans ce tuto, nous ne nous servirons pas de Django dans son entiereté, mais d’un toolkit appelé Django Rest Framework qui permet de faire des petites apps sympathiques et ludiques, et qu’on utilisera pour créer une API CRUD (Create, Read, Update, Delete).
Cette API sera exploitée par notre partie frontend, gérée par Vue.js, une librairie JS très en vogue aujourd’hui.</p>

<h2 id="technologies-utilisées">Technologies utilisées</h2>

<h3 id="frontend">frontend</h3>

<ul>
  <li><a href="https://v3.vuejs.org/">Vue 3</a></li>
  <li><a href="https://axios-http.com/docs/intro">Axios</a></li>
</ul>

<h3 id="backend">backend</h3>

<ul>
  <li><a href="https://www.django-rest-framework.org/">Django Rest Framework</a></li>
  <li><a href="https://www.python.org/">Python</a></li>
  <li><a href="https://docs.python.org/3/library/sqlite3.html">SQLite3</a></li>
</ul>

<h2 id="pré-requis">Pré-requis</h2>

<h3 id="frontend-1">frontend</h3>
<p>Il vous faudra avoir Vue installé sur votre machine. Il existe différentes manières (via <a href="https://vuejs.org/v2/guide/installation.html#CDN">CDN</a>, <a href="https://vuejs.org/v2/guide/installation.html#NPM">npm</a>, ou installer la CLI de Vue, <a href="https://cli.vuejs.org/guide/installation.html">Vue-CLI</a>). Personnellement, j’utilise Vue-CLI.</p>

<h3 id="backend-1">backend</h3>
<p>Il vous faudra Django Rest Framework installé. Pour cela, il vous faudra Django. Et pour cela, il vous faudra Python.</p>
<ul>
  <li>Pour Python, vous pouvez récupérer la dernière version <a href="https://www.python.org/">ici</a>.</li>
  <li>Python installé, on passe à Django. Ouvrez votre terminal et lancez la commande suivante :
    <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>python <span class="nt">-m</span> pip <span class="nb">install </span>django
</code></pre></div>    </div>
  </li>
  <li>Finalement, vous pouvez installer DRF, toujours dans le terminal :
    <div class="language-shell highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>djangorestframework
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="lancement-du-projet">Lancement du projet</h2>

<p>le projet consiste en une simple To-Do List. Les tâches seront enregistrées en base de données et affichées avec Vue par appels d’API.</p>

<p>Vous pouvez retrouver le repo du projet ici : <a href="https://github.com/simsimdrobs/api-vuejs-drf">TODOLIST</a></p>

<p><img src="../../../assets/projets/md2_vue_drf/frontend-pic.png" alt="todolist"></p>

<h3 id="backend-2">backend</h3>

<p>On commence par la partie backend.</p>

<p>Créez un dossier qui sera la racine de notre projet là où vous le voulez. On pourra l’appeler “api-vue-drf” pour être original.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>api-vue-drf
</code></pre></div></div>
<p>Rentrez dans le projet et créez un autre dossier dans lequel on mettra notre code backend :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>api-vue-drf
<span class="nb">mkdir </span>backend
</code></pre></div></div>
<p>Rentrez dans le dossier “backend”. On lance ensuite la commande suivante faisant appel à Django, pour initier notre backend. Comme notre projet est une To-Do List, on exécutera :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>backend
django-admin startproject todolist
</code></pre></div></div>
<p>Et voilà ! Django a généré notre projet. Si vous exécutez un ‘ls’ dans le terminal vous devriez avoir :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls
</span>todolist    manage.py
</code></pre></div></div>
<p>Si vous entrez dans le dossier todolist, vous devriez trouver plusieurs fichiers .py. Deux vont nous intéresser : urls.py et settings.py.
Dans le fichier todolist/urls.py, nous allons légèrement modifier le contenu pré-écrit :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.contrib import admin
from django.urls import path, include

urlpatterns <span class="o">=</span> <span class="o">[</span>
    path<span class="o">(</span><span class="s1">'admin/'</span>, admin.site.urls<span class="o">)</span>,
    path<span class="o">(</span><span class="s1">'api/'</span>, include<span class="o">(</span><span class="s1">'tasks.urls'</span><span class="o">))</span>,
<span class="o">]</span>
</code></pre></div></div>
<p>Nous indiquons ici à Django que dès qu’une URL commençant par ‘api/’ sera appelée, les urls du fichier tasks/urls.py seront utilisées.</p>

<p>Mais où est donc ce fichier ?</p>

<p>Prenons un exemple pour illustrer ce qui va suivre. Vous voulez faire un blog. Dans un blog, il peut y avoir plusieurs composants essentiels à son existence, comme des articles, des utilisateurs, etc.</p>

<p>Dans notre projet todolist c’est pareil, il y aura des tâches, dont le modèle sera à définir. Avec Django, les composants à intégrer aux projets s’appellent les APPS. Nous allons donc créer une app ‘tasks’ et voir ce que cela donne avec la commande suivante :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>backend/todolist
python manage.py startapp tasks
</code></pre></div></div>
<p>On voit apparaître dans notre code un nouveau dossier ‘tasks’. Ce dossier servira à définir une tâche en base de données, et notre API.</p>

<p>Pour que notre app soit installée sur le projet Django, il faut l’intégrer dans la liste des apps installées. Et ce n’est pas automatique !</p>

<p>Pour cela, on va dans todolist/settings.py, à cet endroit :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSTALLED_APPS <span class="o">=</span> <span class="o">[</span>
    ...
    <span class="s1">'tasks.apps.TasksConfig'</span>,
    <span class="s1">'rest_framework'</span>,
<span class="o">]</span>
</code></pre></div></div>
<p>Comme cela, notre app est installée ! On pourra au passage y ajouter l’app ‘rest_framework’ tant que l’on est là, car il faut également le préciser si l’on veut pouvoir développer notre API.</p>

<blockquote>
  <p>NB : Pour des raisons de sécurité, et ce même sur notre propre machine, la communication entre applications nécessite certaines autorisations; notre backend doit pouvoir renvoyer des réponses quand notre frontend fera des requêtes. Pour cela, il faudra définir le <a href="https://developer.mozilla.org/fr/docs/Web/HTTP/CORS">CORS</a> pour que l’accès aux ressources soit sans problèmes.</p>
</blockquote>

<p>Nous allons installer les cors-headers de Django :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// backend/todolist

python <span class="nt">-m</span> pip <span class="nb">install </span>django-cors-headers
</code></pre></div></div>

<p>Et dans todolist/settings.py, ajoutez-les dans les apps installées. Il vous faudra aussi l’ajouter dans les middlewares pour écouter les réponses :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INSTALLED_APPS <span class="o">=</span> <span class="o">[</span>
    ...,
    <span class="s2">"corsheaders"</span>,
    ...,
<span class="o">]</span>
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MIDDLEWARE <span class="o">=</span> <span class="o">[</span>
    ...,
    <span class="s2">"corsheaders.middleware.CorsMiddleware"</span>,
    <span class="s2">"django.middleware.common.CommonMiddleware"</span>,
    ...,
<span class="o">]</span>
</code></pre></div></div>
<p>Enfin, il faudra indiquer la liste des origines aui sont autorisées à lancer des requêtes HTTP croisées d’un site à l’autre. Ici, on autorisera seulement l’origine de notre serveur local frontend, qui sera sur le port 8000 :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CORS_ALLOWED_ORIGINS <span class="o">=</span> <span class="o">[</span>
    <span class="s2">"http://localhost:8080"</span>,
<span class="o">]</span>
</code></pre></div></div>
<p>Et voilà, tout devrait bien pouvoir communiquer quand les APIs seront utilisées.</p>

<p>On rappelle que dans todolist/urls.py, on renvoie toutes les URLs commençcant par ‘api/’ vers tasks/urls.py, or ce fichier n’est pas présent dans le dossier ‘tasks’. Il faut le rajouter manuellement. On le complètera plus tard.</p>

<p>On passe maintenant à la partie Modèle. Elle sert à établir comment nous définissons une tâche (son contenu, si elle a été faite ou pas, etc.) dans le backend. De ces modèles, on crée nos profils de base de données, et on effectue des migrations en cas de changement.</p>

<p>Sans rentrer dans le détail, voici le modèle d’une tâche Task. Je vous invite à vous référer à la <a href="https://docs.djangoproject.com/en/3.2/topics/db/models/">doc</a> de Django pour comprendre les modèles.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tasks/models.py
from django.db import models

<span class="c"># Create your models here.</span>
class Task<span class="o">(</span>models.Model<span class="o">)</span>:
    TASK_DONE <span class="o">=</span> <span class="o">[</span>
        <span class="o">(</span><span class="s1">'done'</span>, <span class="s1">'DONE'</span><span class="o">)</span>,
        <span class="o">(</span><span class="s1">'not done'</span>, <span class="s1">'NOT DONE'</span><span class="o">)</span>
    <span class="o">]</span>
    content <span class="o">=</span> models.CharField<span class="o">(</span><span class="nv">max_length</span><span class="o">=</span>200<span class="o">)</span>
    completion <span class="o">=</span> models.CharField<span class="o">(</span><span class="nv">max_length</span><span class="o">=</span>200, <span class="nv">choices</span><span class="o">=</span>TASK_DONE<span class="o">)</span>
</code></pre></div></div>
<p>Nous avons défini le modèle d’une Task. Il reste maintenant à faire une migration en base de données, c’est à dire dire à cette dernière les modifications (nouveaux modèles, nouveaux champs, suppression de champs, etc.).</p>

<p>Pour cela, taper les commandes suivantes :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py makemigrations
puis
python manage.py migrate
</code></pre></div></div>
<p>Vous devriez avoir du contenu dans le dossier ‘migrations’ de ‘tasks’. La mise à jour de la bdd a bien été faite (on notera d’ailleurs qu’une bdd sqlite3 a été générée par défaut).</p>

<p>Pour notre API, nous allons avoir besoin d’un outil très important : le Serializer. Il va gérer lui-même le formattage des données récupérées en bdd pour que nous puissions faire le traitement de ces dernières dans un format plus adapté, comme JSON par exemple. Plus d’info <a href="https://hazelcast.com/glossary/serialization/">ici</a>.</p>

<p>On crée un fichier serializers.py dans ‘tasks’; voici le code à mettre :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.db import models
from rest_framework import serializers
from .models import Task

class TaskSerializer<span class="o">(</span>serializers.ModelSerializer<span class="o">)</span>:
    class Meta:
        model <span class="o">=</span> Task
        fields <span class="o">=</span> <span class="s1">'__all__'</span>
</code></pre></div></div>
<p>Plusieurs choses notables : on trouve une petite ressemblance avec la manière de définir notre modèle Task; Django met à disposition des classes Model et ModelSerializer qui gèrent elles-mêmes la construction d’un modèle ou d’un serializer. Ensuite, on voit que notre modèle Task est importé et utilisé par notre classe TaskSerializer : Un serializer se construit sur le modèle dont il va gérer les données.</p>

<p>NB : on remarque aussi l’importation du module Rest Framework.</p>

<p>Deux choses nous restent à faire pour le backend : écrire les fonctions de notre API CRUD qui vont manipuler les données de notre modèle Task, et faire en sorte qu’elles soient appelées lorsqu’on arrive sur une certaine URL.</p>

<p>Ses fonctions vont être définies dans le fichier tasks/views.py.</p>

<p>Voici le fichier. Pour comprendre la création d’API CRUD avec Django et DRF, allez voir <a href="https://www.bezkoder.com/django-crud-mysql-rest-framework/">ici</a>.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework import status

from .serializers import TaskSerializer

from .models import Task

<span class="c"># Create your views here.</span>

<span class="c">#api views create a interface permitting manipulation of data through CRUD methods, and depending on the request method</span>

@api_view<span class="o">([</span><span class="s1">'GET'</span>, <span class="s1">'POST'</span><span class="o">])</span>
def task_list<span class="o">(</span>request<span class="o">)</span>:
    <span class="c">#GET request</span>
    <span class="k">if </span>request.method <span class="o">==</span> <span class="s1">'GET'</span>:
        tasks <span class="o">=</span> Task.objects.all<span class="o">()</span>
        tasks_serializer <span class="o">=</span> TaskSerializer<span class="o">(</span>tasks, <span class="nv">many</span><span class="o">=</span>True<span class="o">)</span>
        <span class="k">return </span>Response<span class="o">(</span>tasks_serializer.data<span class="o">)</span>

    <span class="c">#POST request</span>
    <span class="k">elif </span>request.method <span class="o">==</span> <span class="s1">'POST'</span>:
        task_serializer <span class="o">=</span> TaskSerializer<span class="o">(</span><span class="nv">data</span><span class="o">=</span>request.data<span class="o">)</span>
        <span class="k">if </span>task_serializer.is_valid<span class="o">()</span>:
            task_serializer.save<span class="o">()</span>
        <span class="k">return </span>Response<span class="o">(</span>task_serializer.data<span class="o">)</span>



@api_view<span class="o">([</span><span class="s1">'GET'</span>, <span class="s1">'PUT'</span>, <span class="s1">'DELETE'</span><span class="o">])</span>
def task_detail<span class="o">(</span>request, pk<span class="o">)</span>:
    <span class="c">#We check if the Task we are looking for actually exists</span>
    try:
        task <span class="o">=</span> Task.objects.get<span class="o">(</span><span class="nv">pk</span><span class="o">=</span>pk<span class="o">)</span>
    except Task.DoesNotExist:
        <span class="k">return </span>Response<span class="o">({</span><span class="s1">'message'</span>: <span class="s1">'tuto does not exist'</span><span class="o">}</span>, <span class="nv">status</span><span class="o">=</span>status.HTTP_404_NOT_FOUND<span class="o">)</span>

    <span class="c">#GET request</span>
    <span class="k">if </span>request.method <span class="o">==</span> <span class="s1">'GET'</span>:
        task_serializer <span class="o">=</span> TaskSerializer<span class="o">(</span>task<span class="o">)</span>
        <span class="k">return </span>Response<span class="o">(</span>task_serializer.data<span class="o">)</span>

    <span class="c">#PUT request</span>
    <span class="k">elif </span>request.method <span class="o">==</span> <span class="s1">'PUT'</span>:
        task_serializer <span class="o">=</span> TaskSerializer<span class="o">(</span><span class="nv">instance</span><span class="o">=</span>task, <span class="nv">data</span><span class="o">=</span>request.data<span class="o">)</span>
        <span class="k">if </span>task_serializer.is_valid<span class="o">()</span>:
            task_serializer.save<span class="o">()</span>
        <span class="k">return </span>Response<span class="o">(</span>task_serializer.data<span class="o">)</span>

    <span class="c">#DELETE request</span>
    <span class="k">elif </span>request.method <span class="o">==</span> <span class="s1">'DELETE'</span>:
        task.delete<span class="o">()</span>
        <span class="k">return </span>Response<span class="o">({</span><span class="s1">'message'</span>: <span class="s1">'tuto successfully deleted'</span><span class="o">}</span>, <span class="nv">status</span><span class="o">=</span>status.HTTP_200_OK<span class="o">)</span>
</code></pre></div></div>
<p>Maintenant, reste à définir les URLs pour lesquelles seront appelées nos fonctions.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.urls import path
from <span class="nb">.</span> import views

urlpatterns <span class="o">=</span> <span class="o">[</span>
    path<span class="o">(</span><span class="s1">'tasks/'</span>, views.task_list<span class="o">)</span>,
    path<span class="o">(</span><span class="s1">'tasks/&lt;str:pk&gt;/'</span>, views.task_detail<span class="o">)</span>,
<span class="o">]</span>
</code></pre></div></div>
<p>Selon la méthode de la requête envoyée à l’URL, la fonction associée saura quoi faire.</p>

<p>Maintenant, essayons de lancer un serveur local avec la commande :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py runserver
</code></pre></div></div>
<p>Et tapez cette URL : <a href="http://127.0.0.1:8000/api/tasks/">http://127.0.0.1:8000/api/tasks/</a>, vous devriez avoir une vue de votre API (sans aucune tâche ajoutée) !</p>

<p><img src="../../../assets/projets/md2_vue_drf/backend-pic.png" alt="backend"></p>

<p>Vous pouvez en ajouter une avec le champ du dessous; écrivez en JSON comme ceci et cliquez sur POST :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span>
    <span class="s2">"content"</span>: <span class="s2">"finir le projet MD2"</span>,
    <span class="s2">"completion"</span>: <span class="s2">"not done"</span>
<span class="o">}</span> 
</code></pre></div></div>
<p>Vous devriez avoir votre première tâche dans la liste ! Bravo !</p>

<p>Si vous ajoutez à la fin de l’URL le numéro d’ID de votre tâche (…/api/tasks/${ID de la tâche}), vous devriez avoir le détail de celle-ci et la possibilité de la modifier ou la supprimer.</p>

<p>Voilà, nous venons de créer une très simple API CRUD avec Django et Django Rest Framework !</p>

<p>Maintenant, si vous avez un joli site, vous voulez avoir accès à ces données depuis le frontend pour pouvoir l’inclure proprement dans le design de celui-ci. Passons donc à la deuxième partie.</p>

<h3 id="frontend-2">frontend</h3>

<p>Nous passons désormais au frontend, avec Vue.js. Il existe plusieurs manières de l’installer, je vous conseille de le faire avec la CLI <a href="https://cli.vuejs.org/guide/installation.html">Vue-CLI</a>. Dans ce tuto nous ferons avec cela.</p>

<p>Remettez-vous à la racine du projet, dans le dossier “api-vue-drf”, et lancez la commande suivante :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vue create frontend
</code></pre></div></div>
<p>Vous aurez le choix entre une configuration par défaut ou manuelle. Choisissez la manuelle pour installer directement <a href="https://router.vuejs.org/guide/#html">Vue-router</a>, qui nous sera utile par la suite.</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? Please pick a preset: Manually <span class="k">select </span>features
? Check the features needed <span class="k">for </span>your project: Choose Vue version, Babel, Router
? Choose a version of Vue.js that you want to start the project with 3.x
? Use <span class="nb">history </span>mode <span class="k">for </span>router? <span class="o">(</span>Requires proper server setup <span class="k">for </span>index fallback <span class="k">in </span>production<span class="o">)</span> Yes
? Where <span class="k">do </span>you prefer placing config <span class="k">for </span>Babel, ESLint, etc.? In dedicated config files
</code></pre></div></div>
<p>L’installation se lance… et nous avons notre frontend ! Vous noterez que les dossiers frontend et backend sont séparés, et donc initialement décorrelés.</p>

<p>Allez dans le dossier frontend et lancez la commande suivante pour démarrer votre serveur local (on remarquera encore que les adresses de serveurs locaux du frontend et du backend sont différentes; les 2 entités sont totalement dissociées) :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>frontend
npm run serve
</code></pre></div></div>

<p><img src="../../../assets/projets/md2_vue_drf/vue-pic.png" alt="frontend"></p>

<blockquote>
  <p>Petit préambule : pour un plus joli design, ajoutez cette “petite” balise CDN dans votre fichier public/index.html pour intégrer Bootstrap :</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// index.html

...

&lt;<span class="nb">link </span><span class="nv">rel</span><span class="o">=</span><span class="s2">"icon"</span> <span class="nv">href</span><span class="o">=</span><span class="s2">"&lt;%= BASE_URL %&gt;favicon.ico"</span><span class="o">&gt;</span>
&lt;<span class="nb">link </span><span class="nv">href</span><span class="o">=</span><span class="s2">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"</span> <span class="nv">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nv">integrity</span><span class="o">=</span><span class="s2">"sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"</span> <span class="nv">crossorigin</span><span class="o">=</span><span class="s2">"anonymous"</span><span class="o">&gt;</span>

...
</code></pre></div></div>
<blockquote>
  <p>L’affichage sera plus beau à voir qu’un simple html :)</p>
</blockquote>

<p>On commence par créer les fichiers .vue qui nous seront utiles pour la suite. Dans le dossier ‘src/views/’, on crée deux fichiers : TaskList.vue et TaskDetail.vue, qui renverront la liste de toutes nos tasks, et pour chaque task ses détails. Dans le dossier ‘src/components/’, on crée deux autres fichiers : TaskCreate.vue et TaskUpdate.vue, qui seront intégrés dans les views.</p>

<p>Dans App.vue, on peut supprimer le contenu de <template> qui ne nous servira pas, et le remplacer par ceci :</template></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//App.vue


&lt;template&gt;
  &lt;div&gt;
    &lt;div <span class="nb">id</span><span class="o">=</span><span class="s2">"nav"</span><span class="o">&gt;</span>
      &lt;img <span class="nv">alt</span><span class="o">=</span><span class="s2">"Vue logo"</span> <span class="nv">src</span><span class="o">=</span><span class="s2">"./assets/logo.png"</span><span class="o">&gt;</span>
    &lt;/div&gt;
    &lt;router-view/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;style&gt;
<span class="c">#app {</span>
  font-family: Avenir, Helvetica, Arial, sans-serif<span class="p">;</span>
  <span class="nt">-webkit-font-smoothing</span>: antialiased<span class="p">;</span>
  <span class="nt">-moz-osx-font-smoothing</span>: grayscale<span class="p">;</span>
  text-align: center<span class="p">;</span>
  color: <span class="c">#2c3e50;</span>
<span class="o">}</span>

<span class="c">#nav {</span>
  padding: 30px<span class="p">;</span>
<span class="o">}</span>

<span class="c">#nav a {</span>
  font-weight: bold<span class="p">;</span>
  color: <span class="c">#2c3e50;</span>
<span class="o">}</span>

<span class="c">#nav a.router-link-exact-active {</span>
  color: <span class="c">#42b983;</span>
<span class="o">}</span>
&lt;/style&gt;
</code></pre></div></div>
<p>Cela fera que lorsque l’on démarre notre serveur local pour voir le frontend, on aura toujours le logo de Vue affiché sur toutes les pages, et la balise <router-view> sert ici de repère pour afficher toutes les views ou components selon l'URL du router.</router-view></p>

<p>Occupons-nous de ce dernier. Ouvrez le fichier ‘router/index.js’, et réécrivez-le de la sorte :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// router/index.js


import <span class="o">{</span> createRouter, createWebHistory <span class="o">}</span> from <span class="s1">'vue-router'</span>
import TaskList from <span class="s1">'../views/TaskList'</span>
import TaskDetail from <span class="s1">'../views/TaskDetail'</span>

const routes <span class="o">=</span> <span class="o">[</span>
  <span class="o">{</span>
    path: <span class="s1">'/'</span>,
    <span class="nb">alias</span>: <span class="s1">'/tasks'</span>,
    name: <span class="s1">'task-list'</span>,
    component: TaskList
  <span class="o">}</span>,
  <span class="o">{</span>
    path: <span class="s1">'/tasks/:id'</span>,
    name: <span class="s1">'task-detail'</span>,
    component: TaskDetail
  <span class="o">}</span>,
<span class="o">]</span>

const router <span class="o">=</span> createRouter<span class="o">({</span>
  <span class="nb">history</span>: createWebHistory<span class="o">(</span>process.env.BASE_URL<span class="o">)</span>,
  routes
<span class="o">})</span>

<span class="nb">export </span>default router
</code></pre></div></div>
<p>On définit ici deux routes, ‘/’ (ou ‘/tasks’, cela donnera le même résultat) pour afficher la liste de toutes nos tasks en bdd, et ‘/tasks/:id’ qui nous donnera le détail de la task correspondant à l’id en URL. Pour chacune de ces routes, le fichier .vue qui sera affiché sur la page sera respectivement TaskList.vue et TaskDetail.vue.</p>

<p>Il reste maintenant à coder nos fichiers .vue pour récupérer les informations du backend, via notre API. Avant cela, nous allons installé sur notre frontend le module <a href="https://fr.vuejs.org/v2/cookbook/using-axios-to-consume-apis.html">Axios</a>, utilisé pour gérer et consommer des APIs.
Toujours dans votre dossier frontend, exécutez :</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install </span>axios <span class="nt">--save</span>
</code></pre></div></div>
<p>Et maintenant, voici nos fichiers .vue :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// TaskList.vue

&lt;template&gt;
  &lt;div class="tasks"&gt;
      &lt;div class="table"&gt;
          &lt;table class="w-50 m-auto"&gt;
              &lt;thead&gt;
                  &lt;td&gt;TASK&lt;/td&gt;
                  &lt;td&gt;ACCOMPLISHED?&lt;/td&gt;
              &lt;/thead&gt;
              &lt;tr v-for="task in tasks" :key="task.id"&gt;
                  &lt;td&gt;&lt;/td&gt;
                  &lt;td&gt;&lt;/td&gt;
                  &lt;td&gt;&lt;router-link class="btn btn-secondary" :to="{'name': 'task-detail', 'params': {'id': task.id}}"&gt;See Task&lt;/router-link&gt;&lt;/td&gt;
                  &lt;td&gt;&lt;button class="btn btn-danger" @click="deleteTask(task.id)"&gt;Delete Task&lt;/button&gt;&lt;/td&gt;
              &lt;/tr&gt;
          &lt;/table&gt;
      &lt;/div&gt;
      &lt;br&gt;&lt;br&gt;
      &lt;button class="btn btn-primary" @click="addTask()"&gt;Add a Task&lt;/button&gt;
      &lt;br&gt;&lt;br&gt;
      &lt;task-create v-if="create"/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import axios from 'axios'
import TaskCreate from '../components/TaskCreate.vue'
export default {
    name: 'TaskList',
    components: {TaskCreate},
    data() {
        return {
            tasks: [],
            create: false
        }
    },
    methods: {
        getTaskList() {
            axios.get('http://127.0.0.1:8000/api/tasks/')
            .then(response =&gt; {
                this.tasks = response.data
                console.log(response)
            })
        },
        addTask() {
            this.create = !this.create
            console.log(this.create)
        },
        deleteTask(id) {
            if (confirm("Are you sure you want to delete the task?")) {
                axios.delete(`http://127.0.0.1:8000/api/tasks/${id}/`)
                .then(response =&gt; {
                    window.location.reload()
                    console.log(response)
                })
            }
        }
        
    },
    mounted() {
        this.getTaskList()
    },
}
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// TaskDetail.vue


&lt;template&gt;
  &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"task"</span><span class="o">&gt;</span>
      &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"table"</span><span class="o">&gt;</span>
        &lt;table <span class="nv">class</span><span class="o">=</span><span class="s2">"w-50 m-auto"</span><span class="o">&gt;</span>
            &lt;thead&gt;
                &lt;td&gt;TASK&lt;/td&gt;
                &lt;td&gt;ACCOMPLISHED?&lt;/td&gt;
            &lt;/thead&gt;
            &lt;<span class="nb">tr</span><span class="o">&gt;</span>
                &lt;td&gt;&lt;/td&gt;
                &lt;td&gt;&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/table&gt;
      &lt;/div&gt;
      &lt;br&gt;&lt;br&gt;
      &lt;button <span class="nv">class</span><span class="o">=</span><span class="s2">"btn btn-primary"</span> @click<span class="o">=</span><span class="s2">"updateTask()"</span><span class="o">&gt;</span>Update Task&lt;/button&gt;
      &lt;router-link <span class="nv">class</span><span class="o">=</span><span class="s2">"m-4 btn btn-secondary"</span> :to<span class="o">=</span><span class="s2">"{'name': 'task-list'}"</span><span class="o">&gt;</span>Back to List&lt;/router-link&gt;
      &lt;br&gt;&lt;br&gt;&lt;br&gt;
      &lt;task-update :task<span class="o">=</span><span class="s2">"task"</span> v-if<span class="o">=</span><span class="s2">"update"</span>/&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import axios from <span class="s1">'axios'</span>
import TaskUpdate from <span class="s1">'../components/TaskUpdate.vue'</span>
<span class="nb">export </span>default <span class="o">{</span>
    name: <span class="s1">'TaskDetail'</span>,
    components: <span class="o">{</span>TaskUpdate<span class="o">}</span>,
    data<span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">{</span>
            task: <span class="o">{</span>
                <span class="nb">id</span>: <span class="s1">''</span>,
                content: <span class="s1">''</span>,
                completion: null
            <span class="o">}</span>,
            update: <span class="nb">false</span>
        <span class="o">}</span>
    <span class="o">}</span>,
    methods: <span class="o">{</span>
        getTask<span class="o">()</span> <span class="o">{</span>
            <span class="nb">let </span>index <span class="o">=</span> this.<span class="nv">$route</span>.params.id
            axios.get<span class="o">(</span><span class="sb">`</span>http://127.0.0.1:8000/api/tasks/<span class="k">${</span><span class="nv">index</span><span class="k">}</span>/<span class="sb">`</span><span class="o">)</span>
            .then<span class="o">(</span>response <span class="o">=&gt;</span> <span class="o">{</span>
                this.task.id <span class="o">=</span> response.data.id
                this.task.content <span class="o">=</span> response.data.content
                this.task.completion <span class="o">=</span> response.data.completion
                console.log<span class="o">(</span>response<span class="o">)</span>
            <span class="o">})</span>
        <span class="o">}</span>,
        updateTask<span class="o">()</span> <span class="o">{</span>
            this.update <span class="o">=</span> <span class="o">!</span>this.update
            console.log<span class="o">(</span>this.update<span class="o">)</span>
        <span class="o">}</span>
    <span class="o">}</span>,
    mounted<span class="o">()</span> <span class="o">{</span>
        this.getTask<span class="o">()</span>
    <span class="o">}</span>,
<span class="o">}</span>
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// TaskCreate.vue


&lt;template&gt;
  &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"create"</span><span class="o">&gt;</span>
        &lt;form <span class="nv">class</span><span class="o">=</span><span class="s2">"input-group w-50 m-auto"</span><span class="o">&gt;</span>
            &lt;input <span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> required <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"content"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"content"</span> v-model<span class="o">=</span><span class="s2">"task.content"</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"content"</span><span class="o">&gt;</span>
            &lt;br&gt;&lt;br&gt;
            &lt;<span class="k">select </span><span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> v-model<span class="o">=</span><span class="s2">"task.completion"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"completion"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"completion"</span><span class="o">&gt;</span>
                &lt;option disabled <span class="nv">value</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>Choose&lt;/option&gt;
                &lt;option v-for<span class="o">=</span><span class="s2">"(choice, i) in task.choices"</span> :key<span class="o">=</span><span class="s2">"i"</span><span class="o">&gt;</span>&lt;/option&gt;
            &lt;/select&gt;
            &lt;br&gt;&lt;br&gt;
            &lt;button <span class="nv">class</span><span class="o">=</span><span class="s2">"btn btn-success"</span> @click<span class="o">=</span><span class="s2">"createTask()"</span><span class="o">&gt;</span>create&lt;/button&gt;
        &lt;/form&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import axios from <span class="s1">'axios'</span>
<span class="nb">export </span>default <span class="o">{</span>
    name: <span class="s1">'TaskCreate'</span>,
    data<span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">{</span>
            task: <span class="o">{</span>
                content: <span class="s1">''</span>,
                choices: <span class="o">[</span><span class="s1">'done'</span>, <span class="s1">'not done'</span><span class="o">]</span>,
                completion: <span class="s1">''</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>,
    methods: <span class="o">{</span>
        createTask<span class="o">()</span> <span class="o">{</span>
            axios.post<span class="o">(</span><span class="s1">'http://127.0.0.1:8000/api/tasks/'</span>,
            <span class="o">{</span>
                content: this.task.content,
                completion: this.task.completion
            <span class="o">})</span>
            .then<span class="o">(</span>response <span class="o">=&gt;</span> <span class="o">{</span>
                console.log<span class="o">(</span>response<span class="o">)</span>
            <span class="o">})</span>
        <span class="o">}</span>
    <span class="o">}</span>,
<span class="o">}</span>
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// TaskUpdate.vue


&lt;template&gt;
  &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"update"</span><span class="o">&gt;</span>
        &lt;form <span class="nv">class</span><span class="o">=</span><span class="s2">"input-group w-50 m-auto"</span><span class="o">&gt;</span>
            &lt;input <span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> required <span class="nb">type</span><span class="o">=</span><span class="s2">"text"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"content"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"content"</span> v-model<span class="o">=</span><span class="s2">"task.content"</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">"content"</span><span class="o">&gt;</span>
            &lt;<span class="k">select </span><span class="nv">class</span><span class="o">=</span><span class="s2">"form-control"</span> v-model<span class="o">=</span><span class="s2">"task.completion"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"completion"</span> <span class="nb">id</span><span class="o">=</span><span class="s2">"completion"</span><span class="o">&gt;</span>
                &lt;option disabled <span class="nv">value</span><span class="o">=</span><span class="s2">""</span><span class="o">&gt;</span>Choose&lt;/option&gt;
                &lt;option v-for<span class="o">=</span><span class="s2">"(choice, i) in choices"</span> :key<span class="o">=</span><span class="s2">"i"</span><span class="o">&gt;</span>&lt;/option&gt;
            &lt;/select&gt;
            &lt;button <span class="nv">class</span><span class="o">=</span><span class="s2">"btn btn-success"</span> @click<span class="o">=</span><span class="s2">"updateTask(task.id)"</span><span class="o">&gt;</span>update&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import axios from <span class="s1">'axios'</span>
<span class="nb">export </span>default <span class="o">{</span>
    name: <span class="s1">'TaskUpdate'</span>,
    props: <span class="o">{</span>
        task: <span class="o">{</span>
            <span class="nb">id</span>: Number,
            content: String,
            completion: String
        <span class="o">}</span>
    <span class="o">}</span>,
    data<span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">{</span>
            choices: <span class="o">[</span><span class="s1">'done'</span>, <span class="s1">'not done'</span><span class="o">]</span>
        <span class="o">}</span>
    <span class="o">}</span>,
    methods: <span class="o">{</span>
        getTask<span class="o">(</span><span class="nb">id</span><span class="o">)</span> <span class="o">{</span>
            axios.get<span class="o">(</span><span class="sb">`</span>http://127.0.0.1:8000/api/tasks/<span class="k">${</span><span class="nv">id</span><span class="k">}</span>/<span class="sb">`</span><span class="o">)</span>
            .then<span class="o">(</span>response <span class="o">=&gt;</span> <span class="o">{</span>
                this.task.content <span class="o">=</span> response.data.content
                this.task.completion <span class="o">=</span> response.data.completion
                console.log<span class="o">(</span>response<span class="o">)</span>
            <span class="o">})</span>
        <span class="o">}</span>,
        updateTask<span class="o">(</span><span class="nb">id</span><span class="o">)</span> <span class="o">{</span>
            axios.put<span class="o">(</span><span class="sb">`</span>http://127.0.0.1:8000/api/tasks/<span class="k">${</span><span class="nv">id</span><span class="k">}</span>/<span class="sb">`</span>,
            <span class="o">{</span>
               content: this.task.content,
                completion: this.task.completion
            <span class="o">})</span>
            .then<span class="o">(</span>response <span class="o">=&gt;</span> <span class="o">{</span>
                console.log<span class="o">(</span>response<span class="o">)</span>
            <span class="o">})</span>
        <span class="o">}</span>
    <span class="o">}</span>,
<span class="o">}</span>
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;
</code></pre></div></div>
<p>Voilà ce que ça donne :</p>

<p><img src="../../../assets/projets/md2_vue_drf/tasklist-pic.png" alt="tasklist"></p>

<p>Je ne vous fait pas le détail de chaque fichier car le tuto commence à être très long, mais simplement un petit point sur Axios et les appels d’API :</p>

<p>Axios récupère l’URL d’API qui l’intéresse, en l’occurence ici nos URLs définies dans le backend, avec une method associée au type de requête (axios.get(), axios.post(), etc.); on peut aussi y inclure des données en paramètres si par exemple la requête est de type POST ou PUT.</p>

<p>Axios gère également la réponse du côté serveur, qu’on peut donc récupérer et traiter les données incluses.</p>

<p>Et voilà pour la partie frontend !</p>

<h2 id="conclusion">Conclusion</h2>

<p>Le projet devrait pouvoir marcher si tout s’est bien passé (ce qui n’est souvent pas le cas en général…) ! N’hésitez pas à pull le <a href="https://github.com/simsimdrobs/api-vuejs-drf">projet</a> directement sur votre machine pour le tester et voir l’ensemble du code. Il vous faudra bien avoir les technologies requises installées pour le faire tourner, assurez-vous de cela en amont.</p>

<p>Le projet paraît conséquent pour une si petite app; j’en conviens. Le but ici est surtout de voir comment est structurée une application full-stack (frontend &amp; backend dissociés) et comment la communication se fait entre les sous-apps du projet.</p>

<p>L’idée était aussi de montrer une technologie un peu moins connue mais en plein essor comme Django; toutefois n’hésitez pas à réadapter le projet à votre sauce avec un backend en Node.js !</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique à l'école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
