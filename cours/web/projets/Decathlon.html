<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Decathlon Django | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="Decathlon Django">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille.">
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille.">
<link rel="canonical" href="/cours_informatique/cours/web/projets/Decathlon.html">
<meta property="og:url" content="/cours_informatique/cours/web/projets/Decathlon.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Decathlon Django">
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique à l’école centrale marseille.","@type":"WebPage","url":"/cours_informatique/cours/web/projets/Decathlon.html","headline":"Decathlon Django","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Decathlon Django</h1>Auteur : <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Solenzio Konlé</span></span>
  </header>

  <div class="post-content">
    <p>Ce projet fut initié à l’origine dans le cadre du projet de Méthode de Développement de l’option Digital.e.
Le git du projet peut être trouvé <a href="https://github.com/sconle/decathlon">ici</a>.</p>

<h2 id="décathlon">Décathlon</h2>

<p>Le décathlon est un jeu de dé basé sur la discipline du décathlon. Il y a dix épreuves différentes bien qu’il n’y ait pour l’instant qu’une seule de développée: le lancé de javelot.
Les règles sont disponibles sur ce <a href="http://www.jeuxprintandplay.fr/Jeux/Decathlon/DECATHLONfr.pdf">PDF</a>.</p>

<h3 id="technologies-utilisées">Technologies utilisées</h3>

<p>Les technologies utilisées sont Django en back, du simple HTML/CSS/JavaScript pour le front et sqlite3 comme BDD.</p>

<blockquote>
  <p>La mise en place d’un projet Django a été expliquée en détail dans un autre projet de MD2, vous pouvez le retrouver <a href="https://francoisbrucker.github.io/cours_informatique/cours/web/projets/md2_vue_drf.html">ici</a>.</p>
</blockquote>

<p>Ainsi, je ne vais pas redonner tous les éléments d’installation d’un projet Django mais vais donner quelques petits conseils sur des éléments que j’ai pu relever.</p>

<h3 id="déroulé-du-projet">Déroulé du projet</h3>

<p>En première idée je souhaitais utiliser les WebSockets afin d’avoir un jeu en multijoueur. Il fallait donc créer une structure d’utilisateur.
Heureusement Django offre déjà un modèle de User avec des fonctions prédéfinis bien pratique.</p>

<p>Les fonctions les plus utiles des User sont:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">authenticate</code> qui permet de trouver si un user exists en fonction d’un pseudo et d’un password</li>
  <li>
<code class="language-plaintext highlighter-rouge">login</code> qui permet de log un user à la session actuelle</li>
  <li>
<code class="language-plaintext highlighter-rouge">logout</code> qui permet de déconnecter le user actuel de la session</li>
  <li>
<code class="language-plaintext highlighter-rouge">User.objects.create_user</code> qui crée un user à partir d’un pseudo, un email et un password</li>
</ul>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.contrib.auth.models import User
from django.contrib.auth import authenticate, login, <span class="nb">logout </span>as true_logout

def connexion<span class="o">(</span>request, pseudo, <span class="nb">pwd</span>, mail<span class="o">)</span>:
  user <span class="o">=</span> authenticate<span class="o">(</span><span class="nv">username</span><span class="o">=</span>pseudo, <span class="nv">password</span><span class="o">=</span><span class="nb">pwd</span><span class="o">)</span>
  <span class="k">if </span>user is not None:
    login<span class="o">(</span>request, user<span class="o">)</span>
  <span class="k">else</span>:
    user <span class="o">=</span> User.objects.create_user<span class="o">(</span>pseudo, mail, <span class="nb">pwd</span><span class="o">)</span>
    login<span class="o">(</span>request, user<span class="o">)</span>
  <span class="k">return </span>render<span class="o">(</span>request, <span class="s2">"connexion.html"</span><span class="o">)</span>
  
 def deconnexion<span class="o">(</span>request<span class="o">)</span>:
  true_logout<span class="o">(</span>request<span class="o">)</span>
  <span class="k">return </span>redirect<span class="o">(</span><span class="s2">"/"</span><span class="o">)</span>
</code></pre></div></div>

<p>Ici un petit exemple de deux vues, l’une qui connecte et l’autre qui déconnecte.</p>
<blockquote class="attention">
  <p>Lorsque l’on utilise la fonction <code class="language-plaintext highlighter-rouge">logout</code>, il vaut mieux la renommer car cette dernière peut parfois déjà exister en tant que fonction native.</p>
</blockquote>

<p>Pour le reste des modèles du site, nous en créerons un par jeu. Pour l’instant il n’y a donc que la classe JavelotThrow.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from django.db import models


def dict_scoreboard<span class="o">()</span>:
    <span class="k">return</span> <span class="o">{</span><span class="s2">"player1"</span>: 0,
            <span class="s2">"player2"</span>: 0,
            <span class="s2">"player3"</span>: 0,
            <span class="s2">"player4"</span>: 0
            <span class="o">}</span>

def dict_dice<span class="o">()</span>:
    <span class="k">return</span> <span class="o">{</span><span class="s2">"1"</span>: 1,
            <span class="s2">"2"</span>: 1,
            <span class="s2">"3"</span>: 1,
            <span class="s2">"4"</span>: 1,
            <span class="s2">"5"</span>: 1,
            <span class="s2">"6"</span>: 1
            <span class="o">}</span>


def dict_keeped<span class="o">()</span>:
    <span class="k">return</span> <span class="o">{}</span>


class JavelinThrow<span class="o">(</span>models.Model<span class="o">)</span>:
    name <span class="o">=</span> models.CharField<span class="o">(</span><span class="nv">max_length</span><span class="o">=</span>20<span class="o">)</span>
    dice_value <span class="o">=</span> models.JSONField<span class="o">(</span><span class="nv">default</span><span class="o">=</span>dict_dice<span class="o">())</span>
    dice_keeped <span class="o">=</span> models.JSONField<span class="o">(</span><span class="nv">default</span><span class="o">=</span>dict_keeped<span class="o">())</span>
    currentPlayer <span class="o">=</span> models.CharField<span class="o">(</span><span class="nv">default</span><span class="o">=</span><span class="s2">"player1"</span>, <span class="nv">max_length</span><span class="o">=</span>50<span class="o">)</span>
    scoreboard <span class="o">=</span> models.JSONField<span class="o">(</span><span class="nv">default</span><span class="o">=</span>dict_scoreboard<span class="o">)</span>
    remaining_attempts <span class="o">=</span> models.IntegerField<span class="o">(</span><span class="nv">default</span><span class="o">=</span>3<span class="o">)</span>
    is_online <span class="o">=</span> models.BooleanField<span class="o">(</span><span class="nv">default</span><span class="o">=</span>True<span class="o">)</span>
    number_of_player <span class="o">=</span> models.IntegerField<span class="o">(</span><span class="nv">default</span><span class="o">=</span>4<span class="o">)</span>
</code></pre></div></div>

<p>Pour l’instant, le site a donc comme fonctionnalités de supporter un système de gestion d’utilisateur ainsi que le mini-jeu lancer de javelot où l’on peut choisir de jouer entre 2 et 4 joueurs et où le scoreboard est sauvegardé.</p>

<h3 id="lancer-le-projet-en-local">Lancer le projet en local</h3>

<p>Si vous souhaitez installer le projet, il faut d’abord cloner le débot sur votre ordinateur</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:sconle/decathlon.git
</code></pre></div></div>

<p>Il faut ensuite <a href="https://docs.python.org/fr/3/library/venv.html">créer un venv</a>. Puis enfin installer le requirements.txt:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>decathlon
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>

<p>Enfin il faut effectuer les migrations pour la BDD</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>src
python manage.py makemigrations
python manage.py migrate
</code></pre></div></div>

<p>Il ne suffit plus que lancer le serveur:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python manage.py runserver
</code></pre></div></div>

<p>Il sera ensuite disponible sur 127.0.0.1:8000.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique à l'école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
