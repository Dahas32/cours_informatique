<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Création d’environnements 3D avec three.js | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="Création d’environnements 3D avec three.js">
<meta name="author" content="Rose Simon">
<meta property="og:locale" content="en_US">
<meta name="description" content="Support de cours/td d’informatique de François Brucker.">
<meta property="og:description" content="Support de cours/td d’informatique de François Brucker.">
<link rel="canonical" href="/cours_informatique/cours/web/js/threejs.html">
<meta property="og:url" content="/cours_informatique/cours/web/js/threejs.html">
<meta property="og:site_name" content="cours d’informatique">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Création d’environnements 3D avec three.js">
<script type="application/ld+json">
{"headline":"Création d’environnements 3D avec three.js","description":"Support de cours/td d’informatique de François Brucker.","@type":"WebPage","url":"/cours_informatique/cours/web/js/threejs.html","author":{"@type":"Person","name":"Rose Simon"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">

  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Création d'environnements 3D avec three.js</h1>Auteurs :
      <ul>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Rose Simon</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Laurent Léo</span></span></li>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Pépin Anthony</span></span></li>
      
      </ul>
  </header>

  <div class="post-content">
    <h2 id="introduction">Introduction</h2>

<h3 id="threejs-cest-quoi">Three.js c’est quoi?</h3>

<p>Three.js est une librairie qui permet de créer du contenu 3D sur un navigateur très facilement. L’intérêt de la librairie est que la plupart des navigateurs internet supportent three.js, et qu’il est donc possible de diffuser son code sans avoir à recourir à des plugins pour le faire fonctionner.
Three.js utilise presque systématiquement WebGL comme moteur de rendu (renderer en anglais) qui est un système de bas niveau qui ne permet de ne dessiner que des points, des lignes et des triangles. L’utilisation directe de WebGL pour générer du contenu 3D est longue et demande une grande quantité de code car il va tout falloir créer “à la main”. C’est là qu’intervient three.js: la librairie sert d’intermédiaire entre l’utilisateur et WebGL afin de traduire facilement le travail de l’utilisateur pour WebGL. Three.js utilise notamment des scènes, lumière, matériaux, caméras, textures, filet (mesh), etc, commme outils pour accélérer le travail.</p>

<h3 id="à-quoi-sert-ce-tuto">À quoi sert ce tuto?</h3>
<p>Il est possible de faire plein de choses en Threejs comme des animations, jeux, navigations de page … En voilà un exemple :</p>

<p><img src="/cours_informatique/assets/cours/web/threejs/planete.gif" alt="une planete" style="margin: auto;display: block;"></p>

<p>Vous pouvez trouver une liste beaucoup plus détaillée sur le <a href="https://threejs.org/examples/">site officiel</a>.</p>

<p>Le but de ce tuto est d’apprendre les bases de three.js afin de mener à bien un projet simple. Le projet que nous avons choisi pour travailler sur la librairie est de créer un petit environnement 3D dans lequel on pourra déplacer une caméra à l’aide de la souris et du clavier.</p>

<h2 id="installation">Installation</h2>

<h3 id="prérequis">Prérequis</h3>

<p>On va utiliser three.js et vite.js, que l’on intallera avec node packet manager.
Il faut donc avoir installé <a href="https://nodejs.org/en/download/">node.js</a> 
au préalable.</p>

<p>Pour plus de confort, on vous conseille également d’utiliser un IDE pour 
coder, par exemple <a href="https://code.visualstudio.com/download">VSCode</a>.</p>

<h3 id="threejs-et-vitejs">Three.js et vite.js</h3>

<p>On crée un dossier <code class="language-plaintext highlighter-rouge">three-js-project/</code> qui sera la racine de notre projet.</p>

<p>On installe dedans three.js avec la commande <code class="language-plaintext highlighter-rouge">npm install --save three</code>.</p>

<p>Pour utiliser three.js, on va créer une app web qu’on va faire tourner 
avec <a href="https://vitejs.dev/">vite.js</a>.</p>

<p>vite.js permet d’actualiser en direct notre projet web lorsqu’on modifie notre 
code, le rendant très utile pendant la phase de développement, surtout pour faire 
du three.js.</p>

<p>Dans le dossier <code class="language-plaintext highlighter-rouge">three-js-project/</code>, on entre la commande <code class="language-plaintext highlighter-rouge">npm init vite@latest</code> 
pour installer vite.js.</p>

<p>Il nous demande ensuite d’entrer le nom de notre app (on va l’appeler <code class="language-plaintext highlighter-rouge">app-vite</code>) 
puis quel type de projet on veut créer: on choisit ici vanilla pour partir 
de rien.</p>

<p>On suit ensuite ses instructions: On va dans le dossier <code class="language-plaintext highlighter-rouge">app-vite</code> qu’il vient 
de générer et on installe les packages nécessaires avec <code class="language-plaintext highlighter-rouge">npm install</code>.</p>

<p>On peut ensuite faire un <code class="language-plaintext highlighter-rouge">npm run dev</code> pour lancer notre application en local. 
En allant sur http://localhost:3000/ on peut voir notre appli !</p>

<p>Allons voir dans <code class="language-plaintext highlighter-rouge">app-vite/</code> la structure de notre code: La page qui s’affiche est 
notre <code class="language-plaintext highlighter-rouge">index.html</code>, dans lequel on trouve un appel à notre fichier <code class="language-plaintext highlighter-rouge">main.js</code>:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"app"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"module"</span> <span class="na">src=</span><span class="s">"/main.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>
<p>Dans notre main.js on a ce qui s’affiche pour l’instant sur la page <code class="language-plaintext highlighter-rouge">index.html</code>:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#app</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">`
  &lt;h1&gt;Hello Vite!&lt;/h1&gt;
  &lt;a href="https://vitejs.dev/guide/features.html" target="_blank"&gt;Documentation&lt;/a&gt;
`</span>
</code></pre></div></div>

<p>C’est ici qu’on va coder l’intégralité de notre code pendant ce tutoriel. 
Pour le moment enlevons ces lignes et remplaçons ça par l’import de three.js :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>C’est tout bon, on peut passer au vif du sujet !</p>

<h2 id="les-bases">Les bases</h2>

<h3 id="structure-du-projet">Structure du projet</h3>

<p>Maintenant que toutes les librairies nécessaires ont été implémentées, on va pouvoir s’intéresser à la structure du code pour un projet three.js.
Dans un premier temps, comme on a vu juste au dessus et comme dans tout projet en js, on importe les différents éléments dont on aura besoin pour développer notre projet.
Ensuite on initialise les variables importantes du projet ( en particulier la scène, la caméra et le renderer que l’on va voir juste après). Ces variables sont les variables globales qu’on va modifier dans nos fonctions.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">camera</span><span class="p">;</span>
</code></pre></div></div>
<p>On utilise ensuite une fonction d’initialisation pour donner des propriétés à ces variables et établir toutes les actions que l’on veut faire faire à notre environnement 3D.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">init</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">camera</span> <span class="o">=</span> <span class="p">...;</span>
    <span class="nx">scene</span> <span class="o">=</span> <span class="p">...;</span>
    <span class="nx">renderer</span> <span class="o">=</span> <span class="p">...;</span>
    <span class="kd">const</span> <span class="nx">light</span> <span class="o">=</span> <span class="p">...;</span>
    <span class="kd">const</span> <span class="nx">mesh</span> <span class="o">=</span> <span class="p">...;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>On remarque que l’appel à la fonction init() a lieu avant la déclaration de celle-ci. Ce n’est pas une particularité de three.js mais directement de js. Le fait d’utiliser la déclaration <em>function</em> permet de définir la fonction avant qu’elle ne soit utilisée ailleurs, même si cet ailleurs est avant dans le code.</p>

<h3 id="scene-camera-et-renderer">Scene, Camera et Renderer</h3>

<p>Donc on a vu que three.js utilise des outils afin de faciliter le travail de l’utilisateur. Les outils les plus importants sont les scènes, les caméras et les renderer (moteurs de rendu). Ces trois éléments sont essentiels à tout projet three.js, sans eux impossible d’afficher quoi que ce soit. Concrètement on va utiliser la caméra pour faire un rendu de la scène.</p>

<ul>
  <li>La scène correspond donc à notre environnement de travail, ce qui va être rendu visible par le renderer. Elle permet de localiser avec des coordonnées 3D les différents objets que l’on va ensuite créer. L’object scene ayant déjà été créé avant le fonction init(), on peut se contenter ici de le modifier sans l’initialiser.
    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>
</code></pre></div>    </div>
  </li>
  <li>Les caméras sont aussi un point essentiel de three.js car elles définissent comment la scène va etre vu par l’utilisateur final. Il existe plusieurs types de caméras avec des possibilités et des effets différents. Une des caméras les plus utilisées est la PerspectiveCamera qui mimique la vision humaine.
    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span> <span class="mi">110</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1000</span> <span class="p">);</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">camera</span><span class="p">.</span><span class="nx">lookAt</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
</code></pre></div>    </div>
    <p>Ici on définit une caméra avec différentes propriétés : le <strong>FOV</strong> (Field of view), l’<strong>aspect</strong> qu’on définit ici comme le rapport entre la largeur et la hauteur de l’écran, et enfin les valeurs pour <strong>near</strong> et <strong>far</strong>. Ces deux valeurs déterminent à quelle distance se trouvent les plans limite de la caméra. Tout ce qui se trouve avant le plan near et après le plan far ne sera pas vu par la caméra et ne sera donc pas rendu par le renderer.</p>
  </li>
</ul>

<p>On peut aussi définir la position ainsi que la direction dans laquelle la caméra regarde de manière relative à la scène que l’on a créée avant.</p>

<p><img src="/cours_informatique/assets/cours/web/threejs/camera.jpg" alt="une camera" style="margin: auto;display: block;"></p>

<ul>
  <li>Enfin le moteur de rendu ou renderer. Il s’agit du travail final qui va venir faire un rendu 3D de la scène vu au travers de la caméra. L’objet final sera une image 2D de la scène 3D que l’on peut intégrer dans un canvas pour être utilisé directement en html. Comme dit précédemment, classiquement on utilise le moteur de rendu WebGLRenderer mais il est possible d’en utiliser d’autres (notamment au cas où des utilisateurs sont sur des vieux navigateurs qui ne supportent pas WebGL ce qui est rare).
De la même manière que pour la caméra, il est possible de définir l’<strong>aspect</strong> du rendu, par exemple relatif à la taille de l’écran sur lequel on va ensuite afficher l’image. La dernière ligne ajoute le renderer dans le body du fichier HTML pour qu’il puisse afficher quelque chose.
    <div class="language-javascript highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">({</span><span class="na">antialias</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="créer-un-plan-geometry-et-material">Créer un plan: Geometry et Material</h3>

<p>Pour l’instant notre scène est complètement vide. On va donc rajouter des objets !
Commençons par ajouter un plan.</p>

<p>Un objet est défini par deux attributs: Sa géométrie et son matériau.</p>

<p>La géométrie du plan est créée avec <code class="language-plaintext highlighter-rouge">PlaneGeometry</code> qui prend en paramètres 
les longueur et largeur du plan 
(l’unité de mesure est abstraite, elle est propre à three.js).</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">plane_geometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PlaneGeometry</span><span class="p">(</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span> <span class="p">);</span>
</code></pre></div></div>

<p>Ensuite on crée notre matériau avec <code class="language-plaintext highlighter-rouge">MeshStandardMaterial</code>. On spécifie sa couleur 
en hexadécimal (par exemple ici c’est du blanc).</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">plane_material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">(</span> <span class="nx">color</span><span class="p">:</span><span class="mh">0xffffff</span> <span class="p">);</span>
</code></pre></div></div>

<p>Puis on crée notre objet avec <code class="language-plaintext highlighter-rouge">Mesh</code> qui prend en paramètres la géométrie et le 
matériau. Tournons aussi notre plan pour faire un sol.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">plane</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="nx">plane_geometry</span><span class="p">,</span> <span class="nx">plane_material</span> <span class="p">);</span>
<span class="nx">plane</span><span class="p">.</span><span class="nx">rotateX</span><span class="p">(</span> <span class="o">-</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">);</span>
</code></pre></div></div>

<p>Et enfin, on l’ajoute à la scène:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">plane</span> <span class="p">);</span>
</code></pre></div></div>

<p>On peut créer n’importe quel type d’objet de cette manière. 
Une géométrie peut être créée point par point avec <code class="language-plaintext highlighter-rouge">ShapeGeometry()</code>, ou 
générée avec des fonctions prévues pour, comme <code class="language-plaintext highlighter-rouge">PlaneGeometry()</code>, 
<code class="language-plaintext highlighter-rouge">BoxGeometry()</code>… <a href="https://threejs.org/docs/index.html?q=geometry#api/en/geometries/BoxGeometry">A voir ici</a> 
la liste de toutes les formes possibles.</p>

<p>Il existe aussi de nombreux matériaux avec des propriétés différentes. Par 
exemple <code class="language-plaintext highlighter-rouge">MeshBasicMaterial()</code> ne gère pas les effets de lumière et d’ombres, 
alors que d’autres matériaux comme <code class="language-plaintext highlighter-rouge">MeshStandardMaterial()</code> ou <code class="language-plaintext highlighter-rouge">MeshPhongMaterial()</code> qui les supporte. 
<a href="https://threejs.org/docs/index.html?q=material#api/en/materials/MeshBasicMaterial">A voir ici</a> 
tous les matériaux disponibles.</p>

<h2 id="go-rendre-ça-plus-joli">Go rendre ça plus joli</h2>

<h3 id="adapter-lapp-à-la-fenêtre-du-navigateur">Adapter l’app à la fenêtre du navigateur</h3>

<p>Notre renderer apparait bien, mais n’occupe pas toute la fenêtre. En plus, il ne 
s’adapte pas à la taille de la fenêtre lorsqu’on la modifie.</p>

<p>Rajoutons cette fonction dans le main.js (en dehors de la fonction<code class="language-plaintext highlighter-rouge">init()</code>) pour 
permettre au renderer d’adapter sa taille en temps réel :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">onWindowResize</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">camera</span><span class="p">.</span><span class="nx">aspect</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">;</span>
    <span class="nx">camera</span><span class="p">.</span><span class="nx">updateProjectionMatrix</span><span class="p">();</span>

    <span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>On voit ici qu’on modifie à la fois le champ de la caméra et la taille du renderer. 
On doit ensuite ajouter un listener à la fin de notre fonction <code class="language-plaintext highlighter-rouge">init()</code>, 
qui vérifie si la taille de la fenêtre est 
modifiée, et appelle la fonction <code class="language-plaintext highlighter-rouge">onWindowResize()</code>quand c’est le cas :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="dl">'</span><span class="s1">resize</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onWindowResize</span> <span class="p">);</span>  
</code></pre></div></div>

<p>C’est mieux, mais on a toujours des marges blanches autour de notre renderer. 
Allons dans notre fichier <code class="language-plaintext highlighter-rouge">style.css</code>. On peut pour l’instant enlever ce qui y 
était et modifier la marge du body :</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">body</span> <span class="p">{</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Parfait, maintenant améliorons le rendu de nos objets.</p>

<h3 id="lumière">Lumière</h3>
<p>On peut améliorer notre rendu en ajoutant des lumières. Pour ajouter une lumière, c’est très simple, il suffit d’ajouter:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">light</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">DirectionalLight</span><span class="p">(</span><span class="mh">0xffffff</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>Le premier argument est le code couleur en hexadécimal de la lumière et le deuxième est son intensité.</p>

<p>Il suffit ensuite de choisir sa position et de l’ajouter à la scène :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">light</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">light</span><span class="p">);</span>
</code></pre></div></div>
<p>On a alors un plan qui est éclairé par le dessus.</p>

<h3 id="ombres">Ombres</h3>
<p>Un autre aspect pour augmenter la beauté de notre projet sont les ombres ! On peut en effet rajouter des ombres dans Three.js. Pour se faire, rien de plus simple :</p>

<p>On ajoute en premier un cube pour pouvoir voir les ombres :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cube_geometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">BoxGeometry</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">cube_material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">(</span><span class="mh">0xffffff</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cube</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="nx">cube_geometry</span><span class="p">,</span> <span class="nx">cube_material</span><span class="p">);</span>
<span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

</code></pre></div></div>
<p>Il faut maintenant lui autoriser à diffuser des ombres :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cube</span><span class="p">.</span><span class="nx">castShadow</span><span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">cube</span><span class="p">);</span>
</code></pre></div></div>

<p>De même pour la lumière, il faut aussi lui autoriser :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">light</span><span class="p">.</span><span class="nx">castShadow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</code></pre></div></div>

<p>Jusque la vous ne devez rien voir. Il faut aussi activer la résolution pour les ombres :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">renderer</span><span class="p">.</span><span class="nx">shadowMap</span><span class="p">.</span><span class="nx">enabled</span><span class="o">=</span> <span class="kc">true</span>
</code></pre></div></div>
<p>On a la lumière qui envoie des ombres, le cube qui envoie des ombres, mais qui doit les recevoir ? C’est le plan, ! Donc faisons en sorte qu’il le recoive :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">plane</span><span class="p">.</span><span class="nx">receiveShadow</span><span class="o">=</span> <span class="kc">true</span>
</code></pre></div></div>

<p>On remarque cependant que l’ombre est pixelisée : c’est parce que d’origine la <code class="language-plaintext highlighter-rouge">shadowMap</code> est de taille <code class="language-plaintext highlighter-rouge">512x512</code>, on peut l’augmenter par la commande :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">light</span><span class="p">.</span><span class="nx">shadowMapWidth</span> <span class="o">=</span> <span class="mi">512</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span>
<span class="nx">light</span><span class="p">.</span><span class="nx">shadowMapHeight</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span>
</code></pre></div></div>
<p>On va aussi rajouter un léger effet de flou sur les bords de l’ombre:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">light</span><span class="p">.</span><span class="nx">shadow</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</code></pre></div></div>

<p>Enfin, on aimerait ajouter une lumière ambiante partout dans notre scène, pour y voir un peu plus clair. 
On rajoute donc :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ambientLight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">AmbientLight</span><span class="p">(</span> <span class="mh">0xcccccc</span><span class="p">,</span> <span class="mf">0.3</span> <span class="p">);</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">ambientLight</span> <span class="p">);</span>
</code></pre></div></div>

<h3 id="fond-et-brouillard">Fond et Brouillard</h3>

<p>Pour l’instant le fond est complètement noir, c’est un peu triste. Rajoutons un 
fond bleu ciel et un effet de brouillard avec la distance.</p>

<p>Pour cela, rien de plus simple, ces deux lignes suffisent (à rajouter quand on crée 
notre scène):</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">scene</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Color</span><span class="p">(</span><span class="mh">0x87CEFA</span><span class="p">);</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">fog</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Fog</span><span class="p">(</span><span class="mh">0x87CEFA</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</code></pre></div></div>
<p>En choisissant la même couleur pour les deux, on a l’impression de ne plus distinguer 
le sol au loin (il se fond avec le fond). Les deux autres paramètres de <code class="language-plaintext highlighter-rouge">Fog()</code> 
sont near et far, c’est le même principe que lorsqu’on a créé la caméra.</p>

<h3 id="textures">Textures</h3>
<p>On a vu que pour tous les objets, nous avons besoin d’un <code class="language-plaintext highlighter-rouge">MeshMaterial</code> et d’une <code class="language-plaintext highlighter-rouge">Geometry</code>. Au début du projet, nous 
avons utilisé <code class="language-plaintext highlighter-rouge">MeshStandardMaterial</code>. C’est ici que nous devons mettre notre texture.</p>

<p>Elle sera divisée en plusieurs sous couches qui permettront un rendu plus que quali !</p>

<p>Pour ce projet, on choisit cette <a href="https://drive.google.com/drive/folders/1r2R96PnfH85xlv11MWRV8zSIT73Id3C9">texture</a> qui plus est gratuite. On les mets dans un dossier <code class="language-plaintext highlighter-rouge">img</code> dans le projet.</p>

<p>On doit alors charger toutes les images dans notre projet :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">textureloader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">()</span>
<span class="kd">const</span> <span class="nx">textureBasecolor</span> <span class="o">=</span> <span class="nx">textureloader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Concrete_Blocks_011_basecolor.jpg</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">textureAmbientOcclussion</span> <span class="o">=</span> <span class="nx">textureloader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Concrete_Blocks_011_ambientOcclusion.jpg</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">textureheight</span> <span class="o">=</span> <span class="nx">textureloader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Concrete_Blocks_011_height.jpg</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">texturenormal</span> <span class="o">=</span> <span class="nx">textureloader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Concrete_Blocks_011_normal.jpg</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">textureroughness</span> <span class="o">=</span> <span class="nx">textureloader</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Concrete_Blocks_011_roughness.jpg</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>
<p>Maintenant on peut ajouter les couches à notre cube :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cube_material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshStandardMaterial</span><span class="p">(</span>    
    <span class="p">{</span>
    <span class="na">map</span> <span class="p">:</span> <span class="nx">textureBasecolor</span><span class="p">,</span>
    <span class="na">normalMap</span><span class="p">:</span> <span class="nx">texturenormal</span><span class="p">,</span>
    <span class="na">bumpMap</span><span class="p">:</span> <span class="nx">textureheight</span><span class="p">,</span>
    <span class="na">roughnessMap</span><span class="p">:</span> <span class="nx">textureroughness</span><span class="p">,</span>
    <span class="na">roughness</span><span class="p">:</span><span class="mf">0.05</span>
<span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>
<p>Le problème est que la texture a besoin d’être rendue en boucle (on ne la voit pas sinon). Il faut donc rajouter la fonction suivante à la fin:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">animate</span><span class="p">(){</span>
    <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span><span class="nx">camera</span><span class="p">);</span>
    <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">animate</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">animate</span><span class="p">()</span>
</code></pre></div></div>

<p>animate() est exécutée à chaque frame: Dès qu’on veut modifier quelque chose en temps réel, on utilise cette fonction.</p>

<h3 id="pour-un-beau-parquet">Pour un beau parquet</h3>

<p>Maintenant qu’on a fait la texture du cube, on peut aller plus loin en faisant la texture du sol. On va alors utiliser cette <a href="https://drive.google.com/drive/folders/1_muKfn_cQXV6VTWbxuJpywb0tMq51SD8">texture</a>.
On refait le même travail :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">const</span> <span class="nx">textureloaderWood</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">TextureLoader</span><span class="p">()</span>
    <span class="kd">const</span> <span class="nx">textureBasecolorWood</span> <span class="o">=</span> <span class="nx">textureloaderWood</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Wood_Floor_009_basecolor.jpg</span><span class="dl">'</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">textureAmbientOcclussionWood</span> <span class="o">=</span> <span class="nx">textureloaderWood</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Wood_Floor_009_ambientOcclusion.jpg</span><span class="dl">'</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">textureheightWood</span> <span class="o">=</span> <span class="nx">textureloaderWood</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Wood_Floor_009_height.png</span><span class="dl">'</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">texturenormalWood</span> <span class="o">=</span> <span class="nx">textureloaderWood</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Wood_Floor_009_normal.jpg</span><span class="dl">'</span><span class="p">)</span>
    <span class="kd">const</span> <span class="nx">textureroughnessWood</span> <span class="o">=</span> <span class="nx">textureloaderWood</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="dl">'</span><span class="s1">img/Wood_Floor_009_roughness.jpg</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>
<p>A l’exception qu’ici notre texture est trop petite pour recouvrir tout notre sol. On doit alors répéter la texture :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">textureBasecolorWood</span><span class="p">.</span><span class="nx">wrapS</span> <span class="o">=</span> <span class="nx">textureBasecolorWood</span><span class="p">.</span><span class="nx">wrapT</span> <span class="o">=</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span>
    <span class="nx">textureBasecolorWood</span><span class="p">.</span><span class="nx">repeat</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
    <span class="nx">textureAmbientOcclussionWood</span><span class="p">.</span><span class="nx">wrapS</span> <span class="o">=</span> <span class="nx">textureAmbientOcclussionWood</span><span class="p">.</span><span class="nx">wrapT</span><span class="o">=</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span>
    <span class="nx">textureAmbientOcclussionWood</span><span class="p">.</span><span class="nx">repeat</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
    <span class="nx">textureheightWood</span><span class="p">.</span><span class="nx">wrapS</span> <span class="o">=</span> <span class="nx">textureheightWood</span><span class="p">.</span><span class="nx">wrapT</span><span class="o">=</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span>
    <span class="nx">textureheightWood</span><span class="p">.</span><span class="nx">repeat</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
    <span class="nx">texturenormalWood</span><span class="p">.</span><span class="nx">wrapS</span> <span class="o">=</span> <span class="nx">texturenormalWood</span><span class="p">.</span><span class="nx">wrapT</span><span class="o">=</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span>
    <span class="nx">texturenormalWood</span><span class="p">.</span><span class="nx">repeat</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
    <span class="nx">textureroughnessWood</span><span class="p">.</span><span class="nx">wrapS</span> <span class="o">=</span> <span class="nx">textureroughnessWood</span><span class="p">.</span><span class="nx">wrapT</span><span class="o">=</span><span class="nx">THREE</span><span class="p">.</span><span class="nx">RepeatWrapping</span>
    <span class="nx">textureroughnessWood</span><span class="p">.</span><span class="nx">repeat</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span> <span class="p">)</span>
</code></pre></div></div>

<p>S et T sont les dimensions 2D de recouvrement de texture, on leur dit de wrap en S et en T suivant un schéma de repeat qui est set à 15 répétitions suivant chaque coordonnée.</p>

<h2 id="déplacement-de-la-caméra">Déplacement de la caméra</h2>

<p>Il est des fois plus agréable de pouvoir déplacer la caméra comme on le souhaite pour pouvoir bien visualiser ce que l’on est en train de modéliser. En conception 3D, il est important de pouvoir observer son travail sous plusieurs angles afin de s’assurer que tout correspond bien à ce que l’on souhaite. En effet on peut faire le cube le plus joli qu’on souhaite, si la caméra est toujours pointée dans la même direction , on ne verra jamais l’arrière de ce cube et il ne correspond peut etre pas du tout à ce que l’on veut.</p>

<p>On a vu qu’il est possible de changer la position et vers où la caméra regarde dans le code. Ce n’est pas forcement le plus intéressant pour pouvoir déplacer la caméra “à la volée” autour d’un objet pour en vérifier les propriétés pendant les phases de développment.</p>

<p>On va donc essayer de mettre en place une méthode de déplacement de la caméra qui soit contrôlée par l’utilisateur au niveau de l’affichage dans le navigateur web. Et traditionnellement, pour permettre à un utilisateur d’interagir avec un programme, qu’est ce qu’on utilise ? Un clavier et/ou une souris !</p>

<p>Pour cette partie, on va s’inspirer de <a href="https://threejs.org/examples/misc_controls_pointerlock.html">cet exemple</a> de la librairie Three.js.</p>
<h3 id="déplacement-en-mode-fps">Déplacement en mode fps</h3>

<p>Il existe plusieurs controleurs de caméra déjà intégrés
dans Three.js et ici on va utiliser <code class="language-plaintext highlighter-rouge">PointerLockControls</code>. Tout 
d’abord il faut l’importer :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">PointerLockControls</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three/examples/jsm/controls/PointerLockControls</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>Une fois importé, on peut déjà déclarer une variable <code class="language-plaintext highlighter-rouge">controls</code> au même endroit de que l’on a déclaré <code class="language-plaintext highlighter-rouge">camera, renderer, scene</code></p>

<p>Ensuite, dans notre fonction <code class="language-plaintext highlighter-rouge">init</code>, on peut directement ajouter les lignes :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nx">controls</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PointerLockControls</span><span class="p">(</span> <span class="nx">camera</span> <span class="p">,</span>  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="p">);</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        
        <span class="nx">controls</span><span class="p">.</span><span class="nx">lock</span><span class="p">();</span>
        
    <span class="p">},</span> <span class="kc">false</span> <span class="p">);</span>
    
    <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">controls</span><span class="p">.</span><span class="nx">getObject</span><span class="p">()</span> <span class="p">);</span>
</code></pre></div></div>

<p>On crée d’abord un objet <code class="language-plaintext highlighter-rouge">PointerLockControls</code> et on va demander au <code class="language-plaintext highlighter-rouge">body</code> de notre document d’attendre que l’utilisateur clique
sur la fenêtre pour lock sa souris et il pourra contrôler la vue.</p>

<p>Maintenant il s’agit de lier les touches du clavier au code.</p>

<p>On va d’abord créer en début de script plusieurs constantes que nous pourrons utiliser par la suite :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">moveForward</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">moveBackward</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">moveLeft</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">moveRight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">canJump</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</code></pre></div></div>
<p>Ces variables vont nous aider à choisir la direction de notre personne.</p>

<p>On va ensuite créer deux constantes qui modifieront ces variables :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">onKeyDown</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>

        <span class="k">switch</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">code</span> <span class="p">)</span> <span class="p">{</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowUp</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyW</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveForward</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowLeft</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyA</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveLeft</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowDown</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyS</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveBackward</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowRight</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyD</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveRight</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">Space</span><span class="dl">'</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="nx">canJump</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span><span class="mi">250</span><span class="p">;</span>
                <span class="nx">canJump</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">const</span> <span class="nx">onKeyUp</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">event</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span> <span class="nx">event</span><span class="p">.</span><span class="nx">code</span> <span class="p">)</span> <span class="p">{</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowUp</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyW</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveForward</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowLeft</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyA</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveLeft</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowDown</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyS</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveBackward</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="dl">'</span><span class="s1">ArrowRight</span><span class="dl">'</span><span class="p">:</span>
            <span class="k">case</span> <span class="dl">'</span><span class="s1">KeyD</span><span class="dl">'</span><span class="p">:</span>
                <span class="nx">moveRight</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

        <span class="p">}</span>
    <span class="p">};</span>
</code></pre></div></div>

<p>Par la suite on va faire en sorte que notre jeu écoute ce que l’on tape :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="dl">'</span><span class="s1">keydown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onKeyDown</span> <span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span> <span class="dl">'</span><span class="s1">keyup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">onKeyUp</span> <span class="p">);</span>
</code></pre></div></div>

<p>Maintenant nous avons notre code qui écoute notre clavier et des variables dont les valeurs varient en fonction de nos touches
pressées. Il faut maintenant pouvoir bouger. Pour cela on va créer en variable globale deux vecteurs <code class="language-plaintext highlighter-rouge">direction</code> et <code class="language-plaintext highlighter-rouge">velocity</code> :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">velocity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">direction</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">();</span>
</code></pre></div></div>

<p>Et on va ajouter une variable temps :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">prevTime</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</code></pre></div></div>

<p>Une fois fait, on peut aller dans notre fonction <code class="language-plaintext highlighter-rouge">animate</code> pour faire bouger notre petit personnage.</p>

<p>On va commencer par créer une nouvelle constante temps :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">performance</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</code></pre></div></div>

<p>Puis, après vérification que les contrôles sont locked :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="nx">controls</span><span class="p">.</span><span class="nx">isLocked</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
    
    
            <span class="kd">const</span> <span class="nx">delta</span> <span class="o">=</span> <span class="p">(</span> <span class="nx">time</span> <span class="o">-</span> <span class="nx">prevTime</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
    
            <span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="nx">delta</span><span class="p">;</span>
            <span class="nx">velocity</span><span class="p">.</span><span class="nx">z</span> <span class="o">-=</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="nx">delta</span><span class="p">;</span>
    
            <span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="mi">6</span><span class="o">*</span> <span class="mf">100.0</span> <span class="o">*</span> <span class="nx">delta</span><span class="p">;</span> <span class="c1">// 100.0 = masse</span>
    
            <span class="nx">direction</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span> <span class="nx">moveForward</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">Number</span><span class="p">(</span> <span class="nx">moveBackward</span> <span class="p">);</span>
            <span class="nx">direction</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">(</span> <span class="nx">moveRight</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">Number</span><span class="p">(</span> <span class="nx">moveLeft</span> <span class="p">);</span>
            <span class="nx">direction</span><span class="p">.</span><span class="nx">normalize</span><span class="p">();</span> 
    
            <span class="k">if</span> <span class="p">(</span> <span class="nx">moveForward</span> <span class="o">||</span> <span class="nx">moveBackward</span> <span class="p">)</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">z</span> <span class="o">-=</span> <span class="nx">direction</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="mf">400.0</span> <span class="o">*</span> <span class="nx">delta</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span> <span class="nx">moveLeft</span> <span class="o">||</span> <span class="nx">moveRight</span> <span class="p">)</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">-=</span> <span class="nx">direction</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="mf">400.0</span> <span class="o">*</span> <span class="nx">delta</span><span class="p">;</span>
            
    
            <span class="nx">controls</span><span class="p">.</span><span class="nx">moveRight</span><span class="p">(</span> <span class="o">-</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">delta</span> <span class="p">);</span>
            <span class="nx">controls</span><span class="p">.</span><span class="nx">moveForward</span><span class="p">(</span> <span class="o">-</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">z</span> <span class="o">*</span> <span class="nx">delta</span> <span class="p">);</span>
    
            <span class="nx">controls</span><span class="p">.</span><span class="nx">getObject</span><span class="p">().</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">+=</span> <span class="p">(</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">delta</span> <span class="p">);</span> 
    
            <span class="k">if</span> <span class="p">(</span> <span class="nx">controls</span><span class="p">.</span><span class="nx">getObject</span><span class="p">().</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">)</span> <span class="p">{</span>
    
                <span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="nx">controls</span><span class="p">.</span><span class="nx">getObject</span><span class="p">().</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    
                <span class="nx">canJump</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    
            <span class="p">}</span>
    
        <span class="p">}</span>
</code></pre></div></div>

<p>Expliquons ces lignes :</p>

<ul>
  <li>On va créer un intervalle de temps entre la dernière fois qu’on a rendu le monde et maitenant</li>
  <li>Ensuite on setup l’inertie : plus le chiffre est grand, plus la vitesse reviendra à 0 vite (.js mdr)</li>
  <li>Ici on simule la gravité : on a pris 6 comme valeur pour un meilleur gameplay</li>
  <li>Ici on gère le vecteur pour savoir où on se dirige en transformant les booléens en nombres</li>
  <li>On augmente la vitesse suivant la direction avec comme valeur 400 ( modifiable pour plus de fun )</li>
  <li>On applique la vitesse à notre controller (en y aussi si on saute)</li>
  <li>On reset la vitesse en y si on est au sol</li>
</ul>

<p>A la fin de ce <code class="language-plaintext highlighter-rouge">if</code>, il ne faut pas oublier de :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="nx">prevTime</span> <span class="o">=</span> <span class="nx">time</span><span class="p">;</span>
        <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span> <span class="p">);</span>
</code></pre></div></div>
<h3 id="bonus-rotation-autour-dun-point-fixe">Bonus: Rotation autour d’un point fixe</h3>

<p>Une autre méthode souvent utilisée consiste à autoriser une rotation de la caméra à l’aide de la souris. Ce type de contrôle s’appelle OrbitControl dans three.js. C’est un contrôle très simple à mettre en place et à utiliser. Juste en maintenant le clic gauche de la souris et en bougeant la souris, on change l’axe de visualisation de la caméra.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">OrbitControls</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">three/examples/jsm/controls/OrbitControls</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">controls</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OrbitControls</span><span class="p">(</span> <span class="nx">camera</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span> <span class="p">);</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
<span class="nx">controls</span><span class="p">.</span><span class="nx">update</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="génération-du-monde">Génération du monde</h2>

<h3 id="plus-de-cubes">Plus de cubes</h3>

<p>Maintenant qu’on peut sauter partout, rajoutons de quoi faire du <strong><em>parkour</em></strong> !</p>

<p>Par exemple plein de cubes. Pour ça, on va d’abord créer une liste d’objets en 
dehors de notre fonction init():</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">objects</span> <span class="o">=</span> <span class="p">[];</span>
</code></pre></div></div>

<p>Ensuite on va créer dans notre fonction init() plein de cubes, qu’on va placer 
aléatoirement dans une zone donnée :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span> <span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span> <span class="p">)</span> <span class="p">{</span>

        <span class="kd">const</span> <span class="nx">cube</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span> <span class="nx">cube_geometry</span><span class="p">,</span> <span class="nx">cube_material</span> <span class="p">);</span>
        <span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span>
        <span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">20</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>
        <span class="nx">cube</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="mi">5</span> <span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span>
        <span class="nx">cube</span><span class="p">.</span><span class="nx">castShadow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">cube</span><span class="p">.</span><span class="nx">receiveShadow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">cube</span> <span class="p">);</span>
        <span class="nx">objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span> <span class="nx">cube</span> <span class="p">);</span>

    <span class="p">}</span>
</code></pre></div></div>

<h3 id="détection-de-sol">Détection de sol</h3>

<p>On doit aussi rajouter des contrôles pour pouvoir s’amuser avec ces cubes et sauter dessus. On va d’abord créer une variable globale</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">raycaster</span><span class="p">;</span>
</code></pre></div></div>

<p>A la fin de la fonction <code class="language-plaintext highlighter-rouge">init</code>, on va ajouter la ligne :</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">raycaster</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Raycaster</span><span class="p">(</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(),</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="p">);</span>
</code></pre></div></div>
<p>pour initialiser la valeur du raycaster, qui sera en fait nos pieds.</p>

<p>On va donc ensuite aller dans la fonction <code class="language-plaintext highlighter-rouge">animate</code>, dans le <code class="language-plaintext highlighter-rouge">if</code>:</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">raycaster</span><span class="p">.</span><span class="nx">ray</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">copy</span><span class="p">(</span> <span class="nx">controls</span><span class="p">.</span><span class="nx">getObject</span><span class="p">().</span><span class="nx">position</span> <span class="p">);</span>
<span class="nx">raycaster</span><span class="p">.</span><span class="nx">ray</span><span class="p">.</span><span class="nx">origin</span><span class="p">.</span><span class="nx">y</span> <span class="o">-=</span> <span class="mi">10</span><span class="p">;</span>
</code></pre></div></div>
<p>On récupère la position de la camera et on y soustrait la taille qui est de 10 ici.</p>

<p>Ensuite on crée ceci :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="kd">const</span> <span class="nx">intersections</span> <span class="o">=</span> <span class="nx">raycaster</span><span class="p">.</span><span class="nx">intersectObjects</span><span class="p">(</span> <span class="nx">objects</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
    
            <span class="kd">const</span> <span class="nx">onObject</span> <span class="o">=</span> <span class="nx">intersections</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<p>On regarde si nos pieds sont en intersection avec un objet de la liste <code class="language-plaintext highlighter-rouge">objects</code>.</p>

<p>Et si on est sur un objet, c’est qu’on était en saut donc on ne pouvait plus sauter :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="k">if</span> <span class="p">(</span> <span class="nx">onObject</span> <span class="o">===</span> <span class="kc">true</span> <span class="p">)</span> <span class="p">{</span>
    
                <span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">velocity</span><span class="p">.</span><span class="nx">y</span> <span class="p">);</span>
                <span class="nx">canJump</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    
            <span class="p">}</span>
</code></pre></div></div>
<h2 id="mise-en-prod">Mise en prod</h2>

<p>On va mettre notre projet three.js sur OVH, on peut parce que ce projet est uniquement en Javascript pur. 
Un des soucis qu’on va rencontrer c’est l’utilisation de <code class="language-plaintext highlighter-rouge">vite</code>, c’est bien même très bien pour la partie développement mais ca 
pose soucis au moment du déploiement.</p>

<blockquote>
  <p>On ne souhaite pas avoir d’<code class="language-plaintext highlighter-rouge">app vite</code> dans notre projet final</p>
</blockquote>

<p>On va alors créer un nouveau dossier qu’on va appeler <code class="language-plaintext highlighter-rouge">threeprod</code> dans lequel on va venir copier le dossier <code class="language-plaintext highlighter-rouge">img</code>  et les
fichiers <code class="language-plaintext highlighter-rouge">main.js</code>, <code class="language-plaintext highlighter-rouge">index.html</code>, <code class="language-plaintext highlighter-rouge">style.css</code>, et les deux json de packages.</p>

<p>Une fois le dossier créer et rempli, on aura un souci d’<code class="language-plaintext highlighter-rouge">import</code> si on copie directement dans l’OVH, on va alors changer les lignes d’import :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">/threeprod/node_modules/three/build/three.module.js</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span><span class="nx">PointerLockControls</span><span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">/threeprod/vendor_mods/three/examples/jsm/controls/PointerLockControls.js</span><span class="dl">'</span>
</code></pre></div></div>

<p>Pourquoi ceci ? Vite.js permettait d’importer directement avec la commande <code class="language-plaintext highlighter-rouge">from 'three'</code> mais lors du déploiement, l’OVH ne
trouve pas le module, il faut lui spécifier où est <code class="language-plaintext highlighter-rouge">three.module.js</code>.</p>

<p>De même, dans le fichier <code class="language-plaintext highlighter-rouge">PointerLockControls.js</code>, l’import est le même : <code class="language-plaintext highlighter-rouge">from three</code>, la solution à ceci sans tout casser
est de créer un nouveau dossier <code class="language-plaintext highlighter-rouge">vendor_mods</code> dans lequel on créera les dossiers de la sorte suivante
<code class="language-plaintext highlighter-rouge">vendor_mods/three/examples/jsm/controls</code> pour coller à la structure de <code class="language-plaintext highlighter-rouge">node_modules</code>. On va y glisser une copie du fichier qu’on
trouvera dans <code class="language-plaintext highlighter-rouge">node_modules/three/examples/jsm/controls/PointerLockControls.js</code>. Une fois copier, on va aussi modifier l’import
de <code class="language-plaintext highlighter-rouge">three</code> en mettant</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">THREE</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">/threeprod/node_modules/three/build/three.module.js</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>Ensuite on peut <code class="language-plaintext highlighter-rouge">scp</code> dans <code class="language-plaintext highlighter-rouge">www</code> et faire un <code class="language-plaintext highlighter-rouge">npm install</code> pour que tout soit bon. Si jamais cela ne vous dit rien, vous pouvez suivre
les tutos suivant :</p>
<ul>
  <li><a href="/cours_informatique/cours/ssh_et_shell/ssh_scp.html">SCP</a></li>
  <li>
<a href="/cours_informatique/cours/ssh_et_shell/ssh.html">SSH</a>
    <h2 id="conclusion">Conclusion</h2>
  </li>
</ul>

<p>Pour décortiquer un peu plus ou juste si vous êtes perdu, voici le <a href="https://github.com/LeoLaurent/three-js-project">repo git du projet final</a></p>

<h1 id="références">Références</h1>

<p><a href="https://threejs.org/docs/index.html">La documentation Three js</a></p>

<p><a href="https://threejs.org/examples/#webgl_animation_cloth">Plein d’exemples de projets en Three js</a></p>

<p><a href="https://www.youtube.com/watch?v=YK1Sw_hnm58">Tutoriel des bases de Three js</a></p>

<p>Shadow et light :</p>

<ul>
  <li><a href="https://stackoverflow.com/questions/48355479/three-js-directionallight-and-shadow-cut-off">Gérer la caméra responsable des ombres</a></li>
  <li><a href="https://stackoverflow.com/questions/41212156/create-very-soft-shadows-in-three-js">Faire des ombres plus sympas</a></li>
</ul>

<p>Textures :</p>

<ul>
  <li><a href="https://3dtextures.me/">Site de textures 3D open source</a></li>
  <li><a href="https://www.youtube.com/watch?v=thVl4UOQSEM">Tuto texture</a></li>
</ul>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique de François Brucker.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
