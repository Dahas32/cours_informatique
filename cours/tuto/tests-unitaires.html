<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tests unitaires en Python avec pytest et pycharm | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Tests unitaires en Python avec pytest et pycharm" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Support de cours/td d’informatique à l’école centrale marseille. A destination des 1A (tronc commun), des 2A (de l’approfondissement MIE) et des 3A (de l’option digital·e)" />
<meta property="og:description" content="Support de cours/td d’informatique à l’école centrale marseille. A destination des 1A (tronc commun), des 2A (de l’approfondissement MIE) et des 3A (de l’option digital·e)" />
<link rel="canonical" href="/cours_informatique/cours/tuto/tests-unitaires.html" />
<meta property="og:url" content="/cours_informatique/cours/tuto/tests-unitaires.html" />
<meta property="og:site_name" content="cours d’informatique" />
<script type="application/ld+json">
{"description":"Support de cours/td d’informatique à l’école centrale marseille. A destination des 1A (tronc commun), des 2A (de l’approfondissement MIE) et des 3A (de l’option digital·e)","@type":"WebPage","headline":"Tests unitaires en Python avec pytest et pycharm","url":"/cours_informatique/cours/tuto/tests-unitaires.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/cours_informatique/">cours d&#39;informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Tests unitaires en Python avec pytest et pycharm</h1>
  </header>

  <div class="post-content">
    <h1 id="introduction">Introduction</h1>

<p>Nous devons être certains que toutes les méthodes, fonctions ou modules que nous créons sont corrects. On écrira donc des tests pour être moralement sûrs que nos programmes fonctionnent (la plupart du temps une preuve de code est illusoire).</p>

<p>Pour éviter de retaper tous ces tests à chaque modification du code (ce qui arrive souvent lorsqu’un algorithme ou une application est utilisée longtemps) ou à chaque découverte de bug, ils sont conservés dans un fichier à part. Ceci nous permettra d’exécuter ces tests à loisir (c’est à dire très souvent) et d’être sûrs que <strong>tous</strong> les tests seront exécutés. Ces  <a href="[https://fr.wikipedia.org/wiki/Test_unitaire">tests sont dit unitaires</a> et sont essentiels dans toutes les pratiques courantes de code.</p>

<p>De nombreux frameworks de tests existent pour python, le plus connu étant certainement <a href="https://docs.python.org/3/library/unittest.html">unittest</a>, ou encore <a href="http://nose.readthedocs.io/en/latest/">nose</a>. Nous allons utiliser <a href="http://pytest.org">pytest</a>.</p>

<blockquote>
  <p><strong>Nota Bene :</strong>
Une très bonne introduction au développement par les tests est l’inusable Test Driven Development: By Example de Kent Beck. Tous les exemples sont en revanche en Java.
Sinon en python mais orienté développement web, il y a le bon (mais il faut s’accrocher si on débute) “Test-Driven Development with Python” de Harry J.w Percival.</p>
</blockquote>

<h1 id="un-exemple">Un exemple</h1>

<p>Créez un nouveau projet avec pycharm que l’on pourra appeler <code class="language-plaintext highlighter-rouge">essai_tests</code>, puis ajoutez-y un fichier que vous nommerez <code class="language-plaintext highlighter-rouge">aide_mathematiques.py</code>. Ce fichier contiendra le code suivant :</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">entier</span><span class="p">):</span>
  <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">entier</span>
</code></pre></div></div>

<p>Pour tester ce code, j’imagine que si les deux conditions suivantes sont remplies :</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">double(0)</code> vaut <code class="language-plaintext highlighter-rouge">0</code>,</li>
  <li><code class="language-plaintext highlighter-rouge">double (21)</code> vaut <code class="language-plaintext highlighter-rouge">42</code></li>
</ul>

<p>Ma méthode sera exacte.</p>

<p>On utilise le mot clé <a href="http://www.tutorialspoint.com/python/assertions_in_python.htm">assert</a> pour créer notre fonction de test.</p>

<blockquote>
  <p>**Attention : **
Les fonctions de tests doivent toutes commencer par ‘‘test_’’.</p>

</blockquote>

<p>Ajouter la méthode ci-après à votre fichier :</p>

<pre><code class="language- python">
def test_double():
  assert double(0) == 0
  assert double(21) == 42

</code></pre>

<p>et exécutez là :</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">test_double</span><span class="p">()</span>
</code></pre></div></div>

<p>Si tout s’est passé comme prévu, il ne s’est rien passé. Normal, l’ <code class="language-plaintext highlighter-rouge">assert</code> était vérifié. Changez un des <code class="language-plaintext highlighter-rouge">assert</code> de la fonction <code class="language-plaintext highlighter-rouge">test_double</code> pour que le résultat soit faux (par exemple <code class="language-plaintext highlighter-rouge">assert double(0) == 7</code>). Le programme doit maintenant s’arrêter sur une exception. Chez moi, j’obtiens ça :</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Traceback (most recent call last):
  File "/Users/francois/Documents/pycharm/essai_tests/aide_mathematiques.py", line 10, in &lt;module&gt;
    test_double()
  File "/Users/francois/Documents/pycharm/essai_tests/aide_mathematiques.py", line 6, in test_double
    assert double(0) == 7
AssertionError
</code></pre></div></div>

<p>Ainsi, si tout se passe bien, nos tests sont passés, si le programme s’arrête sur une exception de type <code class="language-plaintext highlighter-rouge">AssertionError</code>, nos tests ne correspondent pas à la réalité. Nous sommes en face d’un bug (qu’il faut corriger).</p>

<h1 id="séparer-code-et-tests">Séparer code et tests</h1>

<p>Placez la fonction de test (et son exécution) dans un fichier que vous nommerez <code class="language-plaintext highlighter-rouge">test_aide_mathematiques.py</code>.</p>

<p>Faites en sorte qu’il s’exécute sans problème (attention aux <code class="language-plaintext highlighter-rouge">import</code>).</p>

<blockquote>
  <p><strong>Attention :</strong>
On séparera toujours les tests du code. Tout fichier de test commence par ‘‘test_’’.</p>

</blockquote>

<h1 id="utilisation-de-lenvironnement-de-test-avec-pycharm">Utilisation de l’environnement de test avec pycharm</h1>

<p>Nous allons demander à l’environnement <a href="http://pytest.org/latest/">py.test</a> d’exécuter nos tests. Il nous donnera plus d’informations sur les tests réussis ou échoués (une application normale contient des centaines de tests).</p>

<p>Commencez par supprimer l’exécution de <code class="language-plaintext highlighter-rouge">test_double</code> dans le fichier <code class="language-plaintext highlighter-rouge">test_aide_mathematiques.py</code>.</p>

<blockquote>
  <p><strong>Attention :</strong>
Un fichier de tests ne doit contenir que des fonctions.</p>

</blockquote>

<p>Puis nous allons demander à <a href="https://www.jetbrains.com/pycharm/">Pycharm</a> d’exécuter <code class="language-plaintext highlighter-rouge">test_aide_mathematiques.py</code> à l’aide de notre environnement de test.</p>

<p>Pour cela, créez un environnement d’exécution (expliqué dans ce <a href="/cours_informatique/cours/tuto/anaconda-pycharm-pytest.html">tuto</a>) et créez une configuration  <em>pyhton test &gt; pytest</em>. Ici, les paramètres dont nous aurons besoin sont :</p>

<ul>
  <li>le champ <em>name</em>, qui donne un nom à notre contexte. Par exemple <em>“mes tests”</em></li>
  <li>le champ <em>target</em>, qui spécifie quel script utiliser. Cliquez tout à droite de ce champ sur un petit bouton avec <em>…</em> puis choisissez le fichier <code class="language-plaintext highlighter-rouge">test_aide_mathematiques.py</code></li>
</ul>

<p>Une fois ceci configuré, cliquez sur <em>OK</em>.</p>

<p>Un nouvel environnement de tests est créé dans le menu <em>run</em>. Exécutez le. Vous devriez voir une nouvelle fenêtre en bas de l’écran pycharm apparaître et vos tests s’exécuter. Si tout s’est bien passé, une barre verte doit apparaître.</p>

<p>Pour finir cette partie :</p>

<ul>
  <li>Séparez votre fonction de tests en 2 fonctions (chaque fonction de test ne doit contenir qu’une chose à tester, donc a priori qu’un seul <code class="language-plaintext highlighter-rouge">assert</code>).</li>
  <li>Exécutez votre nouvel environnement.</li>
  <li>Ajoutez une fonction de test qui plante. Exécutez votre environnement de test. Voyez la barre rouge. Supprimez ce test non valide.</li>
</ul>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d&#39;informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d&#39;informatique</li><li><a class="u-email" href="mailto:francois.brucker@centrale-marseille.fr">francois.brucker@centrale-marseille.fr</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li><li><a href="https://www.twitter.com/p_____p___"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">p_____p___</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d&#39;informatique à l&#39;école centrale marseille.
A destination des 1A (tronc commun), des 2A (de l&#39;approfondissement MIE) et des 3A (de l&#39;option digital·e)</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
