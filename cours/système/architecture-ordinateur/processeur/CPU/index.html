<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>CPU</title>

    <link href="/cours_informatique/assets/node_modules/prismjs/themes/prism-solarizedlight.min.css" rel="stylesheet">
    <link href="/cours_informatique/assets/node_modules/prismjs/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet">

    <link href="/cours_informatique/assets/stylesheets/main.css" rel="stylesheet">

  </head>
  <body>
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [
            [
              '$', '$'
            ],
            [
              '\\(', '\\)'
            ]
          ]
        },
        svg: {
          fontCache: 'global'
        }
      };

      function goTop() {
        window.scrollTo({top: 0});
      }
      function goBottom() {
        window.scrollTo({top: document.body.scrollHeight});
      }
    </script>
    <script type="text/javascript" id="MathJax-script" src="/cours_informatique/assets/node_modules/mathjax/es5/tex-svg-full.js"></script>

    <header class="border-b-2 border-gray-200 mb-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-between items-center">
          <a class="mx-2" href="/cours_informatique/">Home</a>
        </div>

        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <a class="mx-2" href="/cours_informatique/about">About</a>
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-4">
      
<article>

  <h1>CPU</h1>
  <div>
    

    
  </div>

  

    
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-purple-500 bg-purple-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
</svg>
<div class="pl-8 mr-8">

<a class="interne" href="/cours_informatique/cours/">Cours</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système/">Système</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système/architecture-ordinateur/">Architecture d&#39;un ordinateur</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système/architecture-ordinateur/processeur/">Processeur</a><span class="px-1">/</span><a class="interne" href="/cours_informatique/cours/système/architecture-ordinateur/processeur/CPU/">CPU</a>

</div>
</div>


    
  

  <h2>Exécution parallèle de process</h2>
<h3>hyper-threading</h3>
<p>Un core peut passer beaucoup de temps à attendre des données du cache. L'<a href="https://en.wikipedia.org/wiki/Hyper-threading">hyper-threading</a> permet de mettre cette attente à profit pour exécuter le code d'un autre thread.</p>
<p>Ceci est possible puisque les threads se partagent tout sauf les registres.</p>
<p>Chaque core peut ainsi exécuter deux thread <em>quasiment</em> en parallèle.</p>
<blockquote>
<p>TBD : comment ça marche.<br>
TBD rappelle process et thread</p>
</blockquote>
<h4>Multi-process</h4>
<p>La page se remplit petit à petit par l'OS. Lorsque le process tente d'accéder à une page qui n'existe pas, une exception est levée : <a href="https://wiki.osdev.org/Exceptions#Page_Fault">exception page-fault</a>.</p>
<p>L'OS tente de la résoudre soit :</p>
<ul>
<li>en faisant la correspondance avec la mémoire réelle</li>
<li>en recherchant un bloc mis de côté par manque de place. C'est le <a href="https://fr.wikipedia.org/wiki/Espace_d%27%C3%A9change">mécanisme de swap</a></li>
<li>en interdisant l'accès</li>
</ul>
<h3>cache</h3>
<p>le cache L3 est commun et tout ce qui est dans le cache est forcément en l1 ou l2</p>
<h3>Cache et cores</h3>
<blockquote>
<p>TBD à faire bien.</p>
</blockquote>
<blockquote>
<p>soucis que si plusieurs core écrivent sur des données identique. Doit quasi pas arriver si process différents<br>
L3 inclusive : donc permet de vérifier que tout est ok.</p>
</blockquote>
<p>Les différents caches L1 et L2 sont privé à chaque core. Tant que la mémoire n'est pas modifiée ces caches sont indépendants, mais lorsqu'une donnée contenue dans plusieurs caches est modifiée, il faut <a href="https://en.wikipedia.org/wiki/Cache_coherence">maintenir la cohérence entre tous les caches</a>.</p>
<p><img src="cores.png" alt="cores"></p>
<blockquote>
<p>TBD cohérence uniquement en L3. Qui est sur le ring. Puis descente invalidation. en L2 et L1 dans le core.</p>
</blockquote>
<blockquote>
<p>TBD : attention, plus de snooping. on remonte juste l'invalidation.</p>
</blockquote>
<p>Les cores sont liées entre eux par le ring qui permet de faire transiter des informations :</p>
<ul>
<li>depuis la mémoire via le bus</li>
<li>entre chaque core pour maintenir la cohérence de chaque cache</li>
</ul>
<p>Maintenir la cohérence entre les caches de chaque core nécessite deux actions pour chaque cache :</p>
<ul>
<li>il faut qu'il surveille les demandes de lecture/écriture des autres cache. Ceci s'appelle le <a href="https://en.wikipedia.org/wiki/Bus_snooping">bus snooping</a>.</li>
<li>il faut qu'il s'adapte aux données présentes dans les autres caches :
<ul>
<li>lorsqu'il demande une donnée modifiée dans un autre cache :
<ol>
<li>il demande au cache ayant la donnée modifiée de l'écrire en mémoire</li>
<li>une fois la donnée écrite, on charge la donnée depuis la mémoire</li>
</ol>
</li>
<li>lorsqu'il écrit une donnée présente dans plusieurs cache, il demande aux autres caches d'invalider la ligne contenant cette donnée s'ils la possède (demander aux autres cache de modifier leurs valeurs causerait trop d'écritures inutiles, il n'est en effet pas sur qu'ils auraient encore eu besoin de cette ligne)</li>
</ul>
</li>
</ul>
<p>Notez que l'on ne modifie la valeur en mémoire que si plusieurs caches ont la ligne. Si seulement un cache à la donnée et qu'il la modifie, elle n'est pas envoyée en mémoire.</p>
<p>La mise en œuvre de cette technique peut être faite de façon plus optimisée en utilisant le protocole <a href="https://en.wikipedia.org/wiki/MOESI_protocol">MOESI</a> qui ne force pas la réécriture en mémoire à chaque demande de donnée modifiée (le cache ayant la donnée modifiée la passe au cache demandeur). Sa mise en œuvre est cependant plus complexe car il faut des moyens de se partager des données entre caches.</p>
<div class="quote relative  py-2 drop-shadow rounded rounded-tl-none rounded-bl-none border-solid border-l-8 border-cyan-500 bg-cyan-100">
<svg class="absolute w-7 h-7 pl-1 pt-0.5 pb-0.5 text-cyan-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
</svg>
<div class="pl-8 mr-8">
<p>Il en existe une <a href="https://en.wikipedia.org/wiki/Cache_coherency_protocols_(examples)#MESI_protocol">foule d'autres protocoles</a></p>
</div>
</div>
<h3>Context Switching</h3>
<blockquote>
<p>TBD changer :</p>
<ul>
<li>si thread juste registre.</li>
<li>si processus :
<ul>
<li>proc : la lookup table et les registres.</li>
<li>OS : changer aussi la page table (un pointeur à changer)</li>
</ul>
</li>
</ul>
<p>Pas besoin de changer le cache puisque VIPT<br>
exécution context : un process/thread</p>
</blockquote>
<p>Ceci doit se faire vite pour simuler le parallèlisme.</p>
<p>Le processeur n'a pas de mémoire. Son état est déterminé par :</p>
<ul>
<li>la valeur de ses registres</li>
<li>la table des addresses de la MMU</li>
</ul>
<blockquote>
<p>TBD facile de changer de contexte. On vide le cache, puis on remet la table et les valeurs des registres.</p>
</blockquote>


</article>
    </main>

    <footer class="min-h-[50px] border-t-2 border-gray-200 mt-4">
      <div class="max-w-[1200px] mx-auto px-4 relative">
        <div class="min-h-[50px] flex justify-center items-center">
          <p>
            Cours d'informatique à l'école centrale Marseille
          </p>
        </div>
        <div class="min-h-[50px] flex justify-center items-center absolute right-0 top-0">
          <button onclick="goTop()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 11.25l-3-3m0 0l-3 3m3-3v7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>

          <button onclick="goBottom()" id="myBtn" title="Go to top">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </button>
        </div>

      </div>
    </footer>

    <script>
      MathJax
        .startup
        .document
        .getMathItemsWithin(document.body);
    </script>

  </body>
</html>