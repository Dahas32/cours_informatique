<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>wsl ou linux dans windows | cours d’informatique</title>
<meta name="generator" content="Jekyll v4.2.0">
<meta property="og:title" content="wsl ou linux dans windows">
<meta name="author" content="François Brucker">
<meta property="og:locale" content="en_US">
<meta name="description" content="Comment installer et bien préparer wsl pur le développement.">
<meta property="og:description" content="Comment installer et bien préparer wsl pur le développement.">
<link rel="canonical" href="/cours_informatique/tutos/systeme/installation/wsl/2021/09/27/wsl-windows.html">
<meta property="og:url" content="/cours_informatique/tutos/systeme/installation/wsl/2021/09/27/wsl-windows.html">
<meta property="og:site_name" content="cours d’informatique">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-27T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="wsl ou linux dans windows">
<script type="application/ld+json">
{"description":"Comment installer et bien préparer wsl pur le développement.","@type":"BlogPosting","url":"/cours_informatique/tutos/systeme/installation/wsl/2021/09/27/wsl-windows.html","headline":"wsl ou linux dans windows","datePublished":"2021-09-27T00:00:00+00:00","dateModified":"2021-09-27T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"/cours_informatique/tutos/systeme/installation/wsl/2021/09/27/wsl-windows.html"},"author":{"@type":"Person","name":"François Brucker"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cours_informatique/assets/main.css">

  <link rel="stylesheet" href="/cours_informatique/assets/custom.css">
<link type="application/atom+xml" rel="alternate" href="/cours_informatique/feed.xml" title="cours d'informatique">
</head>

<body>
<header class="site-header" role="banner">

  <div class="wrapper">
<a class="site-title" rel="author" href="/cours_informatique/">cours d'informatique</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
            <a class="page-link" href="/cours_informatique/about"> about </a>
        </div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">wsl ou linux dans windows</h1>Auteurs :
      <ul>
      
        <li><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">François Brucker</span></span></li>
      
      </ul>
  </header>

  <div class="post-content">
    <p>Comment installer et bien préparer wsl pur le développement.</p>

<!--more-->

<h2 id="introduction">Introduction</h2>

<p><a href="https://docs.microsoft.com/en-us/windows/wsl/">WSL</a> signifie <em>Windows Subsystem for Linux</em> et consiste à installer une distribution linux qui cohabite dans votre windows;</p>

<p>Ce n’est ni un dual boot ni une machine virtuelle. L’intérêt principal est que les port de la machine sont partagées entre windows et WSL, ce qui en fait une machine de développement web idéale.</p>

<blockquote>
  <p>WSL 2 est de plus indispensable si vous voulez utiliser <a href="https://www.docker.com/">docker</a> sous windows.</p>
</blockquote>

<p>Nous verrons ici comment installer le système et les divers outils que l’on peut utiliser.
A priori seule l’installation et la mise à jour sont indispensable. Le reste c’est pour un usage plus intensif de la WSL en tant qu’outil de développement.</p>

<h2 id="installation">installation</h2>

<p>Trop rien à dire. Suivez la doc : <a href="https://docs.microsoft.com/en-us/windows/wsl/install">https://docs.microsoft.com/en-us/windows/wsl/install</a>.</p>

<p>Il suffit de taper la commande suivant dans un powershell en mode admin :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wsl <span class="nt">--install</span>
</code></pre></div></div>

<p>Ca va préparer l’installation, puis après un reboot, finaliser l’installation.</p>

<blockquote>
  <p>Si vous ne précisez pas la distribution, vous aurez une ubuntu.</p>
</blockquote>

<p>Une fois l’installation terminée, vous pourrez ouvrir un terminal unix dans votre windows.</p>

<blockquote class="attention">
  <p>Vous n’avez pas de fenêtre graphique par défaut sous WSL, vous n’avez accès qu’aux commandes unix en terminal. C’est comme si vous étiez sur un serveur distant à la maison.</p>
</blockquote>

<h2 id="mise-à-jour">mise à jour</h2>

<p>Dons le terminal de votre ubuntu (ou debian), vous pouvez mettre à jour les différents packages installées :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt upgrade
</code></pre></div></div>

<p>On peut maintenant installer nos packages :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>ssh
<span class="nb">sudo </span>apt <span class="nb">install </span>vim
</code></pre></div></div>

<p>Vous pourrez ensuite utiliser <code class="language-plaintext highlighter-rouge">apt-get</code> pour <a href="http://www.octetmalin.net/linux/tutoriels/apt-get.php">installer d’autres packages</a>.</p>

<blockquote>
  <p>Le gestionnaire de package de ubuntu et debian est identique, c’est <a href="https://doc.ubuntu-fr.org/apt">apt</a>.</p>
</blockquote>

<h2 id="les-fichiers">les fichiers</h2>

<p>WSL et windows sont deux systèmes d’exploitation différents qui cohabitent sur une même machine. On a donc pas accès immédiatement aux fichiers de l’un dans l’autre système, mais ce n’est pas très compliquer de le faire.</p>

<h3 id="les-fichiers-windows-sous-wsl">les fichiers windows sous wsl</h3>

<p>Les fichiers windows sont accessible depuis wsl via le répertoire <code class="language-plaintext highlighter-rouge">/mnt/</code></p>

<h3 id="les-fichiers-wsl-sous-windows">les fichiers wsl sous windows</h3>

<p>Les fichiers wsl sont accessible depuis l’<a href="https://devblogs.microsoft.com/commandline/whats-new-for-wsl-in-windows-10-version-1903/">explorateur windows</a>. Dans un terminal wsl, il suffit de taper les commandes suivantes :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~
explorer.exe <span class="nb">.</span>
</code></pre></div></div>

<p>Une fenêtre de l’explorateur doit s’ouvrir dans le dossier home de votre compte wsl.</p>

<h2 id="ssh-agent">ssh-agent</h2>

<p>Cette partie est plus problématique. On ne peut a-priori utiliser l’agent ssh de windows dans wsl. Il faut en créer un pour wsl.</p>

<p>On va suivre les instructions de <a href="https://www.scivision.dev/ssh-agent-windows-linux/">ce site</a> et ajouter à la fin de notre <code class="language-plaintext highlighter-rouge">~/.bashrc</code> les lignes suivantes qui permettrons d’avoir un ssh-agent d’opérationnel en wsl :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> <span class="nt">-z</span> <span class="s2">"</span><span class="si">$(</span>pgrep ssh-agent<span class="si">)</span><span class="s2">"</span> <span class="o">]</span><span class="p">;</span> <span class="k">then
   </span><span class="nb">rm</span> <span class="nt">-rf</span> /tmp/ssh-<span class="k">*</span>
   <span class="nb">eval</span> <span class="si">$(</span>ssh-agent <span class="nt">-s</span><span class="si">)</span> <span class="o">&gt;</span> /dev/null
<span class="k">else
   </span><span class="nb">export </span><span class="nv">SSH_AGENT_PID</span><span class="o">=</span><span class="si">$(</span>pgrep ssh-agent<span class="si">)</span>
   <span class="nb">export </span><span class="nv">SSH_AUTH_SOCK</span><span class="o">=</span><span class="si">$(</span>find /tmp/ssh-<span class="k">*</span> <span class="nt">-name</span> agent.<span class="k">*</span><span class="si">)</span>
<span class="k">fi</span>
</code></pre></div></div>

<p>Ceci permettra de lancer un agent à chaque fois qu’une fenêtre wsl sera ouverte.</p>

<blockquote>
  <p>Cette configuration a cependant toujours 2 agents différent, celui de windows et celui de wsl. Selon qu’on cherche à se connecter depuis windows ou depuis wsl, on utilisera l’un ou l’autre des agents.</p>
</blockquote>

<h2 id="les-fenêtres">les fenêtres</h2>

<p>Utiliser une fenêtre unix dans un windows n’est pas une procédure simple. En effet, le protocole utilisé pour ouvir des fenêtre dans le monde unix (nommé <a href="https://fr.wikipedia.org/wiki/X_Window_System">X11</a>) est différent de celui utilisé par windows.</p>

<p>Il faut installer un serveur x11 dans windows pour pouvoir ouvrir des fenêtres unix dans windows.</p>

<p>Pour faire nos tests de fenêtre on utilisera la commande <code class="language-plaintext highlighter-rouge">xeyes</code>. Il faut commencer par l’installer</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>x11-apps
</code></pre></div></div>

<p>Il faut procéder en 2 temps :</p>

<ul>
  <li>avoir un serveur X sous windows</li>
  <li>dire à ubuntu d’utiliser le serveur X de windows comme gestionnaire de fenêtres</li>
</ul>

<h3 id="lancer-un-serveur-x-sous-windows">lancer un serveur X sous windows</h3>

<p>On va installer <a href="https://sourceforge.net/projects/vcxsrv/">vcxsrv</a>.</p>

<p>Vous lancez un serveur X en exécutant <code class="language-plaintext highlighter-rouge">XLaunch</code>. Les paramètres du serveur X sont :</p>

<ul>
  <li>Multiple windows et display windows -1 (paramètres par défaut),</li>
  <li>Start no client (paramètres par défaut),</li>
  <li>cochez toutes les cases. Celles déjà cochées (clipoard, Primary Selection ; Native opengl) celle qui n’est pas cochée par défaut (Disable access control)</li>
</ul>

<p>Une fois le serveur X lancé, windows comprend le protocole X11.</p>

<h3 id="associer-le-serveurs-aux-fenêtres-depuis-wsl">associer le serveurs aux fenêtres depuis wsl</h3>

<p>Maintenant que votre serveur X est lancé il faut l’associer aux fenêtre depuis wsl. Il faut dire à WSL quel serveur X utiliser pour ses fenêtre.</p>

<p><a href="https://stackoverflow.com/questions/61110603/how-to-set-up-working-x11-forwarding-on-wsl2/61110604#61110604">Ceci se fait</a> en positionnant deux variables :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">DISPLAY</span><span class="o">=</span><span class="si">$(</span><span class="nb">awk</span> <span class="s1">'/nameserver / {print $2; exit}'</span> /etc/resolv.conf 2&gt;/dev/null<span class="si">)</span>:0
<span class="nb">export </span><span class="nv">LIBGL_ALWAYS_INDIRECT</span><span class="o">=</span>1
</code></pre></div></div>

<p>Vous pouvez ensuite taper <code class="language-plaintext highlighter-rouge">xeyes</code>` dans un terminal wsl et vous obtiendrez une paire d’yeux qui vous regarde.</p>

<blockquote>
  <p>Vous pouvez ajouter les deux lignes ci-dessus à votre fichier <code class="language-plaintext highlighter-rouge">~/.bashrc</code> pour qu’il soit exécuté à chaque session si vous le souhaitez.</p>
</blockquote>

<h2 id="brew">brew</h2>

<p><a href="https://brew.sh/index_fr">brew</a> est un célèbre installeur de packages sous macos. Nous allons également l’installer pour wsl, histoire de n’avoir qu’une commande pour l’installation de package quelque soit le système utilisé.</p>

<p>Pour <a href="https://docs.brew.sh/Homebrew-on-Linux">installer brew</a>, il faut commencer par installer des packages avec apt :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>build-essential curl file git
</code></pre></div></div>

<p>Une fois tout ça d’installé, on peut installer brew :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/bin/bash <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/master/install.sh<span class="si">)</span><span class="s2">"</span>
</code></pre></div></div>

<p>Lisez ce que vous dit brew et faites les dernières manipulations :</p>

<ul>
  <li>faire en sorte de retrouver la commande brew l’ajoutant dans le <code class="language-plaintext highlighter-rouge">PATH</code>
</li>
  <li>installer <code class="language-plaintext highlighter-rouge">gcc</code>
</li>
</ul>

<p>On teste si on arrive à installer des choses :</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>hello
hello
</code></pre></div></div>

<h2 id="wsl-et-vscode">wsl et vscode</h2>

<p><a href="https://code.visualstudio.com/docs/remote/wsl">https://code.visualstudio.com/docs/remote/wsl</a></p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cours_informatique/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">cours d'informatique</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">cours d'informatique</li>
</ul>
      </div>

      <div class="footer-col footer-col-2">
<ul class="social-media-list"><li><a href="https://github.com/FrancoisBrucker"><svg class="svg-icon"><use xlink:href="/cours_informatique/assets/minima-social-icons.svg#github"></use></svg> <span class="username">FrancoisBrucker</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Support de cours/td d'informatique à l'école centrale marseille.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
